<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <title>Hybrid Sentiment-Momentum Strategy in Cryptocurrency Market - Allen&#39;s Whiteboard</title>
    <meta property="og:title" content="Hybrid Sentiment-Momentum Strategy in Cryptocurrency Market - Allen&#39;s Whiteboard">
    
    <meta name="twitter:card" content="summary">

    
      
    

    
      
      <meta property="description" content="This is an exploratory research trying to implement a simple yet robust sentiment analysis mechanism in the cryptocurrency market. We call it a hybrid sentiment-momentum strategy as it applies context &amp;hellip;">
      <meta property="og:description" content="This is an exploratory research trying to implement a simple yet robust sentiment analysis mechanism in the cryptocurrency market. We call it a hybrid sentiment-momentum strategy as it applies context &amp;hellip;">
      
    

    
    
    
    <meta name="twitter:image" content="https://allenfrostline.com/logo.png">
    
    

    

    
    




    <link rel="stylesheet" href="/css/style.css" />
    <link rel="stylesheet" href="/css/fonts.css" />
    

<script type="text/javascript" id="MathJax-script" async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
  </script>
<script src="/js/math-code.js"></script>


<script async src="/js/center-img.js"></script>

<script>
  (function (u, c) {
    var d = document, t = 'script', o = d.createElement(t), s = d.getElementsByTagName(t)[0];
    o.src = u;
    if (c) { o.addEventListener('load', function (e) { c(e); }); }
    s.parentNode.insertBefore(o, s);
  })('//cdn.jsdelivr.net/npm/pangu@4.0.5/dist/browser/pangu.min.js', function () {
    pangu.spacingPage();
  });
</script>



<script async src="/js/center-img.js"></script>
  </head>

  
  <body class="blog">
    <header class="masthead">
      

<h1><a href="/"><img src="/logo.png" alt="allenfrostline" /></a></h1>



      <nav class="menu">
  <ul>
  
  
  <li><a href="/blog/">Blog</a></li>
  
  <li><a href="/vitae/">Vitae</a></li>
  
  <li><a href="/recipe/">Recipe</a></li>
  
  <li><a href="/eatery/">Eatery</a></li>
  
  <li><a href="/pottery/">Pottery</a></li>
  
  













  </ul>
</nav>

    </header>

    <article class="main">
      <header class="title">
      
    <h1>Hybrid Sentiment-Momentum Strategy in Cryptocurrency Market</h1>
    

    <hr style="margin-top:-1em">

    <h3 style="margin-top:-2.3em">
    
        

        
            2019-06-09
        
    
    </h3>



      </header>



<p>This is an exploratory research trying to implement a simple yet robust sentiment analysis mechanism in the cryptocurrency market. We call it a hybrid sentiment-momentum strategy as it applies context analysis (or more specifically, word analysis) into traditional momentum strategies and adjusts position automatically over time using both factors. The hybrid strategy is implemented with backtesing period from Dec. 17th 2017 to May 2nd 2019. It yields cumulative return of 229% and a remarkable Sharpe ratio of 2.68 with acceptable maximum drawdown in out-of-sample backtest, which is a huge improvement from classical momentum strategies in our analysis.</p>
<img src="/images/cryptonews_56_0.png" style="width: 100%;"/>
<h1 id="introduction">Introduction</h1>
<p>Cryptocurrency has been a hot topic ever since the creation of Bitcoin in 2009. Unlike stocks which are backed by real companies, cryptocurrency has no intrinsic value, causing its price to be heavily reliant on market information. The decentralization of exchanges, the inconsistency of prices, the lack of tangible entity and assets all present serious analytics challenges that are difficult to solve with traditional tools. Therefore, we want to introduce news data into our strategy.</p>
<p>There are many reasons to believe that momentum strategy will perform well in this market. Compared to other markets, there are fewer participants in the cryptocurrency market; thus, information is both diffused and acted on slowly. In addition, a smaller number of participants leads to a lack of liquidity, forcing large investors to spread out transactions over time. Last but not least, the limited information source makes the decision of investors largely dependent on recent performance, which further drives the herd mentality. However, there are no less reasons to think that momentum strategy will fail. We need something else to help us decide when we should use momentum strategy and when we may want to go opposite. So we go one step further and develop a new strategy that we call hybrid sentiment-momentum strategy.</p>
<p>On the other hand, the cryptocurrency market is mostly driven by the overall investors&rsquo; fanaticism, which suggests that momentum strategy would perform extremely well when this market is optimistic and bullish. However, when fanaticism is dampened by negative news, people go back to a more rational and conservative investing style, driving a momentum reversal strategy to gain.</p>
<p>In the following sections, we showcase our hybrid sentiment-momentum strategy step by step. First of all, we introduce how we use web crawling to get news data, coin prices and market capitalization and how we process them. After that, we illustrate our model construction and the underlying mathematical support. We then present our evaluation on strategy performance through comparing it with benchmark strategies including buy-and-hold, momentum and momentum reversal. Before wrapping up with our conclusions, we demonstrate our analysis on model sensitivity to multiple parameters.</p>
<h1 id="data">Data</h1>
<p>In this section, we are going to discuss our source of data as well as how we prepare our data for the sentiment model.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="font-weight:bold">import</span> <span style="color:#555">os</span>
</span></span><span style="display:flex;"><span><span style="font-weight:bold">import</span> <span style="color:#555">warnings</span>
</span></span><span style="display:flex;"><span><span style="font-weight:bold">import</span> <span style="color:#555">matplotlib</span>
</span></span><span style="display:flex;"><span><span style="font-weight:bold">import</span> <span style="color:#555">numpy</span> <span style="font-weight:bold">as</span> <span style="color:#555">np</span>
</span></span><span style="display:flex;"><span><span style="font-weight:bold">import</span> <span style="color:#555">pandas</span> <span style="font-weight:bold">as</span> <span style="color:#555">pd</span>
</span></span><span style="display:flex;"><span><span style="font-weight:bold">import</span> <span style="color:#555">seaborn</span> <span style="font-weight:bold">as</span> <span style="color:#555">sns</span>
</span></span><span style="display:flex;"><span><span style="font-weight:bold">from</span> <span style="color:#555">itertools</span> <span style="font-weight:bold">import</span> product
</span></span><span style="display:flex;"><span><span style="font-weight:bold">import</span> <span style="color:#555">matplotlib.pyplot</span> <span style="font-weight:bold">as</span> <span style="color:#555">plt</span>
</span></span><span style="display:flex;"><span><span style="font-weight:bold">from</span> <span style="color:#555">scipy.stats</span> <span style="font-weight:bold">import</span> multinomial
</span></span><span style="display:flex;"><span><span style="font-weight:bold">from</span> <span style="color:#555">scipy.optimize</span> <span style="font-weight:bold">import</span> minimize
</span></span><span style="display:flex;"><span><span style="font-weight:bold">from</span> <span style="color:#555">IPython.display</span> <span style="font-weight:bold">import</span> display, HTML, Image
</span></span><span style="display:flex;"><span><span style="font-weight:bold">from</span> <span style="color:#555">wordcloud</span> <span style="font-weight:bold">import</span> WordCloud, STOPWORDS
</span></span><span style="display:flex;"><span><span style="font-weight:bold">from</span> <span style="color:#555">collections</span> <span style="font-weight:bold">import</span> Counter, namedtuple
</span></span><span style="display:flex;"><span><span style="font-weight:bold">from</span> <span style="color:#555">pandas.plotting</span> <span style="font-weight:bold">import</span> register_matplotlib_converters
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>register_matplotlib_converters()
</span></span><span style="display:flex;"><span>matplotlib<span style="font-weight:bold">.</span>font_manager<span style="font-weight:bold">.</span>_rebuild()
</span></span><span style="display:flex;"><span>np<span style="font-weight:bold">.</span>set_printoptions(linewidth<span style="font-weight:bold">=</span><span style="color:#099">200</span>, threshold<span style="font-weight:bold">=</span><span style="color:#099">100</span>, floatmode<span style="font-weight:bold">=</span><span style="color:#b84">&#39;fixed&#39;</span>)
</span></span><span style="display:flex;"><span>plt<span style="font-weight:bold">.</span>rcParams[<span style="color:#b84">&#39;lines.linewidth&#39;</span>] <span style="font-weight:bold">=</span> <span style="color:#099">2</span>
</span></span><span style="display:flex;"><span>plt<span style="font-weight:bold">.</span>rcParams[<span style="color:#b84">&#39;font.family&#39;</span>] <span style="font-weight:bold">=</span> <span style="color:#b84">&#39;serif&#39;</span>
</span></span><span style="display:flex;"><span>plt<span style="font-weight:bold">.</span>rcParams[<span style="color:#b84">&#39;font.serif&#39;</span>] <span style="font-weight:bold">=</span> <span style="color:#b84">&#39;Palatino&#39;</span>
</span></span><span style="display:flex;"><span>plt<span style="font-weight:bold">.</span>rcParams[<span style="color:#b84">&#39;axes.facecolor&#39;</span>] <span style="font-weight:bold">=</span> <span style="color:#b84">&#39;#000000&#39;</span>
</span></span><span style="display:flex;"><span>plt<span style="font-weight:bold">.</span>rcParams[<span style="color:#b84">&#39;figure.figsize&#39;</span>] <span style="font-weight:bold">=</span> (<span style="color:#099">12</span>, <span style="color:#099">5</span>)
</span></span><span style="display:flex;"><span>plt<span style="font-weight:bold">.</span>rcParams[<span style="color:#b84">&#39;figure.dpi&#39;</span>] <span style="font-weight:bold">=</span> <span style="color:#099">150</span>
</span></span><span style="display:flex;"><span>pd<span style="font-weight:bold">.</span>set_option(<span style="color:#b84">&#39;max_row&#39;</span>, <span style="color:#099">10</span>)
</span></span><span style="display:flex;"><span>pd<span style="font-weight:bold">.</span>set_option(<span style="color:#b84">&#39;display.max_columns&#39;</span>, <span style="color:#099">10</span>)
</span></span><span style="display:flex;"><span>pd<span style="font-weight:bold">.</span>set_option(<span style="color:#b84">&#39;display.width&#39;</span>, <span style="color:#099">1000</span>)
</span></span><span style="display:flex;"><span>warnings<span style="font-weight:bold">.</span>filterwarnings(<span style="color:#b84">&#39;ignore&#39;</span>)
</span></span></code></pre></div><h2 id="data-crawling">Data Crawling</h2>
<p><strong>News Data</strong></p>
<p>We crawl all posts from <a href="http://www.coindesk.com">CoinDesk</a>. The crawling scripts are included in <a href="#toc_12">Appendix A</a>. We have news data from 2013-04-15 to 2019-05-02 (latest by the time of drafting). Entries are <code>title</code>, <code>abstract</code> and <code>contents</code>.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>df <span style="font-weight:bold">=</span> pd<span style="font-weight:bold">.</span>read_csv(<span style="color:#b84">&#39;data/posts.csv&#39;</span>, index_col<span style="font-weight:bold">=</span><span style="color:#099">0</span>)
</span></span><span style="display:flex;"><span>df<span style="font-weight:bold">.</span>index <span style="font-weight:bold">=</span> pd<span style="font-weight:bold">.</span>to_datetime(df<span style="font-weight:bold">.</span>index)<span style="font-weight:bold">.</span>date
</span></span><span style="display:flex;"><span>display(HTML(df<span style="font-weight:bold">.</span>to_html(max_rows<span style="font-weight:bold">=</span><span style="color:#099">10</span>)))
</span></span></code></pre></div><table>
<thead>
<tr>
<th>date</th>
<th>title</th>
<th>abstract</th>
<th>content</th>
</tr>
</thead>
<tbody>
<tr>
<td>2013-04-15</td>
<td>‘Zerocoin’ widget promises Bitcoin privacy</td>
<td>Researchers at Johns Hopkins University are pr&hellip;</td>
<td>Researchers at Johns Hopkins University are pr&hellip;</td>
</tr>
<tr>
<td>2013-04-16</td>
<td>OpenCoin aims to build a better digital currency</td>
<td>Digital currency promises to solve some proble&hellip;</td>
<td>Digital currency promises to solve some proble&hellip;</td>
</tr>
<tr>
<td>2013-04-16</td>
<td>Meet the money behind bitcoin competitor OpenCoin</td>
<td>At first glance, especially to a digital curre&hellip;</td>
<td>At first glance, especially to a digital curre&hellip;</td>
</tr>
<tr>
<td>2013-04-17</td>
<td>$500k in funding paves way for bitcoin trading</td>
<td>New York City-based bitcoin startup Coinsetter&hellip;</td>
<td>New York City-based bitcoin startup Coinsetter&hellip;</td>
</tr>
<tr>
<td>2013-04-22</td>
<td>Argentina trades $50k of bitcoins</td>
<td>A record $50,000 of bitcoins were traded in Ar&hellip;</td>
<td>A record $50,000 of bitcoins were traded in Ar&hellip;</td>
</tr>
<tr>
<td>&hellip;</td>
<td>&hellip;</td>
<td>&hellip;</td>
<td>&hellip;</td>
</tr>
<tr>
<td>2019-05-01</td>
<td>CoinMarketCap Forms Alliance to Tackle Concern&hellip;</td>
<td>Crypto data provider CoinMarketCap is working &hellip;</td>
<td>Cryptocurrency data provider CoinMarketCap is &hellip;</td>
</tr>
<tr>
<td>2019-05-01</td>
<td>Techstars-Backed Alkemi Enters DeFi Race With &hellip;</td>
<td>This new startup wants to plug exchanges, fund&hellip;</td>
<td>A new type of decentralized finance (DeFi) app&hellip;</td>
</tr>
<tr>
<td>2019-05-02</td>
<td>When Tether Warnings Are Marketing Tools</td>
<td>Stablecoin issuers are taking advantage of Tet&hellip;</td>
<td>“We’re in a scary place, because if Tether’s p&hellip;</td>
</tr>
<tr>
<td>2019-05-02</td>
<td>3 Price Hurdles That Could Complicate a Bitcoi&hellip;</td>
<td>Bitcoin is on the offensive, having defended k&hellip;</td>
<td>Bitcoin (BTC) is on the offensive, having defe&hellip;</td>
</tr>
<tr>
<td>2019-05-02</td>
<td>Diamond Standard Launches Blockchain-Powered T&hellip;</td>
<td>A new startup is looking to make diamonds as a&hellip;</td>
<td>As a store of value, diamonds have their advan&hellip;</td>
</tr>
</tbody>
</table>
<p><strong>EOD Price &amp; Market Cap Data</strong></p>
<p>Also, we crawl the <a href="https://coinmarketcap.com">CoinMarketCap</a> for historical EOD data of over 10 major coins. Only daily close prices and market caps are kept. See <a href="#toc_13">Appendix B</a><a id='abback'></a> for codes. Cryptocurrency market is 24/7, for the purpose of this research, we define daily close price as the price at 24:00:00 UTC.</p>
<h2 id="data-preparation">Data Preparation</h2>
<p><strong>Step 0</strong>: Group up post (news) data by dates.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>df_eod <span style="font-weight:bold">=</span> df<span style="font-weight:bold">.</span>copy()
</span></span><span style="display:flex;"><span>df_eod[<span style="color:#b84">&#39;date&#39;</span>] <span style="font-weight:bold">=</span> pd<span style="font-weight:bold">.</span>to_datetime(df_eod<span style="font-weight:bold">.</span>index)<span style="font-weight:bold">.</span>date
</span></span><span style="display:flex;"><span>g <span style="font-weight:bold">=</span> df_eod<span style="font-weight:bold">.</span>groupby(<span style="color:#b84">&#39;date&#39;</span>)
</span></span><span style="display:flex;"><span>title <span style="font-weight:bold">=</span> g<span style="font-weight:bold">.</span>title<span style="font-weight:bold">.</span>apply(<span style="color:#b84">&#39; &#39;</span><span style="font-weight:bold">.</span>join)
</span></span><span style="display:flex;"><span>abstract <span style="font-weight:bold">=</span> g<span style="font-weight:bold">.</span>abstract<span style="font-weight:bold">.</span>apply(<span style="color:#b84">&#39; &#39;</span><span style="font-weight:bold">.</span>join)
</span></span><span style="display:flex;"><span>content <span style="font-weight:bold">=</span> g<span style="font-weight:bold">.</span>content<span style="font-weight:bold">.</span>apply(<span style="font-weight:bold">lambda</span> x: <span style="color:#b84">&#39;</span><span style="color:#b84">\n\n</span><span style="color:#b84">&#39;</span><span style="font-weight:bold">.</span>join(<span style="color:#999">map</span>(<span style="color:#999">str</span>, x<span style="font-weight:bold">.</span>values)))
</span></span><span style="display:flex;"><span>df_eod <span style="font-weight:bold">=</span> pd<span style="font-weight:bold">.</span>concat([title, abstract, content], axis<span style="font-weight:bold">=</span><span style="color:#099">1</span>)
</span></span><span style="display:flex;"><span>df_eod<span style="font-weight:bold">.</span>index <span style="font-weight:bold">=</span> pd<span style="font-weight:bold">.</span>to_datetime(df_eod<span style="font-weight:bold">.</span>index)
</span></span><span style="display:flex;"><span>df_eod<span style="font-weight:bold">.</span>index<span style="font-weight:bold">.</span>name <span style="font-weight:bold">=</span> <span style="font-weight:bold">None</span>
</span></span><span style="display:flex;"><span>display(HTML(df_eod<span style="font-weight:bold">.</span>to_html(max_rows<span style="font-weight:bold">=</span><span style="color:#099">10</span>)))
</span></span></code></pre></div><table>
<thead>
<tr>
<th>date</th>
<th>title</th>
<th>abstract</th>
<th>content</th>
</tr>
</thead>
<tbody>
<tr>
<td>2013-04-15</td>
<td>‘Zerocoin’ widget promises Bitcoin privacy</td>
<td>Researchers at Johns Hopkins University are pr&hellip;</td>
<td>Researchers at Johns Hopkins University are pr&hellip;</td>
</tr>
<tr>
<td>2013-04-16</td>
<td>OpenCoin aims to build a better digital curren&hellip;</td>
<td>Digital currency promises to solve some proble&hellip;</td>
<td>Digital currency promises to solve some proble&hellip;</td>
</tr>
<tr>
<td>2013-04-17</td>
<td>$500k in funding paves way for bitcoin trading</td>
<td>New York City-based bitcoin startup Coinsetter&hellip;</td>
<td>New York City-based bitcoin startup Coinsetter&hellip;</td>
</tr>
<tr>
<td>2013-04-22</td>
<td>Argentina trades $50k of bitcoins Bitcoin pric&hellip;</td>
<td>A record $50,000 of bitcoins were traded in Ar&hellip;</td>
<td>A record $50,000 of bitcoins were traded in Ar&hellip;</td>
</tr>
<tr>
<td>2013-04-23</td>
<td>Mt Gox CEO on Bitcoin’s future Alt-currency fi&hellip;</td>
<td>Mark Karpeles gives a great explanation of how&hellip;</td>
<td>Mark Karpeles gives a great explanation of how&hellip;</td>
</tr>
<tr>
<td>&hellip;</td>
<td>&hellip;</td>
<td>&hellip;</td>
<td>&hellip;</td>
</tr>
<tr>
<td>2019-04-26</td>
<td>How Crypto Markets Are Reacting to the Tether-&hellip;</td>
<td>The crypto markets endured a loss of as much a&hellip;</td>
<td>The cryptocurrency markets endured a loss of a&hellip;</td>
</tr>
<tr>
<td>2019-04-29</td>
<td>US Stock Broker E*Trade to Launch Bitcoin and &hellip;</td>
<td>Online stock brokerage E*Trade is preparing to&hellip;</td>
<td>Online stock brokerage E*Trade Financial is sa&hellip;</td>
</tr>
<tr>
<td>2019-04-30</td>
<td>Want to Understand Bitfinex? Understand Mt. Go&hellip;</td>
<td>People interested in understanding Bitfinex ar&hellip;</td>
<td>Daniel Cawrey is chief executive officer of Pa&hellip;</td>
</tr>
<tr>
<td>2019-05-01</td>
<td>Where Crypto Exchanges Are Beating the Bear Ma&hellip;</td>
<td>Turkish exchanges OKEx and BtcTurk are onboard&hellip;</td>
<td>With the Turkish lira dropping to a six-month &hellip;</td>
</tr>
<tr>
<td>2019-05-02</td>
<td>When Tether Warnings Are Marketing Tools 3 Pri&hellip;</td>
<td>Stablecoin issuers are taking advantage of Tet&hellip;</td>
<td>“We’re in a scary place, because if Tether’s p&hellip;</td>
</tr>
</tbody>
</table>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#999">print</span>(df_eod<span style="font-weight:bold">.</span>iloc[<span style="color:#099">0</span>]<span style="font-weight:bold">.</span>content)
</span></span></code></pre></div><pre><code>Researchers at Johns Hopkins University are proposing a cryptographic extension to bitcoin that could enable fully anonymous transactions on the network. The extension, called Zerocoin, works – as NewScientist explains it – by “allowing bitcoin users to leave their coins floating on the network for someone else to redeem, on the condition that they can redeem the same amount of bitcoin, similarly left floating on the network, at an arbitrary time in the future.”
</code></pre>
<p><strong>Step 1</strong>: Get everything in its lowercase (if possible).</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>df_eod<span style="font-weight:bold">.</span>title <span style="font-weight:bold">=</span> df_eod<span style="font-weight:bold">.</span>title<span style="font-weight:bold">.</span>str<span style="font-weight:bold">.</span>lower()
</span></span><span style="display:flex;"><span>df_eod<span style="font-weight:bold">.</span>abstract <span style="font-weight:bold">=</span> df_eod<span style="font-weight:bold">.</span>abstract<span style="font-weight:bold">.</span>str<span style="font-weight:bold">.</span>lower()
</span></span><span style="display:flex;"><span>df_eod<span style="font-weight:bold">.</span>content <span style="font-weight:bold">=</span> df_eod<span style="font-weight:bold">.</span>content<span style="font-weight:bold">.</span>str<span style="font-weight:bold">.</span>lower()
</span></span><span style="display:flex;"><span>display(HTML(df_eod<span style="font-weight:bold">.</span>to_html(max_rows<span style="font-weight:bold">=</span><span style="color:#099">10</span>)))
</span></span></code></pre></div><table>
<thead>
<tr>
<th>date</th>
<th>title</th>
<th>abstract</th>
<th>content</th>
</tr>
</thead>
<tbody>
<tr>
<td>2013-04-15</td>
<td>‘zerocoin’ widget promises bitcoin privacy</td>
<td>researchers at johns hopkins university are pr&hellip;</td>
<td>researchers at johns hopkins university are pr&hellip;</td>
</tr>
<tr>
<td>2013-04-16</td>
<td>opencoin aims to build a better digital curren&hellip;</td>
<td>digital currency promises to solve some proble&hellip;</td>
<td>digital currency promises to solve some proble&hellip;</td>
</tr>
<tr>
<td>2013-04-17</td>
<td>$500k in funding paves way for bitcoin trading</td>
<td>new york city-based bitcoin startup coinsetter&hellip;</td>
<td>new york city-based bitcoin startup coinsetter&hellip;</td>
</tr>
<tr>
<td>2013-04-22</td>
<td>argentina trades $50k of bitcoins bitcoin pric&hellip;</td>
<td>a record $50,000 of bitcoins were traded in ar&hellip;</td>
<td>a record $50,000 of bitcoins were traded in ar&hellip;</td>
</tr>
<tr>
<td>2013-04-23</td>
<td>mt gox ceo on bitcoin’s future alt-currency fi&hellip;</td>
<td>mark karpeles gives a great explanation of how&hellip;</td>
<td>mark karpeles gives a great explanation of how&hellip;</td>
</tr>
<tr>
<td>&hellip;</td>
<td>&hellip;</td>
<td>&hellip;</td>
<td>&hellip;</td>
</tr>
<tr>
<td>2019-04-26</td>
<td>how crypto markets are reacting to the tether-&hellip;</td>
<td>the crypto markets endured a loss of as much a&hellip;</td>
<td>the cryptocurrency markets endured a loss of a&hellip;</td>
</tr>
<tr>
<td>2019-04-29</td>
<td>us stock broker e*trade to launch bitcoin and &hellip;</td>
<td>online stock brokerage e*trade is preparing to&hellip;</td>
<td>online stock brokerage e*trade financial is sa&hellip;</td>
</tr>
<tr>
<td>2019-04-30</td>
<td>want to understand bitfinex? understand mt. go&hellip;</td>
<td>people interested in understanding bitfinex ar&hellip;</td>
<td>daniel cawrey is chief executive officer of pa&hellip;</td>
</tr>
<tr>
<td>2019-05-01</td>
<td>where crypto exchanges are beating the bear ma&hellip;</td>
<td>turkish exchanges okex and btcturk are onboard&hellip;</td>
<td>with the turkish lira dropping to a six-month &hellip;</td>
</tr>
<tr>
<td>2019-05-02</td>
<td>when tether warnings are marketing tools 3 pri&hellip;</td>
<td>stablecoin issuers are taking advantage of tet&hellip;</td>
<td>“we’re in a scary place, because if tether’s p&hellip;</td>
</tr>
</tbody>
</table>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#999">print</span>(df_eod<span style="font-weight:bold">.</span>iloc[<span style="color:#099">0</span>]<span style="font-weight:bold">.</span>content)
</span></span></code></pre></div><pre><code>researchers at johns hopkins university are proposing a cryptographic extension to bitcoin that could enable fully anonymous transactions on the network. the extension, called zerocoin, works – as newscientist explains it – by “allowing bitcoin users to leave their coins floating on the network for someone else to redeem, on the condition that they can redeem the same amount of bitcoin, similarly left floating on the network, at an arbitrary time in the future.”
</code></pre>
<p><strong>Step 2</strong>: Remove trivial abbreviations starting with <code>'</code> e.g. <code>'s</code>, <code>'ll</code>. Join all <code>\n</code> (paragraphs).</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>remove_abbr <span style="font-weight:bold">=</span> <span style="font-weight:bold">lambda</span> x: <span style="color:#b84">&#39; &#39;</span><span style="font-weight:bold">.</span>join([_<span style="font-weight:bold">.</span>split(<span style="color:#b84">&#39;’&#39;</span>)[<span style="color:#099">0</span>] <span style="font-weight:bold">for</span> _ <span style="font-weight:bold">in</span> x<span style="font-weight:bold">.</span>split()])
</span></span><span style="display:flex;"><span>df_eod <span style="font-weight:bold">=</span> df_eod<span style="font-weight:bold">.</span>applymap(remove_abbr)
</span></span><span style="display:flex;"><span>display(HTML(df_eod<span style="font-weight:bold">.</span>to_html(max_rows<span style="font-weight:bold">=</span><span style="color:#099">10</span>)))
</span></span></code></pre></div><table>
<thead>
<tr>
<th>date</th>
<th>title</th>
<th>abstract</th>
<th>content</th>
</tr>
</thead>
<tbody>
<tr>
<td>2013-04-15</td>
<td>‘zerocoin widget promises bitcoin privacy</td>
<td>researchers at johns hopkins university are pr&hellip;</td>
<td>researchers at johns hopkins university are pr&hellip;</td>
</tr>
<tr>
<td>2013-04-16</td>
<td>opencoin aims to build a better digital curren&hellip;</td>
<td>digital currency promises to solve some proble&hellip;</td>
<td>digital currency promises to solve some proble&hellip;</td>
</tr>
<tr>
<td>2013-04-17</td>
<td>$500k in funding paves way for bitcoin trading</td>
<td>new york city-based bitcoin startup coinsetter&hellip;</td>
<td>new york city-based bitcoin startup coinsetter&hellip;</td>
</tr>
<tr>
<td>2013-04-22</td>
<td>argentina trades $50k of bitcoins bitcoin pric&hellip;</td>
<td>a record $50,000 of bitcoins were traded in ar&hellip;</td>
<td>a record $50,000 of bitcoins were traded in ar&hellip;</td>
</tr>
<tr>
<td>2013-04-23</td>
<td>mt gox ceo on bitcoin future alt-currency firm&hellip;</td>
<td>mark karpeles gives a great explanation of how&hellip;</td>
<td>mark karpeles gives a great explanation of how&hellip;</td>
</tr>
<tr>
<td>&hellip;</td>
<td>&hellip;</td>
<td>&hellip;</td>
<td>&hellip;</td>
</tr>
<tr>
<td>2019-04-26</td>
<td>how crypto markets are reacting to the tether-&hellip;</td>
<td>the crypto markets endured a loss of as much a&hellip;</td>
<td>the cryptocurrency markets endured a loss of a&hellip;</td>
</tr>
<tr>
<td>2019-04-29</td>
<td>us stock broker e*trade to launch bitcoin and &hellip;</td>
<td>online stock brokerage e*trade is preparing to&hellip;</td>
<td>online stock brokerage e*trade financial is sa&hellip;</td>
</tr>
<tr>
<td>2019-04-30</td>
<td>want to understand bitfinex? understand mt. go&hellip;</td>
<td>people interested in understanding bitfinex ar&hellip;</td>
<td>daniel cawrey is chief executive officer of pa&hellip;</td>
</tr>
<tr>
<td>2019-05-01</td>
<td>where crypto exchanges are beating the bear ma&hellip;</td>
<td>turkish exchanges okex and btcturk are onboard&hellip;</td>
<td>with the turkish lira dropping to a six-month &hellip;</td>
</tr>
<tr>
<td>2019-05-02</td>
<td>when tether warnings are marketing tools 3 pri&hellip;</td>
<td>stablecoin issuers are taking advantage of tet&hellip;</td>
<td>“we in a scary place, because if tether pretty&hellip;</td>
</tr>
</tbody>
</table>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#999">print</span>(df_eod<span style="font-weight:bold">.</span>iloc[<span style="color:#099">0</span>]<span style="font-weight:bold">.</span>content)
</span></span></code></pre></div><pre><code>researchers at johns hopkins university are proposing a cryptographic extension to bitcoin that could enable fully anonymous transactions on the network. the extension, called zerocoin, works – as newscientist explains it – by “allowing bitcoin users to leave their coins floating on the network for someone else to redeem, on the condition that they can redeem the same amount of bitcoin, similarly left floating on the network, at an arbitrary time in the future.”
</code></pre>
<p><strong>Step 3</strong>: Keep only alphabetical symbols.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>alph_space <span style="font-weight:bold">=</span> <span style="font-weight:bold">lambda</span> x: (<span style="color:#999">ord</span>(<span style="color:#b84">&#39;a&#39;</span>) <span style="font-weight:bold">&lt;=</span> <span style="color:#999">ord</span>(x) <span style="font-weight:bold">&lt;=</span> <span style="color:#999">ord</span>(<span style="color:#b84">&#39;z&#39;</span>)) <span style="font-weight:bold">or</span> x <span style="font-weight:bold">==</span> <span style="color:#b84">&#39; &#39;</span>
</span></span><span style="display:flex;"><span>keep_alph <span style="font-weight:bold">=</span> <span style="font-weight:bold">lambda</span> x: <span style="color:#b84">&#39;&#39;</span><span style="font-weight:bold">.</span>join(<span style="color:#999">filter</span>(alph_space, x))
</span></span><span style="display:flex;"><span>df_eod <span style="font-weight:bold">=</span> df_eod<span style="font-weight:bold">.</span>applymap(keep_alph)
</span></span><span style="display:flex;"><span>display(HTML(df_eod<span style="font-weight:bold">.</span>to_html(max_rows<span style="font-weight:bold">=</span><span style="color:#099">10</span>)))
</span></span></code></pre></div><table>
<thead>
<tr>
<th>date</th>
<th>title</th>
<th>abstract</th>
<th>content</th>
</tr>
</thead>
<tbody>
<tr>
<td>2013-04-15</td>
<td>zerocoin widget promises bitcoin privacy</td>
<td>researchers at johns hopkins university are pr&hellip;</td>
<td>researchers at johns hopkins university are pr&hellip;</td>
</tr>
<tr>
<td>2013-04-16</td>
<td>opencoin aims to build a better digital curren&hellip;</td>
<td>digital currency promises to solve some proble&hellip;</td>
<td>digital currency promises to solve some proble&hellip;</td>
</tr>
<tr>
<td>2013-04-17</td>
<td>k in funding paves way for bitcoin trading</td>
<td>new york citybased bitcoin startup coinsetter &hellip;</td>
<td>new york citybased bitcoin startup coinsetter &hellip;</td>
</tr>
<tr>
<td>2013-04-22</td>
<td>argentina trades k of bitcoins bitcoin prices &hellip;</td>
<td>a record  of bitcoins were traded in argentina&hellip;</td>
<td>a record  of bitcoins were traded in argentina&hellip;</td>
</tr>
<tr>
<td>2013-04-23</td>
<td>mt gox ceo on bitcoin future altcurrency firm &hellip;</td>
<td>mark karpeles gives a great explanation of how&hellip;</td>
<td>mark karpeles gives a great explanation of how&hellip;</td>
</tr>
<tr>
<td>&hellip;</td>
<td>&hellip;</td>
<td>&hellip;</td>
<td>&hellip;</td>
</tr>
<tr>
<td>2019-04-26</td>
<td>how crypto markets are reacting to the tetherb&hellip;</td>
<td>the crypto markets endured a loss of as much a&hellip;</td>
<td>the cryptocurrency markets endured a loss of a&hellip;</td>
</tr>
<tr>
<td>2019-04-29</td>
<td>us stock broker etrade to launch bitcoin and e&hellip;</td>
<td>online stock brokerage etrade is preparing to &hellip;</td>
<td>online stock brokerage etrade financial is sai&hellip;</td>
</tr>
<tr>
<td>2019-04-30</td>
<td>want to understand bitfinex understand mt gox &hellip;</td>
<td>people interested in understanding bitfinex ar&hellip;</td>
<td>daniel cawrey is chief executive officer of pa&hellip;</td>
</tr>
<tr>
<td>2019-05-01</td>
<td>where crypto exchanges are beating the bear ma&hellip;</td>
<td>turkish exchanges okex and btcturk are onboard&hellip;</td>
<td>with the turkish lira dropping to a sixmonth l&hellip;</td>
</tr>
<tr>
<td>2019-05-02</td>
<td>when tether warnings are marketing tools  pric&hellip;</td>
<td>stablecoin issuers are taking advantage of tet&hellip;</td>
<td>we in a scary place because if tether pretty s&hellip;</td>
</tr>
</tbody>
</table>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#999">print</span>(df_eod<span style="font-weight:bold">.</span>iloc[<span style="color:#099">0</span>]<span style="font-weight:bold">.</span>content)
</span></span></code></pre></div><pre><code>researchers at johns hopkins university are proposing a cryptographic extension to bitcoin that could enable fully anonymous transactions on the network the extension called zerocoin works  as newscientist explains it  by allowing bitcoin users to leave their coins floating on the network for someone else to redeem on the condition that they can redeem the same amount of bitcoin similarly left floating on the network at an arbitrary time in the future
</code></pre>
<p><strong>Step 4</strong>: Remove all prepositions and other auxiliary words (aka &ldquo;stop words&rdquo; in NLP).</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>replace_stop_words <span style="font-weight:bold">=</span> <span style="font-weight:bold">lambda</span> x: <span style="color:#b84">&#39; &#39;</span><span style="font-weight:bold">.</span>join(_ <span style="font-weight:bold">for</span> _ <span style="font-weight:bold">in</span> x<span style="font-weight:bold">.</span>split() <span style="font-weight:bold">if</span> _ <span style="font-weight:bold">not</span> <span style="font-weight:bold">in</span> STOPWORDS)    
</span></span><span style="display:flex;"><span>df_eod <span style="font-weight:bold">=</span> df_eod<span style="font-weight:bold">.</span>applymap(replace_stop_words)
</span></span><span style="display:flex;"><span>display(HTML(df_eod<span style="font-weight:bold">.</span>to_html(max_rows<span style="font-weight:bold">=</span><span style="color:#099">10</span>)))
</span></span></code></pre></div><table>
<thead>
<tr>
<th>date</th>
<th>title</th>
<th>abstract</th>
<th>content</th>
</tr>
</thead>
<tbody>
<tr>
<td>2013-04-15</td>
<td>zerocoin widget promises bitcoin privacy</td>
<td>researchers johns hopkins university proposing&hellip;</td>
<td>researchers johns hopkins university proposing&hellip;</td>
</tr>
<tr>
<td>2013-04-16</td>
<td>opencoin aims build better digital currency me&hellip;</td>
<td>digital currency promises solve problems real &hellip;</td>
<td>digital currency promises solve problems real &hellip;</td>
</tr>
<tr>
<td>2013-04-17</td>
<td>funding paves way bitcoin trading</td>
<td>new york citybased bitcoin startup coinsetter &hellip;</td>
<td>new york citybased bitcoin startup coinsetter &hellip;</td>
</tr>
<tr>
<td>2013-04-22</td>
<td>argentina trades bitcoins bitcoin prices yoyo &hellip;</td>
<td>record bitcoins traded argentina second week a&hellip;</td>
<td>record bitcoins traded argentina second week a&hellip;</td>
</tr>
<tr>
<td>2013-04-23</td>
<td>mt gox ceo bitcoin future altcurrency firm biz&hellip;</td>
<td>mark karpeles gives great explanation foot bit&hellip;</td>
<td>mark karpeles gives great explanation foot bit&hellip;</td>
</tr>
<tr>
<td>&hellip;</td>
<td>&hellip;</td>
<td>&hellip;</td>
<td>&hellip;</td>
</tr>
<tr>
<td>2019-04-26</td>
<td>crypto markets reacting tetherbitfinex allegat&hellip;</td>
<td>crypto markets endured loss much billion aroun&hellip;</td>
<td>cryptocurrency markets endured loss much billi&hellip;</td>
</tr>
<tr>
<td>2019-04-29</td>
<td>us stock broker etrade launch bitcoin ether tr&hellip;</td>
<td>online stock brokerage etrade preparing launch&hellip;</td>
<td>online stock brokerage etrade financial said p&hellip;</td>
</tr>
<tr>
<td>2019-04-30</td>
<td>want understand bitfinex understand mt gox bit&hellip;</td>
<td>people interested understanding bitfinex wells&hellip;</td>
<td>daniel cawrey chief executive officer pactum c&hellip;</td>
</tr>
<tr>
<td>2019-05-01</td>
<td>crypto exchanges beating bear market digging d&hellip;</td>
<td>turkish exchanges okex btcturk onboarding thou&hellip;</td>
<td>turkish lira dropping sixmonth low dollar last&hellip;</td>
</tr>
<tr>
<td>2019-05-02</td>
<td>tether warnings marketing tools price hurdles &hellip;</td>
<td>stablecoin issuers taking advantage tethers tr&hellip;</td>
<td>scary place tether pretty systematically embed&hellip;</td>
</tr>
</tbody>
</table>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#999">print</span>(df_eod<span style="font-weight:bold">.</span>iloc[<span style="color:#099">0</span>]<span style="font-weight:bold">.</span>content)
</span></span></code></pre></div><pre><code>researchers johns hopkins university proposing cryptographic extension bitcoin enable fully anonymous transactions network extension called zerocoin works newscientist explains allowing bitcoin users leave coins floating network someone redeem condition redeem amount bitcoin similarly left floating network arbitrary time future
</code></pre>
<p><strong>Step 5</strong>: Convert dataframe entries into lists (or &ldquo;bags&rdquo;) of words</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>df_eod <span style="font-weight:bold">=</span> df_eod<span style="font-weight:bold">.</span>applymap(<span style="color:#999">str</span><span style="font-weight:bold">.</span>split)<span style="font-weight:bold">.</span>applymap(<span style="color:#999">sorted</span>)
</span></span><span style="display:flex;"><span>display(HTML(df_eod<span style="font-weight:bold">.</span>to_html(max_rows<span style="font-weight:bold">=</span><span style="color:#099">10</span>)))
</span></span></code></pre></div><table>
<thead>
<tr>
<th>date</th>
<th>title</th>
<th>abstract</th>
<th>content</th>
</tr>
</thead>
<tbody>
<tr>
<td>2013-04-15</td>
<td>[bitcoin, privacy, promises, widget, zerocoin]</td>
<td>[anonymous, bitcoin, cryptographic, enable, ex&hellip;</td>
<td>[allowing, amount, anonymous, arbitrary, bitco&hellip;</td>
</tr>
<tr>
<td>2013-04-16</td>
<td>[aims, behind, better, bitcoin, build, competi&hellip;</td>
<td>[among, beyond, bitcoin, currency, currency, d&hellip;</td>
<td>[abound, accepts, according, actually, advanta&hellip;</td>
</tr>
<tr>
<td>2013-04-17</td>
<td>[bitcoin, funding, paves, trading, way]</td>
<td>[bitcoin, citybased, closing, coinsetter, firs&hellip;</td>
<td>[barry, ben, bitcoin, bitcoin, bitcoin, bitcoi&hellip;</td>
</tr>
<tr>
<td>2013-04-22</td>
<td>[argentina, bitcoin, bitcoins, bites, bitfloor&hellip;</td>
<td>[account, alternative, ancient, announcing, ap&hellip;</td>
<td>[able, abroad, according, account, account, ac&hellip;</td>
</tr>
<tr>
<td>2013-04-23</td>
<td>[altcurrency, bitcoin, bizx, ceo, firm, future&hellip;</td>
<td>[alternative, bitcoin, bitcoin, bizx, buzz, co&hellip;</td>
<td>[accelerator, access, account, account, accoun&hellip;</td>
</tr>
<tr>
<td>&hellip;</td>
<td>&hellip;</td>
<td>&hellip;</td>
<td>&hellip;</td>
</tr>
<tr>
<td>2019-04-26</td>
<td>[allegations, bitfinex, cfo, crypto, funds, ma&hellip;</td>
<td>[allegations, around, attorney, billion, bitfi&hellip;</td>
<td>[access, according, according, according, acco&hellip;</td>
</tr>
<tr>
<td>2019-04-29</td>
<td>[aims, bid, bitcoin, bitcoin, bounce, broker, &hellip;</td>
<td>[according, bitcoins, bleak, bloomberg, broker&hellip;</td>
<td>[abort, access, according, according, accordin&hellip;</td>
</tr>
<tr>
<td>2019-04-30</td>
<td>[adding, bitcoin, bitfinex, bitfinex, closes, &hellip;</td>
<td>[according, adding, aspiring, bitcoin, bitcoin&hellip;</td>
<td>[able, able, acceptance, acceptance, access, a&hellip;</td>
</tr>
<tr>
<td>2019-05-01</td>
<td>[alkemi, alliance, april, bear, beating, bigge&hellip;</td>
<td>[ago, aimed, april, argues, bitcoin, bitwise, &hellip;</td>
<td>[access, access, accessible, according, accord&hellip;</td>
</tr>
<tr>
<td>2019-05-02</td>
<td>[backed, bitcoin, blockchainpowered, complicat&hellip;</td>
<td>[advantage, alternates, attractive, bitcoin, c&hellip;</td>
<td>[able, aborted, access, accompanied, according&hellip;</td>
</tr>
</tbody>
</table>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#999">print</span>(df_eod<span style="font-weight:bold">.</span>iloc[<span style="color:#099">0</span>]<span style="font-weight:bold">.</span>content)
</span></span></code></pre></div><pre><code>['allowing', 'amount', 'anonymous', 'arbitrary', 'bitcoin', 'bitcoin', 'bitcoin', 'called', 'coins', 'condition', 'cryptographic', 'enable', 'explains', 'extension', 'extension', 'floating', 'floating', 'fully', 'future', 'hopkins', 'johns', 'leave', 'left', 'network', 'network', 'network', 'newscientist', 'proposing', 'redeem', 'redeem', 'researchers', 'similarly', 'someone', 'time', 'transactions', 'university', 'users', 'works', 'zerocoin']
</code></pre>
<h1 id="the-hybrid-model">The Hybrid Model</h1>
<p>In this part we&rsquo;ll introduce and implement the so-called hybrid model. We mainly follow the algorithm introduced in <a href="#kkx2019">Ke, Kelly and Xiu (2019)</a><a id='kkx2019back'></a>. To keep consistency, we use the same notations as used in the paper. In their paper, the underlying assets are stocks; and news data for stocks, unlike them for cryptocurrency, are abundant. To tailor the model without compromising the virtues of it, we keep the algorithm of the model but modify the definitions slightly. In the paper, <code>$p$</code> is defined as the sentiment score of an article; in our research, we define <code>$p$</code> to be the sentiment score of all the articles in a day.
<code>$\bs{O}^+$</code> and <code>$\bs{O}^-$</code> are the distributions of the positive and negative sentiment topics respectively in the paper. We instead use them to represent the positive and negative sentiment topics in a day.</p>
<p>First let&rsquo;s take a look at the price data.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>price <span style="font-weight:bold">=</span> pd<span style="font-weight:bold">.</span>read_csv(<span style="color:#b84">&#39;data/price.csv&#39;</span>, index_col<span style="font-weight:bold">=</span><span style="color:#099">0</span>)
</span></span><span style="display:flex;"><span>price<span style="font-weight:bold">.</span>index <span style="font-weight:bold">=</span> pd<span style="font-weight:bold">.</span>to_datetime(price<span style="font-weight:bold">.</span>index)
</span></span><span style="display:flex;"><span>display(HTML(price<span style="font-weight:bold">.</span>to_html(max_rows<span style="font-weight:bold">=</span><span style="color:#099">10</span>)))
</span></span></code></pre></div><table>
<thead>
<tr>
<th>date</th>
<th>BTC</th>
<th>DOGE</th>
<th>FTC</th>
<th>IXC</th>
<th>LTC</th>
<th>MEC</th>
<th>NMC</th>
<th>NVC</th>
<th>NXT</th>
<th>OMNI</th>
<th>PPC</th>
<th>XPM</th>
<th>XRP</th>
</tr>
</thead>
<tbody>
<tr>
<td>2013-12-24</td>
<td>665.58</td>
<td>0.000686</td>
<td>0.272888</td>
<td>0.122467</td>
<td>17.64</td>
<td>0.496110</td>
<td>4.130000</td>
<td>12.050000</td>
<td>0.038054</td>
<td>107.16</td>
<td>3.320000</td>
<td>2.220000</td>
<td>0.022575</td>
</tr>
<tr>
<td>2013-12-25</td>
<td>682.21</td>
<td>0.000587</td>
<td>0.286528</td>
<td>0.115989</td>
<td>21.15</td>
<td>0.534457</td>
<td>4.630000</td>
<td>12.930000</td>
<td>0.064458</td>
<td>132.42</td>
<td>3.460000</td>
<td>2.340000</td>
<td>0.022042</td>
</tr>
<tr>
<td>2013-12-26</td>
<td>761.98</td>
<td>0.000602</td>
<td>0.365750</td>
<td>0.129925</td>
<td>24.76</td>
<td>0.838330</td>
<td>5.330000</td>
<td>14.360000</td>
<td>0.084504</td>
<td>186.70</td>
<td>3.980000</td>
<td>2.750000</td>
<td>0.024385</td>
</tr>
<tr>
<td>2013-12-27</td>
<td>735.07</td>
<td>0.000522</td>
<td>0.338132</td>
<td>0.126579</td>
<td>23.27</td>
<td>0.852615</td>
<td>4.840000</td>
<td>13.640000</td>
<td>0.071800</td>
<td>181.66</td>
<td>3.810000</td>
<td>2.570000</td>
<td>0.027076</td>
</tr>
<tr>
<td>2013-12-28</td>
<td>727.83</td>
<td>0.000459</td>
<td>0.334802</td>
<td>0.120077</td>
<td>22.56</td>
<td>0.816654</td>
<td>4.810000</td>
<td>13.430000</td>
<td>0.060045</td>
<td>170.10</td>
<td>4.250000</td>
<td>2.580000</td>
<td>0.027303</td>
</tr>
<tr>
<td>&hellip;</td>
<td>&hellip;</td>
<td>&hellip;</td>
<td>&hellip;</td>
<td>&hellip;</td>
<td>&hellip;</td>
<td>&hellip;</td>
<td>&hellip;</td>
<td>&hellip;</td>
<td>&hellip;</td>
<td>&hellip;</td>
<td>&hellip;</td>
<td>&hellip;</td>
<td>&hellip;</td>
</tr>
<tr>
<td>2019-05-16</td>
<td>7884.91</td>
<td>0.003168</td>
<td>0.023343</td>
<td>0.022766</td>
<td>95.59</td>
<td>0.008262</td>
<td>0.384813</td>
<td>0.808549</td>
<td>0.036080</td>
<td>2.77</td>
<td>0.392510</td>
<td>0.246049</td>
<td>0.419707</td>
</tr>
<tr>
<td>2019-05-17</td>
<td>7343.90</td>
<td>0.002962</td>
<td>0.019941</td>
<td>0.022766</td>
<td>89.00</td>
<td>0.008841</td>
<td>0.384493</td>
<td>0.755183</td>
<td>0.032642</td>
<td>2.62</td>
<td>0.383351</td>
<td>0.231594</td>
<td>0.386193</td>
</tr>
<tr>
<td>2019-05-18</td>
<td>7271.21</td>
<td>0.003005</td>
<td>0.020308</td>
<td>0.022766</td>
<td>86.70</td>
<td>0.007275</td>
<td>0.547807</td>
<td>0.745842</td>
<td>0.032121</td>
<td>2.35</td>
<td>0.390182</td>
<td>0.230064</td>
<td>0.372736</td>
</tr>
<tr>
<td>2019-05-19</td>
<td>8197.69</td>
<td>0.003178</td>
<td>0.022818</td>
<td>0.022766</td>
<td>95.32</td>
<td>0.008361</td>
<td>0.659869</td>
<td>0.840955</td>
<td>0.034374</td>
<td>2.47</td>
<td>0.442125</td>
<td>0.265329</td>
<td>0.417700</td>
</tr>
<tr>
<td>2019-05-20</td>
<td>7978.31</td>
<td>0.003041</td>
<td>0.021786</td>
<td>0.015150</td>
<td>91.49</td>
<td>0.007867</td>
<td>0.583019</td>
<td>0.823103</td>
<td>0.032977</td>
<td>2.32</td>
<td>0.424123</td>
<td>0.237132</td>
<td>0.398003</td>
</tr>
</tbody>
</table>
<p>And below is the market cap data.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>mkcap <span style="font-weight:bold">=</span> pd<span style="font-weight:bold">.</span>read_csv(<span style="color:#b84">&#39;data/mkcap.csv&#39;</span>, index_col<span style="font-weight:bold">=</span><span style="color:#099">0</span>)
</span></span><span style="display:flex;"><span>mkcap<span style="font-weight:bold">.</span>index <span style="font-weight:bold">=</span> pd<span style="font-weight:bold">.</span>to_datetime(mkcap<span style="font-weight:bold">.</span>index)
</span></span><span style="display:flex;"><span>display(HTML(mkcap<span style="font-weight:bold">.</span>to_html(max_rows<span style="font-weight:bold">=</span><span style="color:#099">10</span>, float_format<span style="font-weight:bold">=</span><span style="color:#b84">&#39;</span><span style="color:#b84">%.4g</span><span style="color:#b84">&#39;</span>)))
</span></span></code></pre></div><table>
<thead>
<tr>
<th>date</th>
<th>BTC</th>
<th>DOGE</th>
<th>FTC</th>
<th>IXC</th>
<th>LTC</th>
<th>MEC</th>
<th>NMC</th>
<th>NVC</th>
<th>NXT</th>
<th>OMNI</th>
<th>PPC</th>
<th>XPM</th>
<th>XRP</th>
</tr>
</thead>
<tbody>
<tr>
<td>2013-12-24</td>
<td>8.1e+09</td>
<td>9.076e+06</td>
<td>7.476e+06</td>
<td>2.115e+06</td>
<td>4.275e+08</td>
<td>1.063e+07</td>
<td>3.133e+07</td>
<td>6.412e+06</td>
<td>3.805e+07</td>
<td>6.638e+07</td>
<td>6.962e+07</td>
<td>8.238e+06</td>
<td>1.765e+08</td>
</tr>
<tr>
<td>2013-12-25</td>
<td>8.305e+09</td>
<td>8.194e+06</td>
<td>7.885e+06</td>
<td>2.005e+06</td>
<td>5.131e+08</td>
<td>1.146e+07</td>
<td>3.515e+07</td>
<td>6.898e+06</td>
<td>6.446e+07</td>
<td>8.203e+07</td>
<td>7.252e+07</td>
<td>8.73e+06</td>
<td>1.723e+08</td>
</tr>
<tr>
<td>2013-12-26</td>
<td>9.28e+09</td>
<td>8.837e+06</td>
<td>1.01e+07</td>
<td>2.249e+06</td>
<td>6.014e+08</td>
<td>1.798e+07</td>
<td>4.046e+07</td>
<td>7.681e+06</td>
<td>8.45e+07</td>
<td>1.157e+08</td>
<td>8.341e+07</td>
<td>1.03e+07</td>
<td>1.906e+08</td>
</tr>
<tr>
<td>2013-12-27</td>
<td>8.955e+09</td>
<td>8.017e+06</td>
<td>9.38e+06</td>
<td>2.193e+06</td>
<td>5.661e+08</td>
<td>1.83e+07</td>
<td>3.684e+07</td>
<td>7.309e+06</td>
<td>7.18e+07</td>
<td>1.125e+08</td>
<td>7.986e+07</td>
<td>9.642e+06</td>
<td>2.117e+08</td>
</tr>
<tr>
<td>2013-12-28</td>
<td>8.87e+09</td>
<td>7.374e+06</td>
<td>9.328e+06</td>
<td>2.082e+06</td>
<td>5.496e+08</td>
<td>1.754e+07</td>
<td>3.662e+07</td>
<td>7.216e+06</td>
<td>6.005e+07</td>
<td>1.054e+08</td>
<td>8.917e+07</td>
<td>9.746e+06</td>
<td>2.135e+08</td>
</tr>
<tr>
<td>&hellip;</td>
<td>&hellip;</td>
<td>&hellip;</td>
<td>&hellip;</td>
<td>&hellip;</td>
<td>&hellip;</td>
<td>&hellip;</td>
<td>&hellip;</td>
<td>&hellip;</td>
<td>&hellip;</td>
<td>&hellip;</td>
<td>&hellip;</td>
<td>&hellip;</td>
<td>&hellip;</td>
</tr>
<tr>
<td>2019-05-16</td>
<td>1.396e+11</td>
<td>3.787e+08</td>
<td>5.543e+06</td>
<td>4.796e+05</td>
<td>5.908e+09</td>
<td>3.142e+05</td>
<td>5.671e+06</td>
<td>1.889e+06</td>
<td>3.604e+07</td>
<td>1.555e+06</td>
<td>9.953e+06</td>
<td>6.795e+06</td>
<td>1.768e+10</td>
</tr>
<tr>
<td>2019-05-17</td>
<td>1.3e+11</td>
<td>3.541e+08</td>
<td>4.737e+06</td>
<td>4.796e+05</td>
<td>5.502e+09</td>
<td>3.363e+05</td>
<td>5.666e+06</td>
<td>1.764e+06</td>
<td>3.261e+07</td>
<td>1.47e+06</td>
<td>9.722e+06</td>
<td>6.399e+06</td>
<td>1.627e+10</td>
</tr>
<tr>
<td>2019-05-18</td>
<td>1.288e+11</td>
<td>3.593e+08</td>
<td>4.827e+06</td>
<td>4.796e+05</td>
<td>5.361e+09</td>
<td>2.768e+05</td>
<td>8.073e+06</td>
<td>1.742e+06</td>
<td>3.209e+07</td>
<td>1.321e+06</td>
<td>9.895e+06</td>
<td>6.359e+06</td>
<td>1.57e+10</td>
</tr>
<tr>
<td>2019-05-19</td>
<td>1.452e+11</td>
<td>3.801e+08</td>
<td>5.426e+06</td>
<td>4.796e+05</td>
<td>5.895e+09</td>
<td>3.181e+05</td>
<td>9.724e+06</td>
<td>1.964e+06</td>
<td>3.434e+07</td>
<td>1.387e+06</td>
<td>1.121e+07</td>
<td>7.336e+06</td>
<td>1.76e+10</td>
</tr>
<tr>
<td>2019-05-20</td>
<td>1.413e+11</td>
<td>3.637e+08</td>
<td>5.183e+06</td>
<td>3.192e+05</td>
<td>5.66e+09</td>
<td>2.993e+05</td>
<td>8.592e+06</td>
<td>1.923e+06</td>
<td>3.294e+07</td>
<td>1.304e+06</td>
<td>1.076e+07</td>
<td>6.56e+06</td>
<td>1.676e+10</td>
</tr>
</tbody>
</table>
<h2 id="model-construction">Model Construction</h2>
<p>Now we construct the momentum strategy with <code>$n=3$</code> coins for both long and short sides, and a look-back window of <code>$d=60$</code> days to determine the best- and worst-performing coins. This type of classical strategies was popularized  before Richard Donchian, i.e. mid 20th century, and got rather prevalent around 2000 (<a href="#a2014">Antonacci, 2014</a><a id='a2014back'></a>). Due to the diminishing market cap of some coins, we limit our momentum strategy to hold only top 10 coins considering market caps. For more detailed analysis on the efficiency of momentum strategies in the cryptocurrency market, see <a href="#rso2017">Rohrbach, Suremann &amp; Osterrieder (2017)</a><a id='rso2017back'></a>.</p>
<p>The selected coins in the long and short positions are listed below (training part only), together with a histogram illustrating the empirical distribution of our momentum strategy. The table below the figure, which contains three entries, <code>words</code> (list of words on that day), <code>r</code> (momentum return) and <code>p</code> (rank score of <code>r</code>), is the result of our preliminary data preparation (training part only).</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>n, d <span style="font-weight:bold">=</span> <span style="color:#099">3</span>, <span style="color:#099">60</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>rtn <span style="font-weight:bold">=</span> price<span style="font-weight:bold">.</span>pct_change()<span style="font-weight:bold">.</span>fillna(<span style="color:#099">0</span>)
</span></span><span style="display:flex;"><span>rtn<span style="font-weight:bold">.</span>index<span style="font-weight:bold">.</span>name <span style="font-weight:bold">=</span> <span style="font-weight:bold">None</span>
</span></span><span style="display:flex;"><span>temp <span style="font-weight:bold">=</span> (rtn <span style="font-weight:bold">*</span> (mkcap<span style="font-weight:bold">.</span>agg(<span style="color:#b84">&#39;argsort&#39;</span>) <span style="font-weight:bold">&lt;</span> <span style="color:#099">10</span>))<span style="font-weight:bold">.</span>rolling(d)<span style="font-weight:bold">.</span>sum()<span style="font-weight:bold">.</span>T
</span></span><span style="display:flex;"><span>coins <span style="font-weight:bold">=</span> pd<span style="font-weight:bold">.</span>DataFrame(
</span></span><span style="display:flex;"><span>    [temp<span style="font-weight:bold">.</span>nlargest(n, t)<span style="font-weight:bold">.</span>index<span style="font-weight:bold">.</span>tolist() <span style="font-weight:bold">+</span>
</span></span><span style="display:flex;"><span>     temp<span style="font-weight:bold">.</span>nsmallest(n, t)<span style="font-weight:bold">.</span>index<span style="font-weight:bold">.</span>tolist() <span style="font-weight:bold">for</span> t <span style="font-weight:bold">in</span> rtn<span style="font-weight:bold">.</span>index],
</span></span><span style="display:flex;"><span>    index<span style="font-weight:bold">=</span>rtn<span style="font-weight:bold">.</span>index
</span></span><span style="display:flex;"><span>)<span style="font-weight:bold">.</span>shift()<span style="font-weight:bold">.</span>dropna()  <span style="color:#998;font-style:italic"># shift to avoid forward-looking bias</span>
</span></span><span style="display:flex;"><span>display(HTML(coins<span style="font-weight:bold">.</span>to_html(max_rows<span style="font-weight:bold">=</span><span style="color:#099">10</span>, header<span style="font-weight:bold">=</span><span style="font-weight:bold">False</span>)))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>coef <span style="font-weight:bold">=</span> np<span style="font-weight:bold">.</span>array([<span style="color:#099">1</span>] <span style="font-weight:bold">*</span> n <span style="font-weight:bold">+</span> [<span style="font-weight:bold">-</span><span style="color:#099">1</span>] <span style="font-weight:bold">*</span> n) <span style="font-weight:bold">/</span> n
</span></span><span style="display:flex;"><span>rtn <span style="font-weight:bold">=</span> pd<span style="font-weight:bold">.</span>DataFrame([rtn<span style="font-weight:bold">.</span>loc[t, coins<span style="font-weight:bold">.</span>loc[t]<span style="font-weight:bold">.</span>values] <span style="font-weight:bold">@</span> coef <span style="font-weight:bold">for</span> t <span style="font-weight:bold">in</span> coins<span style="font-weight:bold">.</span>index], index<span style="font-weight:bold">=</span>coins<span style="font-weight:bold">.</span>index)[<span style="color:#099">0</span>]
</span></span><span style="display:flex;"><span>rtn<span style="font-weight:bold">.</span>name <span style="font-weight:bold">=</span> <span style="color:#b84">&#39;r&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#999">print</span>(<span style="color:#b84">f</span><span style="color:#b84">&#39;Benchmark strategy has mean return </span><span style="color:#b84">{</span>rtn<span style="font-weight:bold">.</span>mean()<span style="color:#b84">:</span><span style="color:#b84">.2%</span><span style="color:#b84">}</span><span style="color:#b84"> with std </span><span style="color:#b84">{</span>rtn<span style="font-weight:bold">.</span>std()<span style="color:#b84">:</span><span style="color:#b84">.2f</span><span style="color:#b84">}</span><span style="color:#b84">&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>plt<span style="font-weight:bold">.</span>figure()
</span></span><span style="display:flex;"><span>plt<span style="font-weight:bold">.</span>plot(rtn)
</span></span><span style="display:flex;"><span>plt<span style="font-weight:bold">.</span>ylabel(<span style="color:#b84">&#39;Daily Returns&#39;</span>)
</span></span><span style="display:flex;"><span>plt<span style="font-weight:bold">.</span>axhline(y<span style="font-weight:bold">=</span><span style="color:#099">0</span>, color<span style="font-weight:bold">=</span><span style="color:#b84">&#39;w&#39;</span>, ls<span style="font-weight:bold">=</span><span style="color:#b84">&#39;--&#39;</span>)
</span></span><span style="display:flex;"><span>plt<span style="font-weight:bold">.</span>tight_layout()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>plt<span style="font-weight:bold">.</span>figure()
</span></span><span style="display:flex;"><span>bins <span style="font-weight:bold">=</span> np<span style="font-weight:bold">.</span>arange(<span style="font-weight:bold">-</span><span style="color:#099">.50</span>, <span style="color:#099">.55</span>, <span style="color:#099">.025</span>)
</span></span><span style="display:flex;"><span>heights, bins, patches <span style="font-weight:bold">=</span> plt<span style="font-weight:bold">.</span>hist(rtn, bins<span style="font-weight:bold">=</span>bins, edgecolor<span style="font-weight:bold">=</span><span style="color:#b84">&#39;k&#39;</span>, facecolor<span style="font-weight:bold">=</span><span style="color:#b84">&#39;deepskyblue&#39;</span>, density<span style="font-weight:bold">=</span><span style="font-weight:bold">True</span>)
</span></span><span style="display:flex;"><span><span style="font-weight:bold">for</span> p <span style="font-weight:bold">in</span> patches:
</span></span><span style="display:flex;"><span>    x <span style="font-weight:bold">=</span> <span style="color:#999">abs</span>(p<span style="font-weight:bold">.</span>get_bbox()<span style="font-weight:bold">.</span>get_points()<span style="font-weight:bold">.</span>mean(axis<span style="font-weight:bold">=</span><span style="color:#099">0</span>)[<span style="color:#099">0</span>]) <span style="font-weight:bold">*</span> <span style="color:#099">20</span>
</span></span><span style="display:flex;"><span>    p<span style="font-weight:bold">.</span>set_alpha(<span style="color:#099">1</span> <span style="font-weight:bold">if</span> x <span style="font-weight:bold">&lt;</span> <span style="color:#099">1</span> <span style="font-weight:bold">else</span> <span style="color:#099">1</span> <span style="font-weight:bold">/</span> x)
</span></span><span style="display:flex;"><span>plt<span style="font-weight:bold">.</span>ylabel(<span style="color:#b84">&#39;Density&#39;</span>)
</span></span><span style="display:flex;"><span>plt<span style="font-weight:bold">.</span>xlabel(<span style="color:#b84">&#39;Daily Returns&#39;</span>)
</span></span><span style="display:flex;"><span>plt<span style="font-weight:bold">.</span>tight_layout()
</span></span><span style="display:flex;"><span>plt<span style="font-weight:bold">.</span>show()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>df_total <span style="font-weight:bold">=</span> df_eod[[<span style="color:#b84">&#39;content&#39;</span>]]<span style="font-weight:bold">.</span>join(rtn, how<span style="font-weight:bold">=</span><span style="color:#b84">&#39;inner&#39;</span>)<span style="font-weight:bold">.</span>dropna()
</span></span><span style="display:flex;"><span>df_total[<span style="color:#b84">&#39;p&#39;</span>] <span style="font-weight:bold">=</span> np<span style="font-weight:bold">.</span>argsort(df_total<span style="font-weight:bold">.</span>iloc[:, <span style="color:#099">1</span>]) <span style="font-weight:bold">/</span> (df_total<span style="font-weight:bold">.</span>shape[<span style="color:#099">0</span>] <span style="font-weight:bold">-</span> <span style="color:#099">1</span>)
</span></span><span style="display:flex;"><span>df_total<span style="font-weight:bold">.</span>columns <span style="font-weight:bold">=</span> [<span style="color:#b84">&#39;words&#39;</span>, <span style="color:#b84">&#39;r&#39;</span>, <span style="color:#b84">&#39;p&#39;</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>test_split <span style="font-weight:bold">=</span> <span style="color:#099">0.3</span>
</span></span><span style="display:flex;"><span>len_total <span style="font-weight:bold">=</span> <span style="color:#999">len</span>(df_total)
</span></span><span style="display:flex;"><span>len_test <span style="font-weight:bold">=</span> <span style="color:#999">round</span>(len_total <span style="font-weight:bold">*</span> test_split)
</span></span><span style="display:flex;"><span>len_train <span style="font-weight:bold">=</span> len_total <span style="font-weight:bold">-</span> len_test
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>df_train <span style="font-weight:bold">=</span> df_total<span style="font-weight:bold">.</span>iloc[:len_train, :]
</span></span><span style="display:flex;"><span>df_test <span style="font-weight:bold">=</span> df_total<span style="font-weight:bold">.</span>iloc[<span style="font-weight:bold">-</span>len_test:, :]
</span></span><span style="display:flex;"><span>display(HTML(df_train<span style="font-weight:bold">.</span>to_html(max_rows<span style="font-weight:bold">=</span><span style="color:#099">10</span>)))
</span></span></code></pre></div><table>
<thead>
<tr>
<th>date</th>
<th>coin1</th>
<th>coin2</th>
<th>coin3</th>
<th>coin4</th>
<th>coin5</th>
<th>coin6</th>
</tr>
</thead>
<tbody>
<tr>
<td>2014-02-22</td>
<td>DOGE</td>
<td>NXT</td>
<td>OMNI</td>
<td>LTC</td>
<td>NVC</td>
<td>XRP</td>
</tr>
<tr>
<td>2014-02-23</td>
<td>DOGE</td>
<td>NXT</td>
<td>OMNI</td>
<td>LTC</td>
<td>NVC</td>
<td>XRP</td>
</tr>
<tr>
<td>2014-02-24</td>
<td>DOGE</td>
<td>NXT</td>
<td>OMNI</td>
<td>NVC</td>
<td>LTC</td>
<td>XRP</td>
</tr>
<tr>
<td>2014-02-25</td>
<td>DOGE</td>
<td>NXT</td>
<td>PPC</td>
<td>MEC</td>
<td>XRP</td>
<td>NVC</td>
</tr>
<tr>
<td>2014-02-26</td>
<td>DOGE</td>
<td>NXT</td>
<td>PPC</td>
<td>MEC</td>
<td>XRP</td>
<td>LTC</td>
</tr>
<tr>
<td>&hellip;</td>
<td>&hellip;</td>
<td>&hellip;</td>
<td>&hellip;</td>
<td>&hellip;</td>
<td>&hellip;</td>
<td>&hellip;</td>
</tr>
<tr>
<td>2019-05-16</td>
<td>IXC</td>
<td>BTC</td>
<td>FTC</td>
<td>NMC</td>
<td>PPC</td>
<td>XPM</td>
</tr>
<tr>
<td>2019-05-17</td>
<td>IXC</td>
<td>FTC</td>
<td>BTC</td>
<td>NMC</td>
<td>PPC</td>
<td>XPM</td>
</tr>
<tr>
<td>2019-05-18</td>
<td>IXC</td>
<td>BTC</td>
<td>FTC</td>
<td>NMC</td>
<td>PPC</td>
<td>XPM</td>
</tr>
<tr>
<td>2019-05-19</td>
<td>IXC</td>
<td>BTC</td>
<td>FTC</td>
<td>PPC</td>
<td>XPM</td>
<td>NMC</td>
</tr>
<tr>
<td>2019-05-20</td>
<td>IXC</td>
<td>BTC</td>
<td>FTC</td>
<td>PPC</td>
<td>XPM</td>
<td>NVC</td>
</tr>
</tbody>
</table>
<pre><code>Benchmark strategy has mean return 0.30% with std 0.12
</code></pre>
<img src="/images/cryptonews_30_2.png" style="width: 100%;"/>
<img src="/images/cryptonews_30_3.png" style="width: 100%;"/>
<table>
<thead>
<tr>
<th>date</th>
<th>words</th>
<th>r</th>
<th>p</th>
</tr>
</thead>
<tbody>
<tr>
<td>2014-02-22</td>
<td>[address, aggregators, along, amount, antinucl&hellip;</td>
<td>0.051496</td>
<td>0.961217</td>
</tr>
<tr>
<td>2014-02-23</td>
<td>[according, additional, akin, allocated, along&hellip;</td>
<td>-0.018420</td>
<td>0.236502</td>
</tr>
<tr>
<td>2014-02-24</td>
<td>[able, able, abolished, absence, accept, accep&hellip;</td>
<td>-0.005015</td>
<td>0.650951</td>
</tr>
<tr>
<td>2014-02-25</td>
<td>[abiding, abiding, able, able, abruptly, accel&hellip;</td>
<td>0.012776</td>
<td>0.842586</td>
</tr>
<tr>
<td>2014-02-26</td>
<td>[abandoned, able, able, able, able, abrupt, ac&hellip;</td>
<td>0.028932</td>
<td>0.525475</td>
</tr>
<tr>
<td>&hellip;</td>
<td>&hellip;</td>
<td>&hellip;</td>
<td>&hellip;</td>
</tr>
<tr>
<td>2017-12-12</td>
<td>[able, access, access, access, accessibility, &hellip;</td>
<td>-0.303756</td>
<td>0.006084</td>
</tr>
<tr>
<td>2017-12-13</td>
<td>[abort, accept, accept, accepts, according, ac&hellip;</td>
<td>0.008222</td>
<td>0.453232</td>
</tr>
<tr>
<td>2017-12-14</td>
<td>[according, according, accounts, acknowledge, &hellip;</td>
<td>-0.097781</td>
<td>0.657795</td>
</tr>
<tr>
<td>2017-12-15</td>
<td>[action, ahead, already, altcoins, alternative&hellip;</td>
<td>-0.058729</td>
<td>0.178707</td>
</tr>
<tr>
<td>2017-12-17</td>
<td>[accepted, accepting, access, accounts, accumu&hellip;</td>
<td>0.045690</td>
<td>0.218251</td>
</tr>
</tbody>
</table>
<p>Daily returns are positive for about half of the time and negative for the rest of the time. They follow a normal distribution with mean near 0.</p>
<p>Relative Strength Index (RSI) is a momentum indicator that measures the magnitude of recent price changes. Typically, RSIs above 70 or below 30 are considered overbought or oversold.
The plot below shows RSIs of the coins, the values lie in between 30 and 70 most of the time. From our understanding, it does not imply strong momentum, which also agrees with the return results above.
Because of the dissatisfying return results, we are motivated to make use of news data to help us determine our positions in the portfolio formed by the momentum strategy.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>upcloses <span style="font-weight:bold">=</span> <span style="font-weight:bold">lambda</span> x: x[x <span style="font-weight:bold">&gt;</span> <span style="color:#099">0</span>]<span style="font-weight:bold">.</span>mean()
</span></span><span style="display:flex;"><span>downcloses <span style="font-weight:bold">=</span> <span style="font-weight:bold">lambda</span> x: <span style="font-weight:bold">-</span>x[x <span style="font-weight:bold">&lt;</span> <span style="color:#099">0</span>]<span style="font-weight:bold">.</span>mean()
</span></span><span style="display:flex;"><span>rsi <span style="font-weight:bold">=</span> <span style="color:#099">100</span> <span style="font-weight:bold">-</span> <span style="color:#099">100</span> <span style="font-weight:bold">/</span> (<span style="color:#099">1</span> <span style="font-weight:bold">+</span> price<span style="font-weight:bold">.</span>pct_change()<span style="font-weight:bold">.</span>fillna(<span style="color:#099">0</span>)<span style="font-weight:bold">.</span>rolling(<span style="color:#099">60</span>)<span style="font-weight:bold">.</span>apply(upcloses) <span style="font-weight:bold">/</span> \
</span></span><span style="display:flex;"><span>                   price<span style="font-weight:bold">.</span>pct_change()<span style="font-weight:bold">.</span>fillna(<span style="color:#099">0</span>)<span style="font-weight:bold">.</span>rolling(<span style="color:#099">60</span>)<span style="font-weight:bold">.</span>apply(downcloses))
</span></span><span style="display:flex;"><span>display(HTML(rsi<span style="font-weight:bold">.</span>dropna()<span style="font-weight:bold">.</span>to_html(max_rows<span style="font-weight:bold">=</span><span style="color:#099">10</span>, header<span style="font-weight:bold">=</span><span style="font-weight:bold">True</span>)))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>fig <span style="font-weight:bold">=</span> plt<span style="font-weight:bold">.</span>figure()
</span></span><span style="display:flex;"><span>ax <span style="font-weight:bold">=</span> fig<span style="font-weight:bold">.</span>add_subplot(<span style="color:#099">111</span>)
</span></span><span style="display:flex;"><span>ax<span style="font-weight:bold">.</span>set_ylabel(<span style="color:#b84">&#39;Relative Strength Index&#39;</span>)
</span></span><span style="display:flex;"><span><span style="font-weight:bold">for</span> c <span style="font-weight:bold">in</span> rsi<span style="font-weight:bold">.</span>columns:
</span></span><span style="display:flex;"><span>    rsi[c]<span style="font-weight:bold">.</span>dropna()<span style="font-weight:bold">.</span>plot(ax<span style="font-weight:bold">=</span>ax, label<span style="font-weight:bold">=</span>c, linewidth<span style="font-weight:bold">=</span><span style="color:#099">1</span>)
</span></span><span style="display:flex;"><span>legend <span style="font-weight:bold">=</span> plt<span style="font-weight:bold">.</span>legend(frameon<span style="font-weight:bold">=</span><span style="font-weight:bold">False</span>, ncol<span style="font-weight:bold">=</span><span style="color:#099">7</span>, loc<span style="font-weight:bold">=</span><span style="color:#b84">&#39;center left&#39;</span>, bbox_to_anchor<span style="font-weight:bold">=</span>(<span style="color:#099">0</span>, <span style="color:#099">1.08</span>))
</span></span><span style="display:flex;"><span>ax<span style="font-weight:bold">.</span>axhline(y<span style="font-weight:bold">=</span><span style="color:#099">70</span>, ls<span style="font-weight:bold">=</span><span style="color:#b84">&#39;--&#39;</span>, color<span style="font-weight:bold">=</span><span style="color:#b84">&#39;w&#39;</span>)
</span></span><span style="display:flex;"><span>ax<span style="font-weight:bold">.</span>axhline(y<span style="font-weight:bold">=</span><span style="color:#099">30</span>, ls<span style="font-weight:bold">=</span><span style="color:#b84">&#39;--&#39;</span>, color<span style="font-weight:bold">=</span><span style="color:#b84">&#39;w&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>plt<span style="font-weight:bold">.</span>setp(legend<span style="font-weight:bold">.</span>get_texts(), color<span style="font-weight:bold">=</span><span style="color:#b84">&#39;k&#39;</span>, size<span style="font-weight:bold">=</span><span style="color:#099">10</span>)
</span></span><span style="display:flex;"><span>plt<span style="font-weight:bold">.</span>xticks(rotation<span style="font-weight:bold">=</span><span style="color:#099">0</span>, ha<span style="font-weight:bold">=</span><span style="color:#b84">&#39;center&#39;</span>)
</span></span><span style="display:flex;"><span>plt<span style="font-weight:bold">.</span>show()
</span></span></code></pre></div><table>
<thead>
<tr>
<th>date</th>
<th>BTC</th>
<th>DOGE</th>
<th>FTC</th>
<th>IXC</th>
<th>LTC</th>
<th>MEC</th>
<th>NMC</th>
<th>NVC</th>
<th>NXT</th>
<th>OMNI</th>
<th>PPC</th>
<th>XPM</th>
<th>XRP</th>
</tr>
</thead>
<tbody>
<tr>
<td>2014-02-21</td>
<td>49.058925</td>
<td>65.156681</td>
<td>53.862094</td>
<td>47.657728</td>
<td>52.325117</td>
<td>54.570707</td>
<td>51.521608</td>
<td>45.433964</td>
<td>62.574567</td>
<td>56.648806</td>
<td>58.893839</td>
<td>51.256646</td>
<td>54.260447</td>
</tr>
<tr>
<td>2014-02-22</td>
<td>49.522637</td>
<td>64.596253</td>
<td>53.460666</td>
<td>48.032722</td>
<td>52.782995</td>
<td>56.676395</td>
<td>51.591070</td>
<td>45.009183</td>
<td>62.061175</td>
<td>57.091294</td>
<td>58.428030</td>
<td>51.131053</td>
<td>54.255182</td>
</tr>
<tr>
<td>2014-02-23</td>
<td>48.945374</td>
<td>65.151465</td>
<td>52.941467</td>
<td>48.025571</td>
<td>49.752735</td>
<td>55.938327</td>
<td>50.257133</td>
<td>43.981559</td>
<td>58.732269</td>
<td>56.156984</td>
<td>58.260900</td>
<td>50.581732</td>
<td>54.383604</td>
</tr>
<tr>
<td>2014-02-24</td>
<td>45.481897</td>
<td>65.836615</td>
<td>49.930642</td>
<td>46.876769</td>
<td>46.763598</td>
<td>48.205328</td>
<td>48.231589</td>
<td>42.018331</td>
<td>57.449330</td>
<td>53.390006</td>
<td>56.612380</td>
<td>47.974323</td>
<td>50.894997</td>
</tr>
<tr>
<td>2014-02-25</td>
<td>45.934169</td>
<td>66.236415</td>
<td>49.859535</td>
<td>45.478231</td>
<td>46.928958</td>
<td>49.006769</td>
<td>49.343941</td>
<td>42.250401</td>
<td>57.224469</td>
<td>53.054030</td>
<td>56.703915</td>
<td>48.377624</td>
<td>48.364130</td>
</tr>
<tr>
<td>&hellip;</td>
<td>&hellip;</td>
<td>&hellip;</td>
<td>&hellip;</td>
<td>&hellip;</td>
<td>&hellip;</td>
<td>&hellip;</td>
<td>&hellip;</td>
<td>&hellip;</td>
<td>&hellip;</td>
<td>&hellip;</td>
<td>&hellip;</td>
<td>&hellip;</td>
<td>&hellip;</td>
</tr>
<tr>
<td>2019-05-16</td>
<td>61.091263</td>
<td>61.702769</td>
<td>60.626529</td>
<td>60.119838</td>
<td>68.908869</td>
<td>57.451714</td>
<td>39.882253</td>
<td>61.219468</td>
<td>52.235643</td>
<td>52.792051</td>
<td>45.629136</td>
<td>64.855576</td>
<td>65.275916</td>
</tr>
<tr>
<td>2019-05-17</td>
<td>57.887408</td>
<td>61.331565</td>
<td>59.917963</td>
<td>59.276013</td>
<td>67.447653</td>
<td>58.057233</td>
<td>40.322335</td>
<td>59.049640</td>
<td>50.480915</td>
<td>53.292698</td>
<td>45.266453</td>
<td>64.395536</td>
<td>62.578782</td>
</tr>
<tr>
<td>2019-05-18</td>
<td>58.808677</td>
<td>61.532147</td>
<td>58.773376</td>
<td>59.728521</td>
<td>68.151764</td>
<td>56.264933</td>
<td>46.899272</td>
<td>60.010127</td>
<td>50.113854</td>
<td>53.579574</td>
<td>45.828418</td>
<td>65.141129</td>
<td>62.913106</td>
</tr>
<tr>
<td>2019-05-19</td>
<td>61.600190</td>
<td>61.397682</td>
<td>59.773348</td>
<td>59.821076</td>
<td>69.692913</td>
<td>57.514977</td>
<td>48.673904</td>
<td>62.446071</td>
<td>50.531950</td>
<td>52.962195</td>
<td>49.985647</td>
<td>65.180359</td>
<td>65.565234</td>
</tr>
<tr>
<td>2019-05-20</td>
<td>60.822707</td>
<td>60.249918</td>
<td>59.637880</td>
<td>58.087599</td>
<td>69.291624</td>
<td>57.013209</td>
<td>47.243223</td>
<td>62.012823</td>
<td>50.487780</td>
<td>53.777199</td>
<td>49.512879</td>
<td>64.345972</td>
<td>64.806905</td>
</tr>
</tbody>
</table>
<img src="/images/cryptonews_32_1.png" style="width: 100%;"/>
<p>Now we may finally start to implement the hybrid model. The algorithm is illustrated below. Instead of <code>title</code> or <code>abstract</code>, here we test on <code>content</code> directly. Contents contain more information than titles or abstracts only, thus enlarging our sample set.</p>
<p><strong>Step 0</strong>: Calculate the percentage of positive returns on each word <code>$f_j$</code>. Filter words occurring too infrequently. Keep only the top <code>$\alpha_+$</code> and bottom <code>$\alpha_-$</code> as the sentiment-charged words. Assume we have in total <code>$k$</code> such words.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>words_all <span style="font-weight:bold">=</span> <span style="color:#999">sorted</span>(<span style="color:#999">list</span>(<span style="color:#999">set</span>(w <span style="font-weight:bold">for</span> words <span style="font-weight:bold">in</span> df_train<span style="font-weight:bold">.</span>words <span style="font-weight:bold">for</span> w <span style="font-weight:bold">in</span> words)))
</span></span><span style="display:flex;"><span>n <span style="font-weight:bold">=</span> <span style="color:#999">len</span>(words_all)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>words_dict <span style="font-weight:bold">=</span> {w: [] <span style="font-weight:bold">for</span> w <span style="font-weight:bold">in</span> words_all}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="font-weight:bold">for</span> i <span style="font-weight:bold">in</span> <span style="color:#999">range</span>(df_train<span style="font-weight:bold">.</span>shape[<span style="color:#099">0</span>]):
</span></span><span style="display:flex;"><span>    words, r, _ <span style="font-weight:bold">=</span> df_train<span style="font-weight:bold">.</span>iloc[i]
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">for</span> w <span style="font-weight:bold">in</span> words:
</span></span><span style="display:flex;"><span>        words_dict[w]<span style="font-weight:bold">.</span>append(r <span style="font-weight:bold">&gt;</span> <span style="color:#099">0</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>words_df <span style="font-weight:bold">=</span> pd<span style="font-weight:bold">.</span>DataFrame({
</span></span><span style="display:flex;"><span>    <span style="color:#b84">&#39;word&#39;</span>: words_all,
</span></span><span style="display:flex;"><span>    <span style="color:#b84">&#39;r&#39;</span>: [np<span style="font-weight:bold">.</span>mean(words_dict[w]) <span style="font-weight:bold">for</span> w <span style="font-weight:bold">in</span> words_all],
</span></span><span style="display:flex;"><span>    <span style="color:#b84">&#39;k&#39;</span>: [<span style="color:#999">len</span>(words_dict[w]) <span style="font-weight:bold">for</span> w <span style="font-weight:bold">in</span> words_all]
</span></span><span style="display:flex;"><span>}, index<span style="font-weight:bold">=</span><span style="color:#999">range</span>(n))<span style="font-weight:bold">.</span>sort_values(by<span style="font-weight:bold">=</span><span style="color:#b84">&#39;r&#39;</span>)
</span></span><span style="display:flex;"><span>words_df <span style="font-weight:bold">=</span> words_df[words_df<span style="font-weight:bold">.</span>k <span style="font-weight:bold">&gt;=</span> <span style="color:#099">50</span>][words_df<span style="font-weight:bold">.</span>word<span style="font-weight:bold">.</span>apply(<span style="color:#999">len</span>) <span style="font-weight:bold">&gt;=</span> <span style="color:#099">5</span>]<span style="font-weight:bold">.</span>reset_index(drop<span style="font-weight:bold">=</span><span style="font-weight:bold">True</span>)
</span></span><span style="display:flex;"><span>words_df[<span style="color:#b84">&#39;p&#39;</span>] <span style="font-weight:bold">=</span> np<span style="font-weight:bold">.</span>argsort(words_df<span style="font-weight:bold">.</span>r) <span style="font-weight:bold">/</span> (<span style="color:#999">len</span>(words_df) <span style="font-weight:bold">-</span> <span style="color:#099">1</span>)
</span></span><span style="display:flex;"><span>display(HTML(words_df<span style="font-weight:bold">.</span>set_index(<span style="color:#b84">&#39;word&#39;</span>)<span style="font-weight:bold">.</span>T<span style="font-weight:bold">.</span>to_html(max_cols<span style="font-weight:bold">=</span><span style="color:#099">10</span>)))
</span></span></code></pre></div><table>
<thead>
<tr>
<th>word</th>
<th>alphapoint</th>
<th>korean</th>
<th>masters</th>
<th>argentina</th>
<th>wilson</th>
<th>&hellip;</th>
<th>mccaleb</th>
<th>atlas</th>
<th>coinjar</th>
<th>mintpal</th>
<th>steem</th>
</tr>
</thead>
<tbody>
<tr>
<td>r</td>
<td>0.117647</td>
<td>0.162500</td>
<td>0.178082</td>
<td>0.178571</td>
<td>0.187500</td>
<td>&hellip;</td>
<td>0.754717</td>
<td>0.796610</td>
<td>0.816901</td>
<td>0.826923</td>
<td>0.96</td>
</tr>
<tr>
<td>k</td>
<td>51.000000</td>
<td>80.000000</td>
<td>73.000000</td>
<td>56.000000</td>
<td>64.000000</td>
<td>&hellip;</td>
<td>53.000000</td>
<td>59.000000</td>
<td>71.000000</td>
<td>52.000000</td>
<td>50.00</td>
</tr>
<tr>
<td>p</td>
<td>0.000000</td>
<td>0.000516</td>
<td>0.001032</td>
<td>0.001548</td>
<td>0.002064</td>
<td>&hellip;</td>
<td>0.997936</td>
<td>0.998452</td>
<td>0.998968</td>
<td>0.999484</td>
<td>1.00</td>
</tr>
</tbody>
</table>
<p><strong>Step 1 (Training):</strong> For each date <code>$\newcommand{\bs}{\mathbf}\bs{d}_i = (d_{i,1}, d_{i,2},\ldots,d_{i,k})'$</code> where <code>$d_{i,j}$</code> is the count of sentiment-charged word <code>$w_j$</code> in this day, assume model</p>
<p>$$
\bs{d}<em>i \sim \text{Multinomial}\left[k, \textstyle{\sum</em>{j=1}^{k}} d_{i,j}, p_i \bs{O}^+ + (1 - p_i) \bs{O}^-\right].
$$</p>
<p>Where <code>$\bs{O}^+$</code> is a &ldquo;positive sentiment day&rdquo;, and describes expected counts of words in a maximally positive sentiment day (one for which <code>$p_i$</code> = 1). Likewise, <code>$\bs{O}^-$</code> is a &ldquo;negative sentiment day&rdquo; that describes the distribution of word probabilities in maximally negative days (those for which <code>$p_i$</code> = 0).</p>
<p>Calculate the rank scores of all days as <code>$p_i$</code>, then  estimate <code>$\bs{O}^+$</code> and <code>$\bs{O}^-$</code>.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>alpha <span style="font-weight:bold">=</span> <span style="color:#099">.1</span>
</span></span><span style="display:flex;"><span>pos_words <span style="font-weight:bold">=</span> words_df[words_df<span style="font-weight:bold">.</span>p <span style="font-weight:bold">&gt;</span> <span style="color:#099">1</span> <span style="font-weight:bold">-</span> alpha]<span style="font-weight:bold">.</span>word<span style="font-weight:bold">.</span>values<span style="font-weight:bold">.</span>tolist()
</span></span><span style="display:flex;"><span>neg_words <span style="font-weight:bold">=</span> words_df[words_df<span style="font-weight:bold">.</span>p <span style="font-weight:bold">&lt;</span> alpha]<span style="font-weight:bold">.</span>word<span style="font-weight:bold">.</span>values<span style="font-weight:bold">.</span>tolist()
</span></span><span style="display:flex;"><span><span style="color:#999">print</span>(<span style="color:#b84">f</span><span style="color:#b84">&#39;There are </span><span style="color:#b84">{</span><span style="color:#999">len</span>(pos_words)<span style="color:#b84">}</span><span style="color:#b84"> positive words, </span><span style="color:#b84">{</span><span style="color:#999">len</span>(neg_words)<span style="color:#b84">}</span><span style="color:#b84"> negative words&#39;</span>)
</span></span></code></pre></div><pre><code>There are 194 positive words, 194 negative words
</code></pre>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>font_path <span style="font-weight:bold">=</span> <span style="color:#b84">&#39;misc/Palatino.ttf&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>fig <span style="font-weight:bold">=</span> plt<span style="font-weight:bold">.</span>figure(figsize<span style="font-weight:bold">=</span>(<span style="color:#099">12</span>, <span style="color:#099">5</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>ax <span style="font-weight:bold">=</span> fig<span style="font-weight:bold">.</span>add_subplot(<span style="color:#099">121</span>)
</span></span><span style="display:flex;"><span>pos_cloud <span style="font-weight:bold">=</span> WordCloud(
</span></span><span style="display:flex;"><span>    width<span style="font-weight:bold">=</span><span style="color:#099">800</span>, height<span style="font-weight:bold">=</span><span style="color:#099">800</span>,
</span></span><span style="display:flex;"><span>    background_color<span style="font-weight:bold">=</span><span style="color:#b84">&#39;white&#39;</span>,
</span></span><span style="display:flex;"><span>    colormap<span style="font-weight:bold">=</span><span style="color:#b84">&#39;Greens&#39;</span>,
</span></span><span style="display:flex;"><span>    font_path<span style="font-weight:bold">=</span>font_path,
</span></span><span style="display:flex;"><span>    min_font_size<span style="font-weight:bold">=</span><span style="color:#099">10</span>,
</span></span><span style="display:flex;"><span>    random_state<span style="font-weight:bold">=</span><span style="color:#099">123</span>
</span></span><span style="display:flex;"><span>)<span style="font-weight:bold">.</span>generate(<span style="color:#b84">&#39; &#39;</span><span style="font-weight:bold">.</span>join(pos_words))
</span></span><span style="display:flex;"><span>plt<span style="font-weight:bold">.</span>imshow(pos_cloud)
</span></span><span style="display:flex;"><span>plt<span style="font-weight:bold">.</span>axis(<span style="color:#b84">&#39;off&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>ax <span style="font-weight:bold">=</span> fig<span style="font-weight:bold">.</span>add_subplot(<span style="color:#099">122</span>)
</span></span><span style="display:flex;"><span>neg_cloud <span style="font-weight:bold">=</span> WordCloud(
</span></span><span style="display:flex;"><span>    width<span style="font-weight:bold">=</span><span style="color:#099">800</span>, height<span style="font-weight:bold">=</span><span style="color:#099">800</span>,
</span></span><span style="display:flex;"><span>    background_color<span style="font-weight:bold">=</span><span style="color:#b84">&#39;white&#39;</span>,
</span></span><span style="display:flex;"><span>    colormap<span style="font-weight:bold">=</span><span style="color:#b84">&#39;Reds&#39;</span>,
</span></span><span style="display:flex;"><span>    font_path<span style="font-weight:bold">=</span>font_path,
</span></span><span style="display:flex;"><span>    min_font_size<span style="font-weight:bold">=</span><span style="color:#099">10</span>,
</span></span><span style="display:flex;"><span>    random_state<span style="font-weight:bold">=</span><span style="color:#099">123</span>
</span></span><span style="display:flex;"><span>)<span style="font-weight:bold">.</span>generate(<span style="color:#b84">&#39; &#39;</span><span style="font-weight:bold">.</span>join(neg_words))
</span></span><span style="display:flex;"><span>plt<span style="font-weight:bold">.</span>imshow(neg_cloud) 
</span></span><span style="display:flex;"><span>plt<span style="font-weight:bold">.</span>axis(<span style="color:#b84">&#39;off&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>plt<span style="font-weight:bold">.</span>tight_layout()
</span></span><span style="display:flex;"><span>plt<span style="font-weight:bold">.</span>show() 
</span></span></code></pre></div><img src="/images/cryptonews_37_0.png" style="width: 100%;"/>
<p>The generated positive and negative word sets are shown above. The bigger the word appears, the more positive or negative it is. Let&rsquo;s look at some examples:</p>
<p>The left green diagram gives all the positive words with <code>$p_i &gt; 1 - \alpha$</code>. The biggest word in the middle is &ldquo;profit&rdquo;. Most articles containing it express an optimistic view. Examples include &ldquo;generate a $150,000 profit in bitcoins&rdquo;, and &ldquo;taking profit from legitimate miners&rdquo;. Other positives words include &ldquo;boost&rdquo;, &ldquo;financing&rdquo;, and etc. &ldquo;Venture&rdquo;, which usually indicates risk, occupies the most space of the right red diagram.</p>
<p>We cannot deny the fact that the relationship between words and returns may be specious. Problems also occur when words such as &ldquo;not&rdquo; negate the meaning of sentences. But overall, the classification of words works well with sufficient rationale behind.</p>
<p>We can then estimate <code>$\bs{d}$</code>.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>keywords <span style="font-weight:bold">=</span> pos_words <span style="font-weight:bold">+</span> neg_words
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="font-weight:bold">def</span> <span style="color:#900;font-weight:bold">count_words</span>(words):
</span></span><span style="display:flex;"><span>    c <span style="font-weight:bold">=</span> Counter(words)
</span></span><span style="display:flex;"><span>    d <span style="font-weight:bold">=</span> [c[w] <span style="font-weight:bold">for</span> w <span style="font-weight:bold">in</span> keywords]
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">return</span> np<span style="font-weight:bold">.</span>array(d)
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>df_train[<span style="color:#b84">&#39;d&#39;</span>] <span style="font-weight:bold">=</span> df_train<span style="font-weight:bold">.</span>words<span style="font-weight:bold">.</span>apply(count_words)<span style="font-weight:bold">.</span>values
</span></span><span style="display:flex;"><span>display(HTML(df_train<span style="font-weight:bold">.</span>to_html(max_rows<span style="font-weight:bold">=</span><span style="color:#099">10</span>)))
</span></span></code></pre></div><table>
<thead>
<tr>
<th>date</th>
<th>words</th>
<th>r</th>
<th>p</th>
<th>d</th>
</tr>
</thead>
<tbody>
<tr>
<td>2014-02-22</td>
<td>[address, aggregators, along, amount, antinucl&hellip;</td>
<td>0.051496</td>
<td>0.961217</td>
<td>[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, &hellip;</td>
</tr>
<tr>
<td>2014-02-23</td>
<td>[according, additional, akin, allocated, along&hellip;</td>
<td>-0.018420</td>
<td>0.236502</td>
<td>[0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, &hellip;</td>
</tr>
<tr>
<td>2014-02-24</td>
<td>[able, able, abolished, absence, accept, accep&hellip;</td>
<td>-0.005015</td>
<td>0.650951</td>
<td>[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, &hellip;</td>
</tr>
<tr>
<td>2014-02-25</td>
<td>[abiding, abiding, able, able, abruptly, accel&hellip;</td>
<td>0.012776</td>
<td>0.842586</td>
<td>[0, 1, 0, 0, 0, 3, 0, 0, 0, 0, 0, 0, 0, 0, 1, &hellip;</td>
</tr>
<tr>
<td>2014-02-26</td>
<td>[abandoned, able, able, able, able, abrupt, ac&hellip;</td>
<td>0.028932</td>
<td>0.525475</td>
<td>[0, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 8, 0, 3, &hellip;</td>
</tr>
<tr>
<td>&hellip;</td>
<td>&hellip;</td>
<td>&hellip;</td>
<td>&hellip;</td>
<td>&hellip;</td>
</tr>
<tr>
<td>2017-12-12</td>
<td>[able, access, access, access, accessibility, &hellip;</td>
<td>-0.303756</td>
<td>0.006084</td>
<td>[0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, &hellip;</td>
</tr>
<tr>
<td>2017-12-13</td>
<td>[abort, accept, accept, accepts, according, ac&hellip;</td>
<td>0.008222</td>
<td>0.453232</td>
<td>[0, 1, 0, 0, 0, 0, 0, 2, 0, 0, 1, 0, 0, 0, 0, &hellip;</td>
</tr>
<tr>
<td>2017-12-14</td>
<td>[according, according, accounts, acknowledge, &hellip;</td>
<td>-0.097781</td>
<td>0.657795</td>
<td>[0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, &hellip;</td>
</tr>
<tr>
<td>2017-12-15</td>
<td>[action, ahead, already, altcoins, alternative&hellip;</td>
<td>-0.058729</td>
<td>0.178707</td>
<td>[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, &hellip;</td>
</tr>
<tr>
<td>2017-12-17</td>
<td>[accepted, accepting, access, accounts, accumu&hellip;</td>
<td>0.045690</td>
<td>0.218251</td>
<td>[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, &hellip;</td>
</tr>
</tbody>
</table>
<p>Now we estimate <code>$\newcommand{\d}{\text{d}}\bs{O}^{+/-}$</code> using <code>$\bs{d}$</code> and <code>$p$</code>.</p>
<p><strong>Estimation by MLE</strong>:</p>
<p>The likelihood is given by</p>
<p>$$
L(\bs{d};\bs{O^{+/-}}) \propto \textstyle{\prod_i\prod_{j=1}^k} [p_i O_j^+ + (1 - p_i) O_j^-]^{d_{i,j}}
$$</p>
<p>and thus the log-likelihood is</p>
<p>$$
LL(\bs{d};\bs{O^{+/-}}) = C + \textstyle{\sum_i \sum_{j=1}^k} d_{i,j} \log[p_i O_j^+ + (1 - p_i) O_j^-]
$$</p>
<p>where <code>$C$</code> is not a function of <code>$\bs{O}^{+/-}$</code>. Therefore, for each keyword <code>$w_h$</code>,</p>
<p>$$
\frac{\partial LL}{\partial O_h^+} =
\textstyle{\sum_i \sum_{j=1}^k} \frac{d_{i,j}p_i\mathbf{1}{j=h}}{p_i O_j^+ + (1 - p_i) O_j^-} =
\textstyle{\sum_i} \frac{d_{i,h}p_i}{p_i O_h^+ + (1 - p_i) O_h^-} &gt; 0
$$</p>
<p>and</p>
<p>$$
\frac{\partial LL}{\partial O_h^-} =
\textstyle{\sum_i \sum_{j=1}^k} \frac{d_{i,j}(1-p_i)\mathbf{1}{j=h}}{p_i O_j^+ + (1 - p_i) O_j^-} =
\textstyle{\sum_i} \frac{d_{i,h}(1-p_i)}{p_i O_h^+ + (1 - p_i) O_h^-} &gt; 0.
$$</p>
<p>The optimization problem, therefore, is</p>
<p>$$
\begin{align*}
\max_{\bs{O}^{+/-}}\ &amp; LL(\bs{d};\bs{O}^{+/-})\
\text{s.t. }         &amp; \textstyle{\sum_{j=1}^k} O_j^+ = \textstyle{\sum_{j=1}^k} O_j^- = 1\
&amp; O_j^+ \ge 0 ,\quad O_j^- \ge 0,\quad \forall 1 \le j \le k.
\end{align*}
$$</p>
<p>Instead of solving this problem using the <em>Karush-Kuhn-Tucker Conditions</em>, we may as well do the following transform: let</p>
<p>$$
O_j^{+/-}:=\exp(Q_j^{+/-})
$$</p>
<p>so that the unknowns are now <code>$Q_j^{+/-}\in\mathbb{R}$</code> and we no longer need any inequality constraints. The Lagrangian is</p>
<p>$$
f(\bs{Q}^{+/-}) = LL!\left[\bs{d};\exp(\bs{Q}^{+/-})\right] + \lambda^+!\left[1 - \textstyle{\sum_{j=1}^k} \exp(Q_j^+)\right] + \lambda^-!\left[1 - \textstyle{\sum_{j=1}^k} \exp(Q_j^-)\right]
$$</p>
<p>and the FOCs are <code>$2k$</code> equations</p>
<p>$$
0 = \frac{\partial f}{\partial Q_j^{+/-}} =
\frac{\partial LL}{\partial O_j^{+/-}}\frac{\d O_j^{+/-}}{\d Q_j^{+/-}} - \lambda^{+/-} \frac{\d O_j^{+/-}}{\d Q_j^{+/-}}. \quad (1 \le j \le k)
$$</p>
<p>The FOCs can be simplified into</p>
<p>$$
\frac{\partial LL}{\partial O_1^{+/-}} =
\frac{\partial LL}{\partial O_2^{+/-}} =
\cdots =
\frac{\partial LL}{\partial O_k^{+/-}} = \lambda^{+/-}
$$</p>
<p>which is still extremely hard to solve analytically.</p>
<p><strong>Estimation by Regression</strong>:</p>
<p>This method is proposed in <a href="#kkx2019">Ke, Kelly and Xiu (2019)</a><a id='kkx2019back'></a>.</p>
<p>Assume there&rsquo;re in total <code>$\newcommand{\T}{\mathsf{T}}n$</code> days. Define</p>
<p>$$
\bs{W} = \begin{bmatrix}
p_1 &amp; p_2 &amp; \cdots &amp; p_n\
1 - p_1 &amp; 1 - p_2 &amp; \cdots &amp; 1 - p_n\
\end{bmatrix}^\T
$$</p>
<p>and <code>$\bs{D} = \left(\hat{\bs{d}}_1, \hat{\bs{d}}_1, \cdots, \hat{\bs{d}}_n\right)^{\!\T}$</code> where <code>$\hat{\bs{d}}_i = \bs{d}_i / \textstyle{\sum_j} d_{i,j}$</code>. Then <code>$\bs{O}^{+/-}$</code> would be estimated by regressing <code>$\bs{D}$</code> on <code>$\bs{W}$</code>, namely</p>
<p>$$
\hat{\bs{O}}^{+/-} = (\bs{W}^\T \bs{W})^{-1} \bs{W}^\T \bs{D}.
$$</p>
<p>See proof of accuracy in the appendix of the paper.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="font-weight:bold">def</span> <span style="color:#900;font-weight:bold">print_array</span>(array):
</span></span><span style="display:flex;"><span>    <span style="color:#999">print</span>(np<span style="font-weight:bold">.</span>array2string(array)<span style="font-weight:bold">.</span>replace(<span style="color:#b84">&#39;[[&#39;</span>,<span style="color:#b84">&#39; [&#39;</span>)<span style="font-weight:bold">.</span>replace(<span style="color:#b84">&#39;]]&#39;</span>,<span style="color:#b84">&#39;]&#39;</span>))
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>p <span style="font-weight:bold">=</span> df_train<span style="font-weight:bold">.</span>p<span style="font-weight:bold">.</span>values
</span></span><span style="display:flex;"><span>W <span style="font-weight:bold">=</span> np<span style="font-weight:bold">.</span>vstack([p, <span style="color:#099">1</span> <span style="font-weight:bold">-</span> p])<span style="font-weight:bold">.</span>T
</span></span><span style="display:flex;"><span><span style="color:#999">print</span>(<span style="color:#b84">f</span><span style="color:#b84">&#39;W has shape </span><span style="color:#b84">{</span>W<span style="font-weight:bold">.</span>shape<span style="color:#b84">}</span><span style="color:#b84">:&#39;</span>)
</span></span><span style="display:flex;"><span>print_array(W)
</span></span></code></pre></div><pre><code>W has shape (921, 2):
 [0.96121673 0.03878327]
 [0.23650190 0.76349810]
 [0.65095057 0.34904943]
 ...
 [0.65779468 0.34220532]
 [0.17870722 0.82129278]
 [0.21825095 0.78174905]
</code></pre>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>D <span style="font-weight:bold">=</span> np<span style="font-weight:bold">.</span>vstack(df_train<span style="font-weight:bold">.</span>d<span style="font-weight:bold">.</span>values)
</span></span><span style="display:flex;"><span>D <span style="font-weight:bold">=</span> (D<span style="font-weight:bold">.</span>T <span style="font-weight:bold">/</span> D<span style="font-weight:bold">.</span>sum(axis<span style="font-weight:bold">=</span><span style="color:#099">1</span>))<span style="font-weight:bold">.</span>T
</span></span><span style="display:flex;"><span>D[np<span style="font-weight:bold">.</span>isnan(D)] <span style="font-weight:bold">=</span> <span style="color:#099">0</span>
</span></span><span style="display:flex;"><span><span style="color:#999">print</span>(<span style="color:#b84">f</span><span style="color:#b84">&#39;D has shape </span><span style="color:#b84">{</span>D<span style="font-weight:bold">.</span>shape<span style="color:#b84">}</span><span style="color:#b84">:&#39;</span>)
</span></span><span style="display:flex;"><span>print_array(D)
</span></span></code></pre></div><pre><code>D has shape (921, 388):
 [0.00000000 0.00000000 0.00000000 ... 0.00000000 0.06666667 0.00000000]
 [0.00000000 0.00000000 0.00000000 ... 0.00000000 0.00000000 0.00000000]
 [0.00000000 0.00000000 0.00000000 ... 0.00000000 0.00000000 0.00000000]
 ...
 [0.00000000 0.00000000 0.00000000 ... 0.00000000 0.00000000 0.00000000]
 [0.00000000 0.00000000 0.00000000 ... 0.00000000 0.00000000 0.00000000]
 [0.00000000 0.00000000 0.00000000 ... 0.00000000 0.00000000 0.01219512]
</code></pre>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>O_pos, O_neg <span style="font-weight:bold">=</span> np<span style="font-weight:bold">.</span>maximum(np<span style="font-weight:bold">.</span>linalg<span style="font-weight:bold">.</span>pinv(W<span style="font-weight:bold">.</span>T <span style="font-weight:bold">@</span> W) <span style="font-weight:bold">@</span> (W<span style="font-weight:bold">.</span>T <span style="font-weight:bold">@</span> D), <span style="color:#099">0</span>)
</span></span><span style="display:flex;"><span>O_pos <span style="font-weight:bold">=</span> (O_pos <span style="font-weight:bold">/</span> O_pos<span style="font-weight:bold">.</span>sum())
</span></span><span style="display:flex;"><span>O_neg <span style="font-weight:bold">=</span> (O_neg <span style="font-weight:bold">/</span> O_neg<span style="font-weight:bold">.</span>sum())
</span></span><span style="display:flex;"><span>O_pm <span style="font-weight:bold">=</span> np<span style="font-weight:bold">.</span>hstack([O_pos<span style="font-weight:bold">.</span>reshape(<span style="font-weight:bold">-</span><span style="color:#099">1</span>, <span style="color:#099">1</span>), O_neg<span style="font-weight:bold">.</span>reshape(<span style="font-weight:bold">-</span><span style="color:#099">1</span>, <span style="color:#099">1</span>)])
</span></span><span style="display:flex;"><span><span style="color:#999">print</span>(<span style="color:#b84">f</span><span style="color:#b84">&#39;O± has shape </span><span style="color:#b84">{</span>O_pm<span style="font-weight:bold">.</span>shape<span style="color:#b84">}</span><span style="color:#b84">:&#39;</span>)
</span></span><span style="display:flex;"><span>print_array(O_pm)
</span></span></code></pre></div><pre><code>O± has shape (388, 2):
 [0.00188745 0.00293239]
 [0.00111679 0.00332143]
 [0.00349693 0.00450815]
 ...
 [0.00396731 0.00174460]
 [0.00407812 0.00318298]
 [0.00753035 0.00733650]
</code></pre>
<p>Now that we have already estimated <code>$\bs{O}^{+/-}$</code>, we can start predicting out-of-sample <code>$p$</code>, which indicates the expected rank of performance of a certain day. We&rsquo;re solving <code>$p$</code> from the following optimization problem</p>
<div>
$$
\hat{p} = \arg\!\max_{p\in[0,1]} \left\{\sum_{j=1}^k \hat{d}_j \log\!\left[p O_j^+ + (1 - p) O_j^-\right] + \lambda \log\left[p(1-p)\right]  \right\}
$$
</div>
<p>where <code>$\hat{\bs{d}}=\bs{d} / \textstyle{\sum_j}d_j$</code> like defined above, and <code>$\lambda&gt;0$</code> is a hyper-parameter for tuning. Let&rsquo;s call it the penalized log-likelihood <code>pen_ll</code>.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="font-weight:bold">def</span> <span style="color:#900;font-weight:bold">pen_ll</span>(p, d, lamda):
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">return</span> (d <span style="font-weight:bold">*</span> np<span style="font-weight:bold">.</span>log(p <span style="font-weight:bold">*</span> O_pos <span style="font-weight:bold">+</span> (<span style="color:#099">1</span> <span style="font-weight:bold">-</span> p) <span style="font-weight:bold">*</span> O_neg))<span style="font-weight:bold">.</span>sum() <span style="font-weight:bold">+</span> lamda <span style="font-weight:bold">*</span> np<span style="font-weight:bold">.</span>log(p <span style="font-weight:bold">*</span> (<span style="color:#099">1</span> <span style="font-weight:bold">-</span> p))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="font-weight:bold">def</span> <span style="color:#900;font-weight:bold">predict</span>(d, lamda):
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">return</span> minimize(<span style="font-weight:bold">lambda</span> p: <span style="font-weight:bold">-</span>pen_ll(p, d, lamda), x0<span style="font-weight:bold">=</span><span style="color:#099">.5</span>, method<span style="font-weight:bold">=</span><span style="color:#b84">&#39;Nelder-Mead&#39;</span>)<span style="font-weight:bold">.</span>x[<span style="color:#099">0</span>]
</span></span></code></pre></div><p>Tune <code>$\lambda$</code> using training set:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="font-weight:bold">def</span> <span style="color:#900;font-weight:bold">mse_p</span>(lamda):
</span></span><span style="display:flex;"><span>    p_hat <span style="font-weight:bold">=</span> np<span style="font-weight:bold">.</span>array([predict(d, lamda) <span style="font-weight:bold">for</span> d <span style="font-weight:bold">in</span> df_train<span style="font-weight:bold">.</span>d])
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">return</span> ((df_train<span style="font-weight:bold">.</span>p<span style="font-weight:bold">.</span>values <span style="font-weight:bold">-</span> p_hat)<span style="font-weight:bold">**</span><span style="color:#099">2</span>)<span style="font-weight:bold">.</span>mean()
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>best_lamda <span style="font-weight:bold">=</span> minimize(mse_p, x0<span style="font-weight:bold">=</span><span style="color:#099">0</span>, method<span style="font-weight:bold">=</span><span style="color:#b84">&#39;Nelder-Mead&#39;</span>, bounds<span style="font-weight:bold">=</span>(<span style="color:#099">0</span>, <span style="font-weight:bold">None</span>))<span style="font-weight:bold">.</span>x[<span style="color:#099">0</span>]
</span></span><span style="display:flex;"><span>best_lamda
</span></span></code></pre></div><pre><code>3.6398125000000046
</code></pre>
<p><strong>Step 2 (Testing)</strong>: For each date <code>$\bs{d}_i$</code> observed and <code>$\bs{O}^{+/-}$</code> fixed, estimate <code>$p_i$</code> as our final indicator. Specifically, we here use the best <code>$\lambda$</code> we just estimated above to predict the testing set.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>df_test[<span style="color:#b84">&#39;d&#39;</span>] <span style="font-weight:bold">=</span> df_test<span style="font-weight:bold">.</span>words<span style="font-weight:bold">.</span>apply(count_words)<span style="font-weight:bold">.</span>values
</span></span><span style="display:flex;"><span>df_test[<span style="color:#b84">&#39;p_hat&#39;</span>] <span style="font-weight:bold">=</span> [predict(d, best_lamda) <span style="font-weight:bold">for</span> d <span style="font-weight:bold">in</span> df_test<span style="font-weight:bold">.</span>d]
</span></span><span style="display:flex;"><span>df_test <span style="font-weight:bold">=</span> df_test[[<span style="color:#b84">&#39;words&#39;</span>, <span style="color:#b84">&#39;r&#39;</span>, <span style="color:#b84">&#39;p&#39;</span>, <span style="color:#b84">&#39;p_hat&#39;</span>, <span style="color:#b84">&#39;d&#39;</span>]]
</span></span><span style="display:flex;"><span>display(HTML(df_test<span style="font-weight:bold">.</span>to_html(max_rows<span style="font-weight:bold">=</span><span style="color:#099">10</span>)))
</span></span></code></pre></div><table>
<thead>
<tr>
<th>date</th>
<th>words</th>
<th>r</th>
<th>p</th>
<th>p_hat</th>
<th>d</th>
</tr>
</thead>
<tbody>
<tr>
<td>2017-12-18</td>
<td>[according, according, according, according, a&hellip;</td>
<td>-0.127551</td>
<td>0.234221</td>
<td>0.313379</td>
<td>[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, &hellip;</td>
</tr>
<tr>
<td>2017-12-19</td>
<td>[ability, able, able, able, abrupt, absolutely&hellip;</td>
<td>-0.005238</td>
<td>0.561217</td>
<td>0.560449</td>
<td>[1, 0, 0, 0, 0, 0, 1, 2, 0, 1, 1, 0, 0, 0, 1, &hellip;</td>
</tr>
<tr>
<td>2017-12-20</td>
<td>[able, able, abruptly, abruptly, accelerate, a&hellip;</td>
<td>-0.064455</td>
<td>0.574144</td>
<td>0.343652</td>
<td>[0, 0, 0, 1, 0, 1, 1, 0, 0, 2, 0, 0, 0, 0, 0, &hellip;</td>
</tr>
<tr>
<td>2017-12-21</td>
<td>[able, according, according, according, accoun&hellip;</td>
<td>0.151503</td>
<td>0.171863</td>
<td>0.313184</td>
<td>[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, &hellip;</td>
</tr>
<tr>
<td>2017-12-22</td>
<td>[able, abound, acceptance, accepting, acceptin&hellip;</td>
<td>0.083399</td>
<td>0.768061</td>
<td>0.340234</td>
<td>[4, 1, 0, 0, 0, 0, 0, 0, 0, 0, 2, 0, 0, 2, 0, &hellip;</td>
</tr>
<tr>
<td>&hellip;</td>
<td>&hellip;</td>
<td>&hellip;</td>
<td>&hellip;</td>
<td>&hellip;</td>
<td>&hellip;</td>
</tr>
<tr>
<td>2019-04-26</td>
<td>[access, according, according, according, acco&hellip;</td>
<td>-0.058712</td>
<td>0.466920</td>
<td>0.470312</td>
<td>[1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, &hellip;</td>
</tr>
<tr>
<td>2019-04-29</td>
<td>[abort, access, according, according, accordin&hellip;</td>
<td>-0.041062</td>
<td>0.963498</td>
<td>0.416309</td>
<td>[0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, &hellip;</td>
</tr>
<tr>
<td>2019-04-30</td>
<td>[able, able, acceptance, acceptance, access, a&hellip;</td>
<td>-0.011006</td>
<td>0.533080</td>
<td>0.628125</td>
<td>[0, 1, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, &hellip;</td>
</tr>
<tr>
<td>2019-05-01</td>
<td>[access, access, accessible, according, accord&hellip;</td>
<td>-0.058620</td>
<td>0.979468</td>
<td>0.484668</td>
<td>[1, 1, 0, 0, 0, 0, 1, 0, 0, 2, 0, 0, 0, 0, 0, &hellip;</td>
</tr>
<tr>
<td>2019-05-02</td>
<td>[able, aborted, access, accompanied, according&hellip;</td>
<td>0.006681</td>
<td>0.374144</td>
<td>0.445898</td>
<td>[0, 0, 0, 0, 0, 0, 3, 0, 0, 0, 1, 0, 0, 0, 0, &hellip;</td>
</tr>
</tbody>
</table>
<h2 id="backtesting-results">Backtesting Results</h2>
<p>Finally, given the predicted <code>p_hat</code> values, we can trade based on certain sizing functions and calculate the cumulative return as well as all other trading related statistics of our strategy. We will also calculate these for benchmark strategies.</p>
<p><strong>A short description of benchmark strategies and our hybrid sentiment-momentum strategy:</strong></p>
<ul>
<li>
<p><strong>Buy-and-hold</strong>: This strategy simply buys Bitcoin and hold for the whole trading period. Bitcoin is the most commonly traded coin in the cryptocurrency market and is representative of the market. Thus, we choose Bitcoin as the asset we buy and hold.</p>
</li>
<li>
<p><strong>Momentum</strong>: As explained above, the momentum strategy takes long and short positions separately in the top <code>n</code> and bottom <code>n</code> coins. Here, by &ldquo;top&rdquo; and &ldquo;bottom&rdquo;, we mean the best- and worst-performing coins in the look-back window of <code>d</code> trading days. Specifically, we take <code>n=3</code> and <code>d=60</code>.</p>
</li>
<li>
<p><strong>Momentum Reversal</strong>: The momentum reversal strategy does exactly the opposite of the momentum strategy. It takes short positions in the top <code>n</code> coins and long positions in the bottom <code>n</code> coins. The definition and values of <code>n</code> and <code>d</code> remain the same.</p>
</li>
<li>
<p><strong>Hybrid Sentiment-Momentum</strong>: Our hybrid sentiment-momentum strategy combines sentiment analysis and momentum trading strategy. Using the core idea of momentum, the strategy ranks all the coins based on their previous price changes and then forms a portfolio that enters long positions in coins that headed up and short positions in those that went down. This step is the same as a usual momentum trading strategy. Taking advantage of the sentiment analysis results on present da&rsquo;s news, the strategy then decides on how many units of the portfolio to buy or sell.</p>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>size <span style="font-weight:bold">=</span> <span style="font-weight:bold">lambda</span> x: x <span style="font-weight:bold">*</span> <span style="color:#099">2</span> <span style="font-weight:bold">-</span> <span style="color:#099">1</span>  <span style="color:#998;font-style:italic"># actual size of position based on predicted p values</span>
</span></span><span style="display:flex;"><span>compound <span style="font-weight:bold">=</span> <span style="font-weight:bold">lambda</span> x: (<span style="color:#099">1</span> <span style="font-weight:bold">+</span> x)<span style="font-weight:bold">.</span>cumprod() <span style="font-weight:bold">-</span> <span style="color:#099">1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>r <span style="font-weight:bold">=</span> df_test<span style="font-weight:bold">.</span>r
</span></span><span style="display:flex;"><span>size <span style="font-weight:bold">=</span> df_test<span style="font-weight:bold">.</span>p_hat<span style="font-weight:bold">.</span>apply(size)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>daily_rtn <span style="font-weight:bold">=</span> r <span style="font-weight:bold">*</span> size
</span></span><span style="display:flex;"><span>cum_rtn <span style="font-weight:bold">=</span> compound(daily_rtn)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>daily_rtn_momentum <span style="font-weight:bold">=</span> rtn[cum_rtn<span style="font-weight:bold">.</span>index]
</span></span><span style="display:flex;"><span>cum_rtn_momentum <span style="font-weight:bold">=</span> compound(daily_rtn_momentum)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>daily_rtn_momentum_rev <span style="font-weight:bold">=</span> <span style="font-weight:bold">-</span>daily_rtn_momentum
</span></span><span style="display:flex;"><span>cum_rtn_momentum_rev <span style="font-weight:bold">=</span> compound(daily_rtn_momentum_rev)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>daily_rtn_buy_hold <span style="font-weight:bold">=</span> price<span style="font-weight:bold">.</span>BTC<span style="font-weight:bold">.</span>pct_change()<span style="font-weight:bold">.</span>loc[cum_rtn<span style="font-weight:bold">.</span>index]
</span></span><span style="display:flex;"><span>cum_rtn_buy_hold <span style="font-weight:bold">=</span> compound(daily_rtn_buy_hold)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>fig1 <span style="font-weight:bold">=</span> plt<span style="font-weight:bold">.</span>figure()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>ax1 <span style="font-weight:bold">=</span> fig1<span style="font-weight:bold">.</span>add_subplot(<span style="color:#099">111</span>)
</span></span><span style="display:flex;"><span>ax1<span style="font-weight:bold">.</span>set_ylabel(<span style="color:#b84">&#39;Cumulative Return&#39;</span>)
</span></span><span style="display:flex;"><span>cum_rtn_buy_hold<span style="font-weight:bold">.</span>plot(ax<span style="font-weight:bold">=</span>ax1, color<span style="font-weight:bold">=</span><span style="color:#b84">&#39;orange&#39;</span>, label<span style="font-weight:bold">=</span><span style="color:#b84">&#39;Buy &amp; Hold&#39;</span>)
</span></span><span style="display:flex;"><span>cum_rtn_momentum<span style="font-weight:bold">.</span>plot(ax<span style="font-weight:bold">=</span>ax1, color<span style="font-weight:bold">=</span><span style="color:#b84">&#39;r&#39;</span>, label<span style="font-weight:bold">=</span><span style="color:#b84">&#39;Momentum&#39;</span>)
</span></span><span style="display:flex;"><span>cum_rtn_momentum_rev<span style="font-weight:bold">.</span>plot(ax<span style="font-weight:bold">=</span>ax1, color<span style="font-weight:bold">=</span><span style="color:#b84">&#39;darkred&#39;</span>, label<span style="font-weight:bold">=</span><span style="color:#b84">&#39;Mom. Rev.&#39;</span>)
</span></span><span style="display:flex;"><span>cum_rtn<span style="font-weight:bold">.</span>plot(ax<span style="font-weight:bold">=</span>ax1, color<span style="font-weight:bold">=</span><span style="color:#b84">&#39;lime&#39;</span>, label<span style="font-weight:bold">=</span><span style="color:#b84">&#39;Strategy&#39;</span>)
</span></span><span style="display:flex;"><span>ax1<span style="font-weight:bold">.</span>axhline(y<span style="font-weight:bold">=</span><span style="color:#099">0</span>, ls<span style="font-weight:bold">=</span><span style="color:#b84">&#39;--&#39;</span>, color<span style="font-weight:bold">=</span><span style="color:#b84">&#39;w&#39;</span>)
</span></span><span style="display:flex;"><span>legend1 <span style="font-weight:bold">=</span> plt<span style="font-weight:bold">.</span>legend(frameon<span style="font-weight:bold">=</span><span style="font-weight:bold">False</span>, ncol<span style="font-weight:bold">=</span><span style="color:#099">10</span>, loc<span style="font-weight:bold">=</span><span style="color:#b84">&#39;center left&#39;</span>, bbox_to_anchor<span style="font-weight:bold">=</span>(<span style="color:#099">0</span>, <span style="color:#099">1.05</span>))
</span></span><span style="display:flex;"><span>plt<span style="font-weight:bold">.</span>setp(legend1<span style="font-weight:bold">.</span>get_texts(), color<span style="font-weight:bold">=</span><span style="color:#b84">&#39;k&#39;</span>, size<span style="font-weight:bold">=</span><span style="color:#099">12</span>)
</span></span><span style="display:flex;"><span>plt<span style="font-weight:bold">.</span>xticks(rotation<span style="font-weight:bold">=</span><span style="color:#099">0</span>, ha<span style="font-weight:bold">=</span><span style="color:#b84">&#39;center&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>ax1 <span style="font-weight:bold">=</span> ax1<span style="font-weight:bold">.</span>twinx()
</span></span><span style="display:flex;"><span>ax1<span style="font-weight:bold">.</span>grid(<span style="font-weight:bold">False</span>)
</span></span><span style="display:flex;"><span>ax1<span style="font-weight:bold">.</span>set_ylabel(<span style="color:#b84">&#39;Position&#39;</span>)
</span></span><span style="display:flex;"><span>size<span style="font-weight:bold">.</span>plot(ax<span style="font-weight:bold">=</span>ax1, lw<span style="font-weight:bold">=</span><span style="color:#099">1</span>, alpha<span style="font-weight:bold">=</span><span style="color:#099">.5</span>, color<span style="font-weight:bold">=</span><span style="color:#b84">&#39;grey&#39;</span>)
</span></span><span style="display:flex;"><span>plt<span style="font-weight:bold">.</span>tight_layout()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>fig2 <span style="font-weight:bold">=</span> plt<span style="font-weight:bold">.</span>figure()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>ax2 <span style="font-weight:bold">=</span> fig2<span style="font-weight:bold">.</span>add_subplot(<span style="color:#099">111</span>)
</span></span><span style="display:flex;"><span>ax2<span style="font-weight:bold">.</span>set_ylabel(<span style="color:#b84">&#39;Volatility&#39;</span>)
</span></span><span style="display:flex;"><span>daily_rtn_buy_hold<span style="font-weight:bold">.</span>rolling(<span style="color:#099">5</span>)<span style="font-weight:bold">.</span>std()<span style="font-weight:bold">.</span>plot(ax<span style="font-weight:bold">=</span>ax2, color<span style="font-weight:bold">=</span><span style="color:#b84">&#39;orange&#39;</span>, label<span style="font-weight:bold">=</span><span style="color:#b84">&#39;Buy &amp; Hold&#39;</span>)
</span></span><span style="display:flex;"><span>daily_rtn_momentum<span style="font-weight:bold">.</span>rolling(<span style="color:#099">5</span>)<span style="font-weight:bold">.</span>std()<span style="font-weight:bold">.</span>plot(ax<span style="font-weight:bold">=</span>ax2, color<span style="font-weight:bold">=</span><span style="color:#b84">&#39;r&#39;</span>, label<span style="font-weight:bold">=</span><span style="color:#b84">&#39;Momentum&#39;</span>)
</span></span><span style="display:flex;"><span>daily_rtn_momentum_rev<span style="font-weight:bold">.</span>rolling(<span style="color:#099">5</span>)<span style="font-weight:bold">.</span>std()<span style="font-weight:bold">.</span>plot(ax<span style="font-weight:bold">=</span>ax2, color<span style="font-weight:bold">=</span><span style="color:#b84">&#39;darkred&#39;</span>, label<span style="font-weight:bold">=</span><span style="color:#b84">&#39;Mom. Rev.&#39;</span>)
</span></span><span style="display:flex;"><span>daily_rtn<span style="font-weight:bold">.</span>rolling(<span style="color:#099">5</span>)<span style="font-weight:bold">.</span>std()<span style="font-weight:bold">.</span>plot(ax<span style="font-weight:bold">=</span>ax2, color<span style="font-weight:bold">=</span><span style="color:#b84">&#39;lime&#39;</span>, label<span style="font-weight:bold">=</span><span style="color:#b84">&#39;Strategy&#39;</span>)
</span></span><span style="display:flex;"><span>ax2<span style="font-weight:bold">.</span>axhline(y<span style="font-weight:bold">=</span><span style="color:#099">0</span>, ls<span style="font-weight:bold">=</span><span style="color:#b84">&#39;--&#39;</span>, color<span style="font-weight:bold">=</span><span style="color:#b84">&#39;w&#39;</span>)
</span></span><span style="display:flex;"><span>legend2 <span style="font-weight:bold">=</span> plt<span style="font-weight:bold">.</span>legend(frameon<span style="font-weight:bold">=</span><span style="font-weight:bold">False</span>, ncol<span style="font-weight:bold">=</span><span style="color:#099">10</span>, loc<span style="font-weight:bold">=</span><span style="color:#b84">&#39;center left&#39;</span>, bbox_to_anchor<span style="font-weight:bold">=</span>(<span style="color:#099">0</span>, <span style="color:#099">1.05</span>))
</span></span><span style="display:flex;"><span>plt<span style="font-weight:bold">.</span>setp(legend2<span style="font-weight:bold">.</span>get_texts(), color<span style="font-weight:bold">=</span><span style="color:#b84">&#39;k&#39;</span>, size<span style="font-weight:bold">=</span><span style="color:#099">12</span>)
</span></span><span style="display:flex;"><span>plt<span style="font-weight:bold">.</span>xticks(rotation<span style="font-weight:bold">=</span><span style="color:#099">0</span>, ha<span style="font-weight:bold">=</span><span style="color:#b84">&#39;center&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>ax2 <span style="font-weight:bold">=</span> ax2<span style="font-weight:bold">.</span>twinx()
</span></span><span style="display:flex;"><span>ax2<span style="font-weight:bold">.</span>grid(<span style="font-weight:bold">False</span>)
</span></span><span style="display:flex;"><span>ax2<span style="font-weight:bold">.</span>set_ylabel(<span style="color:#b84">&#39;Position&#39;</span>)
</span></span><span style="display:flex;"><span>size<span style="font-weight:bold">.</span>plot(ax<span style="font-weight:bold">=</span>ax2, lw<span style="font-weight:bold">=</span><span style="color:#099">1</span>, alpha<span style="font-weight:bold">=</span><span style="color:#099">.5</span>, color<span style="font-weight:bold">=</span><span style="color:#b84">&#39;grey&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>plt<span style="font-weight:bold">.</span>tight_layout()
</span></span><span style="display:flex;"><span>plt<span style="font-weight:bold">.</span>show()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>win_rate <span style="font-weight:bold">=</span> <span style="font-weight:bold">lambda</span> x: (x <span style="font-weight:bold">&gt;</span> <span style="color:#099">0</span>)<span style="font-weight:bold">.</span>mean()
</span></span><span style="display:flex;"><span>sharpe <span style="font-weight:bold">=</span> <span style="font-weight:bold">lambda</span> x: x<span style="font-weight:bold">.</span>mean() <span style="font-weight:bold">/</span> x<span style="font-weight:bold">.</span>std() <span style="font-weight:bold">*</span> np<span style="font-weight:bold">.</span>sqrt(<span style="color:#099">360</span>)
</span></span><span style="display:flex;"><span>mdd <span style="font-weight:bold">=</span> <span style="font-weight:bold">lambda</span> x: (<span style="color:#099">1</span> <span style="font-weight:bold">-</span> x <span style="font-weight:bold">/</span> x<span style="font-weight:bold">.</span>cummax())<span style="font-weight:bold">.</span>max()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>DAILY <span style="font-weight:bold">=</span> [daily_rtn_buy_hold, daily_rtn_momentum, daily_rtn_momentum_rev, daily_rtn]
</span></span><span style="display:flex;"><span>CUM <span style="font-weight:bold">=</span> [cum_rtn_buy_hold, cum_rtn_momentum, cum_rtn_momentum_rev, cum_rtn]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>cr <span style="font-weight:bold">=</span> [x[<span style="font-weight:bold">-</span><span style="color:#099">1</span>] <span style="font-weight:bold">for</span> x <span style="font-weight:bold">in</span> CUM]
</span></span><span style="display:flex;"><span>vol <span style="font-weight:bold">=</span> [x<span style="font-weight:bold">.</span>std() <span style="font-weight:bold">for</span> x <span style="font-weight:bold">in</span> DAILY]
</span></span><span style="display:flex;"><span>wr <span style="font-weight:bold">=</span> [win_rate(x) <span style="font-weight:bold">for</span> x <span style="font-weight:bold">in</span> DAILY]
</span></span><span style="display:flex;"><span>sr <span style="font-weight:bold">=</span> [sharpe(x) <span style="font-weight:bold">for</span> x <span style="font-weight:bold">in</span> DAILY]
</span></span><span style="display:flex;"><span>md <span style="font-weight:bold">=</span> [mdd(x <span style="font-weight:bold">+</span> <span style="color:#099">1</span>) <span style="font-weight:bold">for</span> x <span style="font-weight:bold">in</span> CUM]
</span></span><span style="display:flex;"><span>result <span style="font-weight:bold">=</span> pd<span style="font-weight:bold">.</span>DataFrame({
</span></span><span style="display:flex;"><span>    <span style="color:#b84">&#39;Cum Return&#39;</span>: cr,
</span></span><span style="display:flex;"><span>    <span style="color:#b84">&#39;Volatility&#39;</span>: vol,
</span></span><span style="display:flex;"><span>    <span style="color:#b84">&#39;Win%&#39;</span>: wr,
</span></span><span style="display:flex;"><span>    <span style="color:#b84">&#39;Sharpe&#39;</span>: sr,
</span></span><span style="display:flex;"><span>    <span style="color:#b84">&#39;MDD&#39;</span>: md
</span></span><span style="display:flex;"><span>}, index<span style="font-weight:bold">=</span>[<span style="color:#b84">&#39;Buy &amp; Hold&#39;</span>, <span style="color:#b84">&#39;Momentum&#39;</span>, <span style="color:#b84">&#39;Mom. Rev.&#39;</span>, <span style="color:#b84">&#39;Strategy&#39;</span>])
</span></span><span style="display:flex;"><span>result<span style="font-weight:bold">.</span>index<span style="font-weight:bold">.</span>name <span style="font-weight:bold">=</span> <span style="color:#b84">&#39;Statistics&#39;</span>
</span></span><span style="display:flex;"><span>display(HTML(result<span style="font-weight:bold">.</span>T<span style="font-weight:bold">.</span>to_html(max_rows<span style="font-weight:bold">=</span><span style="color:#099">10</span>)))
</span></span></code></pre></div><img src="/images/cryptonews_56_0.png" style="width: 100%;"/>
<img src="/images/cryptonews_56_1.png" style="width: 100%;"/>
<table>
<thead>
<tr>
<th>Statistics</th>
<th>Buy &amp; Hold</th>
<th>Momentum</th>
<th>Mom. Rev.</th>
<th>Strategy</th>
</tr>
</thead>
<tbody>
<tr>
<td>Win%</td>
<td>0.524051</td>
<td>0.437975</td>
<td>0.562025</td>
<td>0.536709</td>
</tr>
<tr>
<td>Sharpe</td>
<td>-0.975205</td>
<td>-0.605331</td>
<td>0.605331</td>
<td>2.677082</td>
</tr>
<tr>
<td>MDD</td>
<td>0.826419</td>
<td>0.970956</td>
<td>0.947963</td>
<td>0.206906</td>
</tr>
</tbody>
</table>
<p>As can be seen in the figure above, the momentum strategy performed almost as poorly as a simple buy &amp; hold throughout the bearish year of 2018. The momentum reversal strategy, on the other hand, performed extremely well at the first half year and then collapsed with the market. The partially reflects the existence of price overreactions as suggested by <a href="#cp2018">Caporale and Plastun (2018)</a><a id='cp2018back'></a>. Our hybrid strategy, on the other hand, outperformed all of them by over 100% cumulative returns by the end of backtest, and gave a Sharpe ratio of 2.68 when best of the rest, which is given by momentum reversal, is merely 0.60 or so. Volatility plot also shows that by adding sentiment analysis to determine position sides and sizes of the portfolio, the hybrid strategy significantly reduces the risks that existed in the momentum strategy. Also, considering the maximum drawdowns, all of the three benchmarks gave gigantic drawdowns in this unfortunate year, while our strategy&rsquo;s was well limited under 20% most of the time.</p>
<h2 id="model-sensitivity-to-parameters">Model Sensitivity to Parameters</h2>
<p>The following parameters are included in our model. We want to test how the model reacts towards changes in them.</p>
<ul>
<li><code>lookback_window</code> is the number of days we feed our model for training,</li>
<li><code>minimum_occurrence</code> is the minimum number of occurrences for a word to be considered sentiment-charged,</li>
<li><code>minimum_length</code> is the minimum acceptable length of a word to be considered sentiment-charged,</li>
<li><code>alpha</code> is the top (and bottom) percentile for sentiment-charged word selection</li>
<li><code>size</code> is a univariate function mapping <code>$[0,1]\subset\mathbb{R}$</code> to <code>$[-1,1]\subset\mathbb{R}$</code>.</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>Image(<span style="color:#b84">&#39;misc/lookback_window.png&#39;</span>)
</span></span></code></pre></div><img src="/images/cryptonews_60_0.png" style="width: 100%;"/>
<p>A longer look-back window provides more information in the past that can be used to help decision-making on forming the portfolio. However, the longer the window, the more stale information is included. The empirical result tells us using past 60 day&rsquo; information to determine the best and worst performing coins eventually leads to the highest Win rate and Sharpe Ratio together with the lowest Maximum Drawdown.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>Image(<span style="color:#b84">&#39;misc/minimum_occurrence.png&#39;</span>)
</span></span></code></pre></div><img src="/images/cryptonews_62_0.png" style="width: 100%;"/>
<p>Higher minimum occurrence implies a stricter constraint on selecting sentiment-charged words. While noises coming from words which do not show up frequently are diminished, if minimum occurrence is set too high, some useful information is left out. Moreover, a very small pool of sentiment-charged words will cause the training and predicting to be extremely hard and even impossible.</p>
<p>From the results, we can conclude that setting minimum occurrence equal to 50 generates better Sharpe Ratio and Maximum Drawdown than setting it to 10 or 100.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>Image(<span style="color:#b84">&#39;misc/minimum_length.png&#39;</span>)
</span></span></code></pre></div><img src="/images/cryptonews_64_0.png" style="width: 100%;"/>
<p>Many of the short words, those whose lengths are 2 or 3, are not really informative, thus conveying nearly no sentiment. For instance, words such as &ldquo;a&rdquo;, &ldquo;is&rdquo;, and &ldquo;the&rdquo; show up in almost every piece of news multiple times. Whereas they don&rsquo;t offer much help in understanding the sentiment of the news, so they can be eliminated without hurting the results. Of course, this simple criterion is arbitrary, thus needs to be tested. Based on the results we get, different minimum length values don&rsquo;t impact the strategy statistics significantly.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>Image(<span style="color:#b84">&#39;misc/alpha.png&#39;</span>)
</span></span></code></pre></div><img src="/images/cryptonews_66_0.png" style="width: 100%;"/>
<p>Alpha is used to define the percentage of sentiment-charged words that are positive or negative. Similar to minimum occurrence, a strategy with a larger alpha includes more information into the analysis and vice versa. An alpha of 0.05 gives the best results as shown above.</p>
<p><strong>For sizing function:</strong></p>
<ul>
<li>Binary: if <code>$p$</code> is greater than <code>$0.5$</code>, we take <code>$1$</code> long position; otherwise, we take <code>$1$</code> short position.</li>
<li>Continuous: we always take <code>$2p-1$</code> positions, since <code>$p\in[0,1]$</code>, we know <code>$2p-1\in[-1,1]$</code>.</li>
<li>Trinary: if <code>$p$</code> is greater than ⅔, we take <code>$1$</code> long position in the portfolio; it <code>$p$</code> is less than ⅔ but greater than ⅓, we don&rsquo;t take any position; otherwise, we take <code>$1$</code> short position.</li>
</ul>
<p>Trinary has much worse performance than binary and continuous as both Win rate and Sharpe ratio are worse for Trinary than for the other two.
While continuous and binary are similar on Win rate and Sharpe ratio, continuous always has smaller Maximum Drawdowns. Therefore, it is a more stable strategy and is thus best for risk-averse investors.</p>
<p>For a more comprehensive practice of hyper-parameter exploration, we summarized the scripts above into a local module <code>backtest</code> for convenient backtesting. The general usage is summarized as below:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span><span style="font-weight:bold">from</span> <span style="color:#555">misc.backtest</span> <span style="font-weight:bold">import</span> BacktestEngine
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>be <span style="font-weight:bold">=</span> BacktestEngine()
</span></span><span style="display:flex;"><span>be<span style="font-weight:bold">.</span>run(
</span></span><span style="display:flex;"><span>    lookback_window<span style="font-weight:bold">=</span><span style="color:#099">60</span>,
</span></span><span style="display:flex;"><span>    minimum_occurrence<span style="font-weight:bold">=</span><span style="color:#099">50</span>,
</span></span><span style="display:flex;"><span>    minimum_length<span style="font-weight:bold">=</span><span style="color:#099">5</span>,
</span></span><span style="display:flex;"><span>    alpha<span style="font-weight:bold">=</span><span style="color:#099">.1</span>,
</span></span><span style="display:flex;"><span>    size<span style="font-weight:bold">=</span><span style="font-weight:bold">lambda</span> x: <span style="color:#099">2</span> <span style="font-weight:bold">*</span> x <span style="font-weight:bold">-</span> <span style="color:#099">1</span>
</span></span><span style="display:flex;"><span>)
</span></span></code></pre></div><p>See <a href="#toc_14">Appendix C</a><a id='acback'></a> for the complete code and the detailed parameter testing outputs.</p>
<h2 id="risk-management">Risk Management</h2>
<p>Momentum trading strategy is essentially buying on gainers and selling on losers. Due to the low liquidity and slow information dissemination nature of cryptocurrency trading, trading on momentum is, theoretically speaking, profitable. However, there is no guarantee that what makes gains will continue being profitable and what generates losses will keep losing money. Therefore, a risk management technique to prevent the strategy from taking huge amount of unexpected losses is a must-have with no doubt.</p>
<p>One of the most common approaches to controlling risks is to include a stop-loss feature. A usual way to apply a stop-loss is to calculate returns, determine if it falls below the threshold and then exit the position if it does. Here is where our strategy differs. It does not need an additional stop-loss as a stop-loss feature is embedded in the strategy already. The reason is that the underlying momentum strategy invests in a dynamic portfolio, meaning that all the positions the strategy enters on the previous day will be closed today no matter how the performance is on the previous day. In other words, the momentum strategy does not pick the same set of coins to invest from day to day, previous losses will not accumulate in following days.</p>
<h1 id="conclusion">Conclusion</h1>
<p>In this research paper, we tested momentum and momentum reversal strategies in the cryptocurrency market and improved the traditional momentum strategy by introducing a brand-new sentiment-based model. The model significantly improved the general strategy scenario. It turned out that our hybrid model can handle massive market collapses e.g. mid-2018 while taking valid non-zero positions, and can grasp profits at potential opportunities.</p>
<p>There are, however, still several limitations in this research. First, due to the limited history of cryptocurrency, our dataset is rather short compared with stock data, with only 2014 - 2019 making up both training and testing sets. This limitation does not only occur w.r.t. time, but also troubles us during dynamic coin selection. Since we need a long period of historical data, our choices of coins became considerably restricted (less than 20), which further causes us to hold less (to be precise, 6 in this case) coins at each day. Idiosyncratic risks may not be well diversified and there is non-negligible likelihood that our strategy fails us because of failure in one certain coin &ndash; though luckily, we didn&rsquo;t encounter this issue.</p>
<p>Last but not least, more rigorous backtests could be implemented to perform against our strategies. We may use intra-day data, if possible, for better accuracy. Furthermore, we can take order book into account to cope with micro-structure related concerns. By and large, our hybrid strategy satisfyingly outperformed all benchmark strategies in the same market and we deem this as a strong and good result.</p>
<h1 id="references">References</h1>
<ul>
<li><a id='a2014'></a>Antonacci, Gary (2014). <em>Dual Momentum Investing: An Innovative Approach for Higher Returns with Lower Risk</em>. New York: McGraw-Hill Education, 13–18.</li>
<li><a id='rso2017'></a>Rohrbach, J., Suremann, S., &amp; Osterrieder, J. (2017). <em>Momentum and Trend Following Trading Strategies for Currencies Revisited-Combining Academia and Industry.</em></li>
<li><a id='kkx2019'></a>Ke, Z. T., Kelly, B. T., &amp; Xiu, D. (2019). <em>Predicting Returns With Text Data.</em> Available at SSRN.</li>
<li><a id='cp2018'></a>Caporale, G. M., &amp; Plastun, O. (2018). <em>Price Overreactions in the Cryptocurrency Market.</em></li>
</ul>
<p><br><hr><br></p>
<h1 id="appendix">Appendix</h1>
<p>We include all miscellaneous scripts (mostly for data crawling) as below.</p>
<h2 id="appendix-a-news-data">Appendix A: News Data</h2>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span><span style="font-weight:bold">import</span> <span style="color:#555">time</span>
</span></span><span style="display:flex;"><span><span style="font-weight:bold">import</span> <span style="color:#555">random</span>
</span></span><span style="display:flex;"><span><span style="font-weight:bold">import</span> <span style="color:#555">requests</span>
</span></span><span style="display:flex;"><span><span style="font-weight:bold">import</span> <span style="color:#555">pandas</span> <span style="font-weight:bold">as</span> <span style="color:#555">pd</span>
</span></span><span style="display:flex;"><span><span style="font-weight:bold">from</span> <span style="color:#555">bs4</span> <span style="font-weight:bold">import</span> BeautifulSoup
</span></span><span style="display:flex;"><span><span style="font-weight:bold">from</span> <span style="color:#555">datetime</span> <span style="font-weight:bold">import</span> datetime <span style="font-weight:bold">as</span> dt
</span></span><span style="display:flex;"><span><span style="font-weight:bold">from</span> <span style="color:#555">randomheaders</span> <span style="font-weight:bold">import</span> LoadHeader <span style="font-weight:bold">as</span> random_header
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>pd<span style="font-weight:bold">.</span>set_option(<span style="color:#b84">&#39;display.max_rows&#39;</span>, <span style="color:#099">500</span>)
</span></span><span style="display:flex;"><span>pd<span style="font-weight:bold">.</span>set_option(<span style="color:#b84">&#39;display.max_columns&#39;</span>, <span style="color:#099">500</span>)
</span></span><span style="display:flex;"><span>pd<span style="font-weight:bold">.</span>set_option(<span style="color:#b84">&#39;display.width&#39;</span>, <span style="color:#099">1000</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>random<span style="font-weight:bold">.</span>seed(<span style="color:#099">123</span>)
</span></span><span style="display:flex;"><span>COLUMNS <span style="font-weight:bold">=</span> [<span style="color:#b84">&#39;time&#39;</span>, <span style="color:#b84">&#39;title&#39;</span>]
</span></span><span style="display:flex;"><span>INFO <span style="font-weight:bold">=</span> pd<span style="font-weight:bold">.</span>DataFrame(columns<span style="font-weight:bold">=</span>COLUMNS)
</span></span><span style="display:flex;"><span>IP_LIST <span style="font-weight:bold">=</span> []
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="font-weight:bold">def</span> <span style="color:#900;font-weight:bold">get_proxy</span>():
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">return</span> requests<span style="font-weight:bold">.</span>get(<span style="color:#b84">&#39;http://localhost:5555/get/&#39;</span>)<span style="font-weight:bold">.</span>text
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="font-weight:bold">def</span> <span style="color:#900;font-weight:bold">delete_proxy</span>(proxy):
</span></span><span style="display:flex;"><span>    requests<span style="font-weight:bold">.</span>get(<span style="color:#b84">f</span><span style="color:#b84">&#39;http://localhost:5555/delete/?proxy=</span><span style="color:#b84">{</span>proxy<span style="color:#b84">}</span><span style="color:#b84">&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="font-weight:bold">def</span> <span style="color:#900;font-weight:bold">get_soup</span>(url, parser):
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">while</span> <span style="font-weight:bold">True</span>:
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">try</span>:
</span></span><span style="display:flex;"><span>            time<span style="font-weight:bold">.</span>sleep(random<span style="font-weight:bold">.</span>uniform(<span style="color:#099">0</span>, <span style="color:#099">1</span>))
</span></span><span style="display:flex;"><span>            proxy <span style="font-weight:bold">=</span> get_proxy()
</span></span><span style="display:flex;"><span>            html <span style="font-weight:bold">=</span> requests<span style="font-weight:bold">.</span>get(
</span></span><span style="display:flex;"><span>                url, timeout<span style="font-weight:bold">=</span>(<span style="color:#099">3</span>, <span style="color:#099">7</span>), headers<span style="font-weight:bold">=</span>random_header(),
</span></span><span style="display:flex;"><span>                proxies<span style="font-weight:bold">=</span>{<span style="color:#b84">&#39;http&#39;</span>: proxy, <span style="color:#b84">&#39;https&#39;</span>: proxy})<span style="font-weight:bold">.</span>text
</span></span><span style="display:flex;"><span>            <span style="font-weight:bold">return</span> BeautifulSoup(html, parser)
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">except</span> <span style="color:#900;font-weight:bold">Exception</span>:
</span></span><span style="display:flex;"><span>            delete_proxy(proxy)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="font-weight:bold">def</span> <span style="color:#900;font-weight:bold">parse_time</span>(timestr):
</span></span><span style="display:flex;"><span>    raw_time <span style="font-weight:bold">=</span> timestr[<span style="color:#099">10</span>:]<span style="font-weight:bold">.</span>split(<span style="color:#b84">&#39;/&#39;</span>)[<span style="color:#099">0</span>]<span style="font-weight:bold">.</span>replace(<span style="color:#b84">&#39;on&#39;</span>, <span style="color:#b84">&#39;&#39;</span>)
</span></span><span style="display:flex;"><span>    time <span style="font-weight:bold">=</span> dt<span style="font-weight:bold">.</span>strptime(raw_time, <span style="color:#b84">&#39;%H:%M  %B </span><span style="color:#b84">%d</span><span style="color:#b84">, %Y  &#39;</span>)
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">return</span> time
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="font-weight:bold">def</span> <span style="color:#900;font-weight:bold">get_content</span>(url):
</span></span><span style="display:flex;"><span>    soup <span style="font-weight:bold">=</span> get_soup(url, <span style="color:#b84">&#39;lxml&#39;</span>)
</span></span><span style="display:flex;"><span>    paragraphs <span style="font-weight:bold">=</span> soup<span style="font-weight:bold">.</span>select(<span style="color:#b84">&#39;div[class=&#34;entry-content&#34;]&#39;</span>)[<span style="color:#099">0</span>]<span style="font-weight:bold">.</span>select(<span style="color:#b84">&#39;p&#39;</span>)
</span></span><span style="display:flex;"><span>    content <span style="font-weight:bold">=</span> <span style="color:#b84">&#39;</span><span style="color:#b84">\n</span><span style="color:#b84">&#39;</span><span style="font-weight:bold">.</span>join([para<span style="font-weight:bold">.</span>text <span style="font-weight:bold">for</span> para <span style="font-weight:bold">in</span> paragraphs[:<span style="font-weight:bold">-</span><span style="color:#099">1</span>]])
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">return</span> content
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="font-weight:bold">def</span> <span style="color:#900;font-weight:bold">get_posts</span>(soup):
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">if</span> <span style="color:#b84">&#39;404 - PAGE NOT FOUND&#39;</span> <span style="font-weight:bold">in</span> soup<span style="font-weight:bold">.</span>text: <span style="font-weight:bold">return</span> <span style="font-weight:bold">None</span>
</span></span><span style="display:flex;"><span>    posts <span style="font-weight:bold">=</span> soup<span style="font-weight:bold">.</span>select(<span style="color:#b84">&#39;a[class=&#34;stream-article&#34;]&#39;</span>)
</span></span><span style="display:flex;"><span>    titles, times, abstracts, contents <span style="font-weight:bold">=</span> [], [], [], []
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">for</span> p <span style="font-weight:bold">in</span> posts:
</span></span><span style="display:flex;"><span>        meta <span style="font-weight:bold">=</span> p<span style="font-weight:bold">.</span>select(<span style="color:#b84">&#39;div[class=&#34;meta&#34;]&#39;</span>)[<span style="color:#099">0</span>]
</span></span><span style="display:flex;"><span>        titles<span style="font-weight:bold">.</span>append(meta<span style="font-weight:bold">.</span>select(<span style="color:#b84">&#39;h3&#39;</span>)[<span style="color:#099">0</span>]<span style="font-weight:bold">.</span>text)
</span></span><span style="display:flex;"><span>        times<span style="font-weight:bold">.</span>append(meta<span style="font-weight:bold">.</span>select(<span style="color:#b84">&#39;time&#39;</span>)[<span style="color:#099">0</span>][<span style="color:#b84">&#39;datetime&#39;</span>])
</span></span><span style="display:flex;"><span>        abstracts<span style="font-weight:bold">.</span>append(meta<span style="font-weight:bold">.</span>select(<span style="color:#b84">&#39;p&#39;</span>)[<span style="color:#099">0</span>]<span style="font-weight:bold">.</span>text)
</span></span><span style="display:flex;"><span>        contents<span style="font-weight:bold">.</span>append(get_content(p[<span style="color:#b84">&#39;href&#39;</span>]))
</span></span><span style="display:flex;"><span>    posts <span style="font-weight:bold">=</span> pd<span style="font-weight:bold">.</span>DataFrame({<span style="color:#b84">&#39;title&#39;</span>: titles, <span style="color:#b84">&#39;abstract&#39;</span>: abstracts, <span style="color:#b84">&#39;content&#39;</span>: contents}, index<span style="font-weight:bold">=</span>times)
</span></span><span style="display:flex;"><span>    posts<span style="font-weight:bold">.</span>index <span style="font-weight:bold">=</span> pd<span style="font-weight:bold">.</span>to_datetime(posts<span style="font-weight:bold">.</span>index)
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">return</span> posts
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>all_posts <span style="font-weight:bold">=</span> pd<span style="font-weight:bold">.</span>DataFrame(columns<span style="font-weight:bold">=</span>[<span style="color:#b84">&#39;title&#39;</span>, <span style="color:#b84">&#39;abstract&#39;</span>, <span style="color:#b84">&#39;content&#39;</span>])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>i <span style="font-weight:bold">=</span> <span style="color:#099">0</span>
</span></span><span style="display:flex;"><span><span style="font-weight:bold">while</span> <span style="font-weight:bold">True</span>:
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">try</span>:
</span></span><span style="display:flex;"><span>        i <span style="font-weight:bold">+=</span> <span style="color:#099">1</span>
</span></span><span style="display:flex;"><span>        <span style="color:#999">print</span>(<span style="color:#b84">f</span><span style="color:#b84">&#39;Crawling page </span><span style="color:#b84">{</span>i<span style="color:#b84">}</span><span style="color:#b84">: &#39;</span>, end<span style="font-weight:bold">=</span><span style="color:#b84">&#39;&#39;</span>)
</span></span><span style="display:flex;"><span>        url <span style="font-weight:bold">=</span> <span style="color:#b84">f</span><span style="color:#b84">&#39;https://www.coindesk.com/category/markets-news/page/</span><span style="color:#b84">{</span>i<span style="color:#b84">}</span><span style="color:#b84">&#39;</span>
</span></span><span style="display:flex;"><span>        soup <span style="font-weight:bold">=</span> get_soup(url, <span style="color:#b84">&#39;lxml&#39;</span>)
</span></span><span style="display:flex;"><span>        posts <span style="font-weight:bold">=</span> get_posts(soup)
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">if</span> posts <span style="font-weight:bold">is</span> <span style="font-weight:bold">None</span>: <span style="font-weight:bold">raise</span> <span style="color:#900;font-weight:bold">EOFError</span>
</span></span><span style="display:flex;"><span>        all_posts <span style="font-weight:bold">=</span> pd<span style="font-weight:bold">.</span>concat([all_posts, posts])
</span></span><span style="display:flex;"><span>        <span style="color:#999">print</span>(<span style="color:#b84">f</span><span style="color:#b84">&#39;finished (</span><span style="color:#b84">{</span>posts<span style="font-weight:bold">.</span>shape[<span style="color:#099">0</span>]<span style="color:#b84">}</span><span style="color:#b84"> posts)&#39;</span>)
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">except</span> <span style="color:#900;font-weight:bold">IndexError</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#999">print</span>(<span style="color:#b84">&#39;failed, retrying&#39;</span>, end<span style="font-weight:bold">=</span><span style="color:#b84">&#39;</span><span style="color:#b84">\r</span><span style="color:#b84">&#39;</span>)
</span></span><span style="display:flex;"><span>        i <span style="font-weight:bold">-=</span> <span style="color:#099">1</span>
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">except</span> (<span style="color:#900;font-weight:bold">EOFError</span>, <span style="color:#900;font-weight:bold">KeyboardInterrupt</span>):
</span></span><span style="display:flex;"><span>        <span style="color:#999">print</span>(<span style="color:#b84">&#39;terminated&#39;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#999">print</span>(<span style="color:#b84">f</span><span style="color:#b84">&#39;Total number of posts crawled: </span><span style="color:#b84">{</span>all_posts<span style="font-weight:bold">.</span>shape[<span style="color:#099">0</span>]<span style="color:#b84">}</span><span style="color:#b84">&#39;</span>)
</span></span><span style="display:flex;"><span>        all_posts<span style="font-weight:bold">.</span>to_csv(<span style="color:#b84">&#39;../data/posts.csv&#39;</span>)
</span></span><span style="display:flex;"><span>        exit()
</span></span></code></pre></div><h2 id="appendix-b-eod-data">Appendix B: EOD Data</h2>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span><span style="font-weight:bold">import</span> <span style="color:#555">os</span>
</span></span><span style="display:flex;"><span><span style="font-weight:bold">import</span> <span style="color:#555">json</span>
</span></span><span style="display:flex;"><span><span style="font-weight:bold">import</span> <span style="color:#555">sys</span>
</span></span><span style="display:flex;"><span><span style="font-weight:bold">import</span> <span style="color:#555">requests</span>
</span></span><span style="display:flex;"><span><span style="font-weight:bold">from</span> <span style="color:#555">bs4</span> <span style="font-weight:bold">import</span> BeautifulSoup
</span></span><span style="display:flex;"><span><span style="font-weight:bold">import</span> <span style="color:#555">pandas</span> <span style="font-weight:bold">as</span> <span style="color:#555">pd</span>
</span></span><span style="display:flex;"><span><span style="font-weight:bold">from</span> <span style="color:#555">_datetime</span> <span style="font-weight:bold">import</span> datetime, date, timedelta
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="font-weight:bold">def</span> <span style="color:#900;font-weight:bold">save_crypto_coins_history</span>(i_rank_start<span style="font-weight:bold">=</span><span style="color:#099">1</span>, i_rank_end<span style="font-weight:bold">=</span><span style="color:#099">10</span>, i_coin_file_path<span style="font-weight:bold">=</span><span style="color:#b84">&#39;crypto_coins&#39;</span>, i_from_date<span style="font-weight:bold">=</span><span style="font-weight:bold">None</span>, i_to_date<span style="font-weight:bold">=</span><span style="font-weight:bold">None</span>, i_min_volume<span style="font-weight:bold">=</span><span style="color:#099">100000</span>, i_coin_markets<span style="font-weight:bold">=</span>[]):
</span></span><span style="display:flex;"><span>    from_date, to_date <span style="font-weight:bold">=</span> get_from_to_dates(i_from_date, i_to_date)
</span></span><span style="display:flex;"><span>    rank_range_from_start <span style="font-weight:bold">=</span> i_rank_end <span style="font-weight:bold">-</span> i_rank_start <span style="font-weight:bold">+</span> <span style="color:#099">1</span>
</span></span><span style="display:flex;"><span>    coins_ranking_dict <span style="font-weight:bold">=</span> get_coins_current_ranking(i_rank_start, rank_range_from_start, i_min_volume)
</span></span><span style="display:flex;"><span>    df_coins <span style="font-weight:bold">=</span> pd<span style="font-weight:bold">.</span>DataFrame([])
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">for</span> rank, coin <span style="font-weight:bold">in</span> coins_ranking_dict<span style="font-weight:bold">.</span>items():
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">if</span> is_coin_in_markets(coin, <span style="color:#999">set</span>(i_coin_markets)):
</span></span><span style="display:flex;"><span>            df_coins <span style="font-weight:bold">=</span> df_coins<span style="font-weight:bold">.</span>append(get_coins_historical_data(rank, coin, from_date, to_date))
</span></span><span style="display:flex;"><span>            write_df_to_csv(df_coins, i_coin_file_path <span style="font-weight:bold">+</span> <span style="color:#b84">&#39;.csv&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="font-weight:bold">def</span> <span style="color:#900;font-weight:bold">get_coins_current_ranking</span>(i_start, i_limit, i_min_volume):
</span></span><span style="display:flex;"><span>    url_coin_list_json <span style="font-weight:bold">=</span> <span style="color:#b84">&#39;https://api.coinmarketcap.com/v1/ticker/?start=</span><span style="color:#b84">{}</span><span style="color:#b84">&amp;limit=</span><span style="color:#b84">{}</span><span style="color:#b84">&#39;</span><span style="font-weight:bold">.</span>format(i_start <span style="font-weight:bold">-</span> <span style="color:#099">1</span>, i_limit)
</span></span><span style="display:flex;"><span>    page <span style="font-weight:bold">=</span> requests<span style="font-weight:bold">.</span>get(url_coin_list_json)
</span></span><span style="display:flex;"><span>    json_file <span style="font-weight:bold">=</span> json<span style="font-weight:bold">.</span>loads(page<span style="font-weight:bold">.</span>text)
</span></span><span style="display:flex;"><span>    coins_dict <span style="font-weight:bold">=</span> {}
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">for</span> k <span style="font-weight:bold">in</span> json_file:
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">if</span> <span style="color:#999">float</span>(k[<span style="color:#b84">&#39;24h_volume_usd&#39;</span>]) <span style="font-weight:bold">&gt;=</span> i_min_volume:
</span></span><span style="display:flex;"><span>            coins_dict[k[<span style="color:#b84">&#39;rank&#39;</span>]] <span style="font-weight:bold">=</span> k[<span style="color:#b84">&#39;id&#39;</span>]
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">return</span> coins_dict
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="font-weight:bold">def</span> <span style="color:#900;font-weight:bold">get_coins_historical_data</span>(i_rank, i_coin, i_from_date, i_to_date):
</span></span><span style="display:flex;"><span>    df_coin <span style="font-weight:bold">=</span> get_specific_coin_historical_data(i_coin, i_from_date, i_to_date)
</span></span><span style="display:flex;"><span>    df_coin[<span style="color:#b84">&#39;Coin&#39;</span>] <span style="font-weight:bold">=</span> i_coin
</span></span><span style="display:flex;"><span>    df_coin[<span style="color:#b84">&#39;Cur. Rank&#39;</span>] <span style="font-weight:bold">=</span> i_rank
</span></span><span style="display:flex;"><span>    df_coin <span style="font-weight:bold">=</span> pd<span style="font-weight:bold">.</span>concat([df_coin<span style="font-weight:bold">.</span>iloc[:, <span style="color:#099">7</span>:], df_coin<span style="font-weight:bold">.</span>iloc[:, <span style="color:#099">0</span>:<span style="color:#099">7</span>]], axis<span style="font-weight:bold">=</span><span style="color:#099">1</span>, join_axes<span style="font-weight:bold">=</span>[df_coin<span style="font-weight:bold">.</span>index])
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">return</span> df_coin
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="font-weight:bold">def</span> <span style="color:#900;font-weight:bold">get_specific_coin_historical_data</span>(i_coin, i_from_date, i_to_date):
</span></span><span style="display:flex;"><span>    currencies <span style="font-weight:bold">=</span> <span style="color:#b84">&#34;https://coinmarketcap.com/currencies/&#34;</span>
</span></span><span style="display:flex;"><span>    currencies_end <span style="font-weight:bold">=</span> <span style="color:#b84">&#39;/historical-data/&#39;</span>
</span></span><span style="display:flex;"><span>    dates <span style="font-weight:bold">=</span> <span style="color:#b84">&#39;?start=</span><span style="color:#b84">{}</span><span style="color:#b84">&amp;end=</span><span style="color:#b84">{}</span><span style="color:#b84">&#39;</span><span style="font-weight:bold">.</span>format(i_from_date, i_to_date)
</span></span><span style="display:flex;"><span>    url <span style="font-weight:bold">=</span> currencies <span style="font-weight:bold">+</span> i_coin <span style="font-weight:bold">+</span> currencies_end <span style="font-weight:bold">+</span> dates
</span></span><span style="display:flex;"><span>    page <span style="font-weight:bold">=</span> requests<span style="font-weight:bold">.</span>get(url)
</span></span><span style="display:flex;"><span>    soup <span style="font-weight:bold">=</span> BeautifulSoup(page<span style="font-weight:bold">.</span>text, <span style="color:#b84">&#39;html.parser&#39;</span>)
</span></span><span style="display:flex;"><span>    table <span style="font-weight:bold">=</span> soup<span style="font-weight:bold">.</span>find(<span style="color:#b84">&#39;table&#39;</span>)
</span></span><span style="display:flex;"><span>    data <span style="font-weight:bold">=</span> {<span style="color:#b84">&#39;Date&#39;</span>: [], <span style="color:#b84">&#39;Open&#39;</span>: [], <span style="color:#b84">&#39;High&#39;</span>: [], <span style="color:#b84">&#39;Low&#39;</span>: [], <span style="color:#b84">&#39;Close&#39;</span>: [], <span style="color:#b84">&#39;Volume&#39;</span>: [], <span style="color:#b84">&#39;Market Cap&#39;</span>: []}
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">try</span>:
</span></span><span style="display:flex;"><span>        rows <span style="font-weight:bold">=</span> table<span style="font-weight:bold">.</span>findAll(<span style="color:#b84">&#39;tr&#39;</span>)[<span style="color:#099">1</span>:]
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">for</span> row <span style="font-weight:bold">in</span> rows:
</span></span><span style="display:flex;"><span>            cols <span style="font-weight:bold">=</span> row<span style="font-weight:bold">.</span>findAll(<span style="color:#b84">&#39;td&#39;</span>)
</span></span><span style="display:flex;"><span>            data[<span style="color:#b84">&#39;Date&#39;</span>]<span style="font-weight:bold">.</span>append(cols[<span style="color:#099">0</span>]<span style="font-weight:bold">.</span>string)
</span></span><span style="display:flex;"><span>            data[<span style="color:#b84">&#39;Open&#39;</span>]<span style="font-weight:bold">.</span>append(cols[<span style="color:#099">1</span>]<span style="font-weight:bold">.</span>string)
</span></span><span style="display:flex;"><span>            data[<span style="color:#b84">&#39;High&#39;</span>]<span style="font-weight:bold">.</span>append(cols[<span style="color:#099">2</span>]<span style="font-weight:bold">.</span>string)
</span></span><span style="display:flex;"><span>            data[<span style="color:#b84">&#39;Low&#39;</span>]<span style="font-weight:bold">.</span>append(cols[<span style="color:#099">3</span>]<span style="font-weight:bold">.</span>string)
</span></span><span style="display:flex;"><span>            data[<span style="color:#b84">&#39;Close&#39;</span>]<span style="font-weight:bold">.</span>append(cols[<span style="color:#099">4</span>]<span style="font-weight:bold">.</span>string)
</span></span><span style="display:flex;"><span>            data[<span style="color:#b84">&#39;Volume&#39;</span>]<span style="font-weight:bold">.</span>append(cols[<span style="color:#099">5</span>]<span style="font-weight:bold">.</span>string)
</span></span><span style="display:flex;"><span>            data[<span style="color:#b84">&#39;Market Cap&#39;</span>]<span style="font-weight:bold">.</span>append(cols[<span style="color:#099">6</span>]<span style="font-weight:bold">.</span>string)
</span></span><span style="display:flex;"><span>        coin_data <span style="font-weight:bold">=</span> pd<span style="font-weight:bold">.</span>DataFrame(data)
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">except</span> <span style="color:#900;font-weight:bold">AttributeError</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#999">print</span>(<span style="color:#b84">&#39;input parameters not valid&#39;</span>)
</span></span><span style="display:flex;"><span>        sys<span style="font-weight:bold">.</span>exit(<span style="color:#099">13</span>)
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">return</span> coin_data
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="font-weight:bold">def</span> <span style="color:#900;font-weight:bold">write_df_to_csv</span>(i_df, i_file):
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">try</span>:
</span></span><span style="display:flex;"><span>        i_df<span style="font-weight:bold">.</span>to_csv(i_file)
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">except</span> <span style="color:#900;font-weight:bold">IOError</span> <span style="font-weight:bold">as</span> e:
</span></span><span style="display:flex;"><span>        <span style="color:#999">print</span>(e)
</span></span><span style="display:flex;"><span>        sys<span style="font-weight:bold">.</span>exit(<span style="color:#099">13</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="font-weight:bold">def</span> <span style="color:#900;font-weight:bold">get_from_to_dates</span>(i_from_date, i_to_date):
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">try</span>:
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">if</span> i_from_date <span style="font-weight:bold">is</span> <span style="font-weight:bold">None</span>:
</span></span><span style="display:flex;"><span>            from_date <span style="font-weight:bold">=</span> <span style="color:#999">str</span>(date<span style="font-weight:bold">.</span>today() <span style="font-weight:bold">+</span> timedelta(days<span style="font-weight:bold">=-</span><span style="color:#099">30</span>))
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">else</span>:
</span></span><span style="display:flex;"><span>            from_date <span style="font-weight:bold">=</span> i_from_date
</span></span><span style="display:flex;"><span>        from_date <span style="font-weight:bold">=</span> datetime<span style="font-weight:bold">.</span>strptime(from_date, <span style="color:#b84">&#39;%Y-%m-</span><span style="color:#b84">%d</span><span style="color:#b84">&#39;</span>)<span style="font-weight:bold">.</span>strftime(<span style="color:#b84">&#39;%Y%m</span><span style="color:#b84">%d</span><span style="color:#b84">&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">if</span> i_to_date <span style="font-weight:bold">is</span> <span style="font-weight:bold">None</span>:
</span></span><span style="display:flex;"><span>            to_date <span style="font-weight:bold">=</span> <span style="color:#999">str</span>(date<span style="font-weight:bold">.</span>today() <span style="font-weight:bold">+</span> timedelta(days<span style="font-weight:bold">=-</span><span style="color:#099">1</span>))
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">else</span>:
</span></span><span style="display:flex;"><span>            to_date <span style="font-weight:bold">=</span> i_to_date
</span></span><span style="display:flex;"><span>        to_date <span style="font-weight:bold">=</span> datetime<span style="font-weight:bold">.</span>strptime(to_date, <span style="color:#b84">&#39;%Y-%m-</span><span style="color:#b84">%d</span><span style="color:#b84">&#39;</span>)<span style="font-weight:bold">.</span>strftime(<span style="color:#b84">&#39;%Y%m</span><span style="color:#b84">%d</span><span style="color:#b84">&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">return</span> from_date, to_date
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">except</span> <span style="color:#900;font-weight:bold">ValueError</span> <span style="font-weight:bold">as</span> e:
</span></span><span style="display:flex;"><span>        <span style="color:#999">print</span>(e)
</span></span><span style="display:flex;"><span>        sys<span style="font-weight:bold">.</span>exit(<span style="color:#099">13</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="font-weight:bold">def</span> <span style="color:#900;font-weight:bold">is_coin_in_markets</span>(i_coin, i_coin_markets_to_search):
</span></span><span style="display:flex;"><span>    coin_in_markets <span style="font-weight:bold">=</span> <span style="font-weight:bold">False</span>
</span></span><span style="display:flex;"><span>    coin_markets_url <span style="font-weight:bold">=</span> <span style="color:#b84">&#39;https://coinmarketcap.com/currencies/</span><span style="color:#b84">{}</span><span style="color:#b84">/#markets&#39;</span><span style="font-weight:bold">.</span>format(i_coin)
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">if</span> <span style="font-weight:bold">not</span> i_coin_markets_to_search:
</span></span><span style="display:flex;"><span>        coin_in_markets <span style="font-weight:bold">=</span> <span style="font-weight:bold">True</span>
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">else</span>:
</span></span><span style="display:flex;"><span>        page <span style="font-weight:bold">=</span> requests<span style="font-weight:bold">.</span>get(coin_markets_url)
</span></span><span style="display:flex;"><span>        soup <span style="font-weight:bold">=</span> BeautifulSoup(page<span style="font-weight:bold">.</span>text, <span style="color:#b84">&#39;html.parser&#39;</span>)
</span></span><span style="display:flex;"><span>        table <span style="font-weight:bold">=</span> soup<span style="font-weight:bold">.</span>find(<span style="color:#b84">&#39;table&#39;</span>)
</span></span><span style="display:flex;"><span>        rows <span style="font-weight:bold">=</span> table<span style="font-weight:bold">.</span>findAll(<span style="color:#b84">&#39;tr&#39;</span>)[<span style="color:#099">1</span>:]
</span></span><span style="display:flex;"><span>        markets <span style="font-weight:bold">=</span> <span style="color:#999">set</span>()
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">for</span> row <span style="font-weight:bold">in</span> rows:
</span></span><span style="display:flex;"><span>            cols <span style="font-weight:bold">=</span> row<span style="font-weight:bold">.</span>findAll(<span style="color:#b84">&#39;td&#39;</span>)
</span></span><span style="display:flex;"><span>            <span style="font-weight:bold">if</span> cols[<span style="color:#099">1</span>]<span style="font-weight:bold">.</span>text <span style="font-weight:bold">is</span> <span style="font-weight:bold">not</span> <span style="font-weight:bold">None</span>:
</span></span><span style="display:flex;"><span>                markets<span style="font-weight:bold">.</span>add(cols[<span style="color:#099">1</span>]<span style="font-weight:bold">.</span>text<span style="font-weight:bold">.</span>upper())
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="font-weight:bold">for</span> market <span style="font-weight:bold">in</span> i_coin_markets_to_search:
</span></span><span style="display:flex;"><span>                <span style="font-weight:bold">if</span> market<span style="font-weight:bold">.</span>upper() <span style="font-weight:bold">in</span> markets:
</span></span><span style="display:flex;"><span>                    coin_in_markets <span style="font-weight:bold">=</span> <span style="font-weight:bold">True</span>
</span></span><span style="display:flex;"><span>                    <span style="font-weight:bold">break</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">return</span> coin_in_markets
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="font-weight:bold">if</span> __name__ <span style="font-weight:bold">==</span> <span style="color:#b84">&#39;__main__&#39;</span>:
</span></span><span style="display:flex;"><span>    symbols <span style="font-weight:bold">=</span> [
</span></span><span style="display:flex;"><span>        (<span style="color:#b84">&#39;ANC&#39;</span>, <span style="color:#b84">&#39;anoncoin&#39;</span>),
</span></span><span style="display:flex;"><span>        (<span style="color:#b84">&#39;BTB&#39;</span>, <span style="color:#b84">&#39;bitbar&#39;</span>),
</span></span><span style="display:flex;"><span>        (<span style="color:#b84">&#39;BTC&#39;</span>, <span style="color:#b84">&#39;bitcoin&#39;</span>),
</span></span><span style="display:flex;"><span>        (<span style="color:#b84">&#39;DGC&#39;</span>, <span style="color:#b84">&#39;digitalcoin&#39;</span>),
</span></span><span style="display:flex;"><span>        (<span style="color:#b84">&#39;DOGE&#39;</span>, <span style="color:#b84">&#39;dogecoin&#39;</span>),
</span></span><span style="display:flex;"><span>        (<span style="color:#b84">&#39;FRC&#39;</span>, <span style="color:#b84">&#39;freicoin&#39;</span>),
</span></span><span style="display:flex;"><span>        (<span style="color:#b84">&#39;FTC&#39;</span>, <span style="color:#b84">&#39;feathercoin&#39;</span>),
</span></span><span style="display:flex;"><span>        (<span style="color:#b84">&#39;IXC&#39;</span>, <span style="color:#b84">&#39;ixcoin&#39;</span>),
</span></span><span style="display:flex;"><span>        (<span style="color:#b84">&#39;LTC&#39;</span>, <span style="color:#b84">&#39;litecoin&#39;</span>),
</span></span><span style="display:flex;"><span>        (<span style="color:#b84">&#39;MEC&#39;</span>, <span style="color:#b84">&#39;megacoin&#39;</span>),
</span></span><span style="display:flex;"><span>        (<span style="color:#b84">&#39;MNC&#39;</span>, <span style="color:#b84">&#39;mincoin&#39;</span>),
</span></span><span style="display:flex;"><span>        (<span style="color:#b84">&#39;NMC&#39;</span>, <span style="color:#b84">&#39;namecoin&#39;</span>),
</span></span><span style="display:flex;"><span>        (<span style="color:#b84">&#39;NVC&#39;</span>, <span style="color:#b84">&#39;novacoin&#39;</span>),
</span></span><span style="display:flex;"><span>        (<span style="color:#b84">&#39;NXT&#39;</span>, <span style="color:#b84">&#39;nxt&#39;</span>),
</span></span><span style="display:flex;"><span>        (<span style="color:#b84">&#39;OMNI&#39;</span>, <span style="color:#b84">&#39;omni&#39;</span>),
</span></span><span style="display:flex;"><span>        (<span style="color:#b84">&#39;PPC&#39;</span>, <span style="color:#b84">&#39;peercoin&#39;</span>),
</span></span><span style="display:flex;"><span>        (<span style="color:#b84">&#39;QRK&#39;</span>, <span style="color:#b84">&#39;quark&#39;</span>),
</span></span><span style="display:flex;"><span>        (<span style="color:#b84">&#39;WDC&#39;</span>, <span style="color:#b84">&#39;worldcoin&#39;</span>),
</span></span><span style="display:flex;"><span>        (<span style="color:#b84">&#39;XPM&#39;</span>, <span style="color:#b84">&#39;primecoin&#39;</span>),
</span></span><span style="display:flex;"><span>        (<span style="color:#b84">&#39;XRP&#39;</span>, <span style="color:#b84">&#39;ripple&#39;</span>),
</span></span><span style="display:flex;"><span>        (<span style="color:#b84">&#39;ZET&#39;</span>, <span style="color:#b84">&#39;zetacoin&#39;</span>),
</span></span><span style="display:flex;"><span>    ]
</span></span><span style="display:flex;"><span>    price <span style="font-weight:bold">=</span> <span style="color:#999">dict</span>()
</span></span><span style="display:flex;"><span>    mkcap <span style="font-weight:bold">=</span> <span style="color:#999">dict</span>()
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">for</span> sym, i_coin <span style="font-weight:bold">in</span> symbols:
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">if</span> <span style="font-weight:bold">not</span> os<span style="font-weight:bold">.</span>path<span style="font-weight:bold">.</span>isfile(<span style="color:#b84">f</span><span style="color:#b84">&#39;</span><span style="color:#b84">{</span>i_coin<span style="color:#b84">}</span><span style="color:#b84">.csv&#39;</span>):
</span></span><span style="display:flex;"><span>            <span style="font-weight:bold">try</span>:
</span></span><span style="display:flex;"><span>                <span style="color:#999">print</span>(<span style="color:#b84">f</span><span style="color:#b84">&#39;Downloading </span><span style="color:#b84">{</span>i_coin<span style="color:#b84">:</span><span style="color:#b84">&gt;12</span><span style="color:#b84">}</span><span style="color:#b84">&#39;</span>, end<span style="font-weight:bold">=</span><span style="color:#b84">&#39;: &#39;</span>)
</span></span><span style="display:flex;"><span>                df <span style="font-weight:bold">=</span> get_specific_coin_historical_data(i_coin, <span style="color:#b84">&#39;20120101&#39;</span>, <span style="color:#b84">&#39;20190520&#39;</span>)[::<span style="font-weight:bold">-</span><span style="color:#099">1</span>]
</span></span><span style="display:flex;"><span>                <span style="color:#999">print</span>(df<span style="font-weight:bold">.</span>Date<span style="font-weight:bold">.</span>iloc[<span style="color:#099">0</span>], df<span style="font-weight:bold">.</span>Date<span style="font-weight:bold">.</span>iloc[<span style="font-weight:bold">-</span><span style="color:#099">1</span>])
</span></span><span style="display:flex;"><span>                df<span style="font-weight:bold">.</span>to_csv(<span style="color:#b84">f</span><span style="color:#b84">&#39;</span><span style="color:#b84">{</span>i_coin<span style="color:#b84">}</span><span style="color:#b84">.csv&#39;</span>)
</span></span><span style="display:flex;"><span>            <span style="font-weight:bold">except</span>:
</span></span><span style="display:flex;"><span>                <span style="color:#999">print</span>(<span style="color:#b84">&#39;failed&#39;</span>)
</span></span><span style="display:flex;"><span>                <span style="font-weight:bold">pass</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">for</span> sym, i_coin <span style="font-weight:bold">in</span> symbols:
</span></span><span style="display:flex;"><span>        <span style="color:#999">print</span>(<span style="color:#b84">f</span><span style="color:#b84">&#39;Loading </span><span style="color:#b84">{</span>i_coin<span style="color:#b84">:</span><span style="color:#b84">&gt;12</span><span style="color:#b84">}</span><span style="color:#b84">&#39;</span>, end<span style="font-weight:bold">=</span><span style="color:#b84">&#39;: &#39;</span>)
</span></span><span style="display:flex;"><span>        df <span style="font-weight:bold">=</span> pd<span style="font-weight:bold">.</span>read_csv(<span style="color:#b84">f</span><span style="color:#b84">&#39;</span><span style="color:#b84">{</span>i_coin<span style="color:#b84">}</span><span style="color:#b84">.csv&#39;</span>)<span style="font-weight:bold">.</span>set_index(<span style="color:#b84">&#39;Date&#39;</span>)
</span></span><span style="display:flex;"><span>        df<span style="font-weight:bold">.</span>index <span style="font-weight:bold">=</span> pd<span style="font-weight:bold">.</span>to_datetime(df<span style="font-weight:bold">.</span>index)
</span></span><span style="display:flex;"><span>        <span style="color:#999">print</span>(df<span style="font-weight:bold">.</span>index[<span style="color:#099">0</span>]<span style="font-weight:bold">.</span>date(), df<span style="font-weight:bold">.</span>index[<span style="font-weight:bold">-</span><span style="color:#099">1</span>]<span style="font-weight:bold">.</span>date())
</span></span><span style="display:flex;"><span>        price[sym] <span style="font-weight:bold">=</span> df[<span style="color:#b84">&#39;Close&#39;</span>]
</span></span><span style="display:flex;"><span>        mkcap[sym] <span style="font-weight:bold">=</span> df[<span style="color:#b84">&#39;Market Cap&#39;</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">def</span> <span style="color:#900;font-weight:bold">convert</span>(x):
</span></span><span style="display:flex;"><span>        s <span style="font-weight:bold">=</span> <span style="color:#999">str</span>(x)<span style="font-weight:bold">.</span>replace(<span style="color:#b84">&#39;,&#39;</span>, <span style="color:#b84">&#39;&#39;</span>)
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">try</span>:
</span></span><span style="display:flex;"><span>            <span style="font-weight:bold">return</span> <span style="color:#999">float</span>(s)
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">except</span>:
</span></span><span style="display:flex;"><span>            <span style="font-weight:bold">if</span> s <span style="font-weight:bold">==</span> <span style="color:#b84">&#39;-&#39;</span>:
</span></span><span style="display:flex;"><span>                <span style="font-weight:bold">return</span> <span style="color:#999">float</span>(<span style="color:#b84">&#39;nan&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    price <span style="font-weight:bold">=</span> pd<span style="font-weight:bold">.</span>DataFrame(price)<span style="font-weight:bold">.</span>dropna()<span style="font-weight:bold">.</span>applymap(convert)<span style="font-weight:bold">.</span>fillna(method<span style="font-weight:bold">=</span><span style="color:#b84">&#39;ffill&#39;</span>)
</span></span><span style="display:flex;"><span>    price<span style="font-weight:bold">.</span>index<span style="font-weight:bold">.</span>name <span style="font-weight:bold">=</span> <span style="font-weight:bold">None</span>
</span></span><span style="display:flex;"><span>    price<span style="font-weight:bold">.</span>to_csv(<span style="color:#b84">&#39;../data/price.csv&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    mkcap <span style="font-weight:bold">=</span> pd<span style="font-weight:bold">.</span>DataFrame(mkcap)<span style="font-weight:bold">.</span>dropna()<span style="font-weight:bold">.</span>applymap(convert)<span style="font-weight:bold">.</span>fillna(method<span style="font-weight:bold">=</span><span style="color:#b84">&#39;ffill&#39;</span>)
</span></span><span style="display:flex;"><span>    mkcap<span style="font-weight:bold">.</span>index<span style="font-weight:bold">.</span>name <span style="font-weight:bold">=</span> <span style="font-weight:bold">None</span>
</span></span><span style="display:flex;"><span>    mkcap<span style="font-weight:bold">.</span>to_csv(<span style="color:#b84">&#39;../data/mkcap.csv&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#999">print</span>(<span style="color:#b84">&#39;Task finished&#39;</span>)
</span></span></code></pre></div><p>Now we starting generating new features from these posts. First let&rsquo;s take a look at the data.</p>
<h2 id="appendix-c-backtest-engine-and-hyper-parameter-testing">Appendix C: Backtest Engine and Hyper-Parameter Testing</h2>
<p>In this section, we give the full code of our backtest engine as well as the full list of hyper-parameter testing results. The scripts for engine is as below.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span><span style="font-weight:bold">import</span> <span style="color:#555">numpy</span> <span style="font-weight:bold">as</span> <span style="color:#555">np</span>
</span></span><span style="display:flex;"><span><span style="font-weight:bold">import</span> <span style="color:#555">pandas</span> <span style="font-weight:bold">as</span> <span style="color:#555">pd</span>
</span></span><span style="display:flex;"><span><span style="font-weight:bold">from</span> <span style="color:#555">collections</span> <span style="font-weight:bold">import</span> Counter
</span></span><span style="display:flex;"><span><span style="font-weight:bold">from</span> <span style="color:#555">scipy.optimize</span> <span style="font-weight:bold">import</span> minimize
</span></span><span style="display:flex;"><span><span style="font-weight:bold">from</span> <span style="color:#555">wordcloud</span> <span style="font-weight:bold">import</span> STOPWORDS
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="font-weight:bold">class</span> <span style="color:#458;font-weight:bold">BacktestEngine</span>:
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">def</span> __init__(self):
</span></span><span style="display:flex;"><span>        df <span style="font-weight:bold">=</span> pd<span style="font-weight:bold">.</span>read_csv(<span style="color:#b84">&#39;data/posts.csv&#39;</span>, index_col<span style="font-weight:bold">=</span><span style="color:#099">0</span>)
</span></span><span style="display:flex;"><span>        df<span style="font-weight:bold">.</span>index <span style="font-weight:bold">=</span> pd<span style="font-weight:bold">.</span>to_datetime(df<span style="font-weight:bold">.</span>index)<span style="font-weight:bold">.</span>date
</span></span><span style="display:flex;"><span>        df_eod <span style="font-weight:bold">=</span> df<span style="font-weight:bold">.</span>copy()
</span></span><span style="display:flex;"><span>        df_eod[<span style="color:#b84">&#39;date&#39;</span>] <span style="font-weight:bold">=</span> pd<span style="font-weight:bold">.</span>to_datetime(df_eod<span style="font-weight:bold">.</span>index)<span style="font-weight:bold">.</span>date
</span></span><span style="display:flex;"><span>        g <span style="font-weight:bold">=</span> df_eod<span style="font-weight:bold">.</span>groupby(<span style="color:#b84">&#39;date&#39;</span>)
</span></span><span style="display:flex;"><span>        title <span style="font-weight:bold">=</span> g<span style="font-weight:bold">.</span>title<span style="font-weight:bold">.</span>apply(<span style="color:#b84">&#39; &#39;</span><span style="font-weight:bold">.</span>join)
</span></span><span style="display:flex;"><span>        abstract <span style="font-weight:bold">=</span> g<span style="font-weight:bold">.</span>abstract<span style="font-weight:bold">.</span>apply(<span style="color:#b84">&#39; &#39;</span><span style="font-weight:bold">.</span>join)
</span></span><span style="display:flex;"><span>        content <span style="font-weight:bold">=</span> g<span style="font-weight:bold">.</span>content<span style="font-weight:bold">.</span>apply(<span style="font-weight:bold">lambda</span> x: <span style="color:#b84">&#39;</span><span style="color:#b84">\n\n</span><span style="color:#b84">&#39;</span><span style="font-weight:bold">.</span>join(<span style="color:#999">map</span>(<span style="color:#999">str</span>, x<span style="font-weight:bold">.</span>values)))
</span></span><span style="display:flex;"><span>        df_eod <span style="font-weight:bold">=</span> pd<span style="font-weight:bold">.</span>concat([title, abstract, content], axis<span style="font-weight:bold">=</span><span style="color:#099">1</span>)
</span></span><span style="display:flex;"><span>        df_eod<span style="font-weight:bold">.</span>index <span style="font-weight:bold">=</span> pd<span style="font-weight:bold">.</span>to_datetime(df_eod<span style="font-weight:bold">.</span>index)
</span></span><span style="display:flex;"><span>        df_eod<span style="font-weight:bold">.</span>index<span style="font-weight:bold">.</span>name <span style="font-weight:bold">=</span> <span style="font-weight:bold">None</span>
</span></span><span style="display:flex;"><span>        df_eod<span style="font-weight:bold">.</span>title <span style="font-weight:bold">=</span> df_eod<span style="font-weight:bold">.</span>title<span style="font-weight:bold">.</span>str<span style="font-weight:bold">.</span>lower()
</span></span><span style="display:flex;"><span>        df_eod<span style="font-weight:bold">.</span>abstract <span style="font-weight:bold">=</span> df_eod<span style="font-weight:bold">.</span>abstract<span style="font-weight:bold">.</span>str<span style="font-weight:bold">.</span>lower()
</span></span><span style="display:flex;"><span>        df_eod<span style="font-weight:bold">.</span>content <span style="font-weight:bold">=</span> df_eod<span style="font-weight:bold">.</span>content<span style="font-weight:bold">.</span>str<span style="font-weight:bold">.</span>lower()
</span></span><span style="display:flex;"><span>        remove_abbr <span style="font-weight:bold">=</span> <span style="font-weight:bold">lambda</span> x: <span style="color:#b84">&#39; &#39;</span><span style="font-weight:bold">.</span>join([_<span style="font-weight:bold">.</span>split(<span style="color:#b84">&#39;’&#39;</span>)[<span style="color:#099">0</span>] <span style="font-weight:bold">for</span> _ <span style="font-weight:bold">in</span> x<span style="font-weight:bold">.</span>split()])
</span></span><span style="display:flex;"><span>        df_eod <span style="font-weight:bold">=</span> df_eod<span style="font-weight:bold">.</span>applymap(remove_abbr)
</span></span><span style="display:flex;"><span>        alph_space <span style="font-weight:bold">=</span> <span style="font-weight:bold">lambda</span> x: (<span style="color:#999">ord</span>(<span style="color:#b84">&#39;a&#39;</span>) <span style="font-weight:bold">&lt;=</span> <span style="color:#999">ord</span>(x) <span style="font-weight:bold">&lt;=</span> <span style="color:#999">ord</span>(<span style="color:#b84">&#39;z&#39;</span>)) <span style="font-weight:bold">or</span> x <span style="font-weight:bold">==</span> <span style="color:#b84">&#39; &#39;</span>
</span></span><span style="display:flex;"><span>        keep_alph <span style="font-weight:bold">=</span> <span style="font-weight:bold">lambda</span> x: <span style="color:#b84">&#39;&#39;</span><span style="font-weight:bold">.</span>join(<span style="color:#999">filter</span>(alph_space, x))
</span></span><span style="display:flex;"><span>        df_eod <span style="font-weight:bold">=</span> df_eod<span style="font-weight:bold">.</span>applymap(keep_alph)
</span></span><span style="display:flex;"><span>        replace_stop_words <span style="font-weight:bold">=</span> <span style="font-weight:bold">lambda</span> x: <span style="color:#b84">&#39; &#39;</span><span style="font-weight:bold">.</span>join(_ <span style="font-weight:bold">for</span> _ <span style="font-weight:bold">in</span> x<span style="font-weight:bold">.</span>split() <span style="font-weight:bold">if</span> _ <span style="font-weight:bold">not</span> <span style="font-weight:bold">in</span> STOPWORDS)
</span></span><span style="display:flex;"><span>        df_eod <span style="font-weight:bold">=</span> df_eod<span style="font-weight:bold">.</span>applymap(replace_stop_words)
</span></span><span style="display:flex;"><span>        df_eod <span style="font-weight:bold">=</span> df_eod<span style="font-weight:bold">.</span>applymap(<span style="color:#999">str</span><span style="font-weight:bold">.</span>split)<span style="font-weight:bold">.</span>applymap(<span style="color:#999">sorted</span>)
</span></span><span style="display:flex;"><span>        price <span style="font-weight:bold">=</span> pd<span style="font-weight:bold">.</span>read_csv(<span style="color:#b84">&#39;data/price.csv&#39;</span>, index_col<span style="font-weight:bold">=</span><span style="color:#099">0</span>)
</span></span><span style="display:flex;"><span>        price<span style="font-weight:bold">.</span>index <span style="font-weight:bold">=</span> pd<span style="font-weight:bold">.</span>to_datetime(price<span style="font-weight:bold">.</span>index)
</span></span><span style="display:flex;"><span>        mkcap <span style="font-weight:bold">=</span> pd<span style="font-weight:bold">.</span>read_csv(<span style="color:#b84">&#39;data/mkcap.csv&#39;</span>, index_col<span style="font-weight:bold">=</span><span style="color:#099">0</span>)
</span></span><span style="display:flex;"><span>        mkcap<span style="font-weight:bold">.</span>index <span style="font-weight:bold">=</span> pd<span style="font-weight:bold">.</span>to_datetime(mkcap<span style="font-weight:bold">.</span>index)
</span></span><span style="display:flex;"><span>        self<span style="font-weight:bold">.</span>data <span style="font-weight:bold">=</span> (price, mkcap, df_eod)  <span style="color:#998;font-style:italic"># store data for later usage</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">def</span> <span style="color:#900;font-weight:bold">run</span>(self, lookback_window<span style="font-weight:bold">=</span><span style="color:#099">60</span>, minimum_occurrence<span style="font-weight:bold">=</span><span style="color:#099">50</span>, minimum_length<span style="font-weight:bold">=</span><span style="color:#099">5</span>, alpha<span style="font-weight:bold">=</span><span style="color:#099">.1</span>, size<span style="font-weight:bold">=</span><span style="font-weight:bold">lambda</span> x: <span style="color:#099">2</span> <span style="font-weight:bold">*</span> x <span style="font-weight:bold">-</span> <span style="color:#099">1</span>):
</span></span><span style="display:flex;"><span>        n <span style="font-weight:bold">=</span> <span style="color:#099">3</span>  <span style="color:#998;font-style:italic"># number of coins to hold (long/short)</span>
</span></span><span style="display:flex;"><span>        d <span style="font-weight:bold">=</span> lookback_window  <span style="color:#998;font-style:italic"># number of days to train</span>
</span></span><span style="display:flex;"><span>        price, mkcap, df_eod <span style="font-weight:bold">=</span> self<span style="font-weight:bold">.</span>data  <span style="color:#998;font-style:italic"># data stored for training (reusable)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        rtn <span style="font-weight:bold">=</span> price<span style="font-weight:bold">.</span>pct_change()<span style="font-weight:bold">.</span>fillna(<span style="color:#099">0</span>)
</span></span><span style="display:flex;"><span>        rtn<span style="font-weight:bold">.</span>index<span style="font-weight:bold">.</span>name <span style="font-weight:bold">=</span> <span style="font-weight:bold">None</span>
</span></span><span style="display:flex;"><span>        temp <span style="font-weight:bold">=</span> (rtn <span style="font-weight:bold">*</span> (mkcap<span style="font-weight:bold">.</span>agg(<span style="color:#b84">&#39;argsort&#39;</span>) <span style="font-weight:bold">&lt;</span> <span style="color:#099">10</span>))<span style="font-weight:bold">.</span>rolling(d)<span style="font-weight:bold">.</span>sum()<span style="font-weight:bold">.</span>T
</span></span><span style="display:flex;"><span>        coins <span style="font-weight:bold">=</span> pd<span style="font-weight:bold">.</span>DataFrame(
</span></span><span style="display:flex;"><span>            [temp<span style="font-weight:bold">.</span>nlargest(n, t)<span style="font-weight:bold">.</span>index<span style="font-weight:bold">.</span>tolist() <span style="font-weight:bold">+</span> temp<span style="font-weight:bold">.</span>nsmallest(n, t)<span style="font-weight:bold">.</span>index<span style="font-weight:bold">.</span>tolist() <span style="font-weight:bold">for</span> t <span style="font-weight:bold">in</span> rtn<span style="font-weight:bold">.</span>index],
</span></span><span style="display:flex;"><span>            index<span style="font-weight:bold">=</span>rtn<span style="font-weight:bold">.</span>index)<span style="font-weight:bold">.</span>shift()<span style="font-weight:bold">.</span>dropna()  <span style="color:#998;font-style:italic"># shift to avoid forward-looking bias</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        coef <span style="font-weight:bold">=</span> np<span style="font-weight:bold">.</span>array([<span style="color:#099">1</span>] <span style="font-weight:bold">*</span> n <span style="font-weight:bold">+</span> [<span style="font-weight:bold">-</span><span style="color:#099">1</span>] <span style="font-weight:bold">*</span> n) <span style="font-weight:bold">/</span> n
</span></span><span style="display:flex;"><span>        rtn <span style="font-weight:bold">=</span> pd<span style="font-weight:bold">.</span>DataFrame([rtn<span style="font-weight:bold">.</span>loc[t, coins<span style="font-weight:bold">.</span>loc[t]<span style="font-weight:bold">.</span>values] <span style="font-weight:bold">@</span> coef <span style="font-weight:bold">for</span> t <span style="font-weight:bold">in</span> coins<span style="font-weight:bold">.</span>index], index<span style="font-weight:bold">=</span>coins<span style="font-weight:bold">.</span>index)[<span style="color:#099">0</span>]
</span></span><span style="display:flex;"><span>        rtn<span style="font-weight:bold">.</span>name <span style="font-weight:bold">=</span> <span style="color:#b84">&#39;r&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        df_total <span style="font-weight:bold">=</span> df_eod[[<span style="color:#b84">&#39;content&#39;</span>]]<span style="font-weight:bold">.</span>join(rtn, how<span style="font-weight:bold">=</span><span style="color:#b84">&#39;inner&#39;</span>)<span style="font-weight:bold">.</span>dropna()
</span></span><span style="display:flex;"><span>        df_total[<span style="color:#b84">&#39;p&#39;</span>] <span style="font-weight:bold">=</span> np<span style="font-weight:bold">.</span>argsort(df_total<span style="font-weight:bold">.</span>iloc[:, <span style="color:#099">1</span>]) <span style="font-weight:bold">/</span> (df_total<span style="font-weight:bold">.</span>shape[<span style="color:#099">0</span>] <span style="font-weight:bold">-</span> <span style="color:#099">1</span>)
</span></span><span style="display:flex;"><span>        df_total<span style="font-weight:bold">.</span>columns <span style="font-weight:bold">=</span> [<span style="color:#b84">&#39;words&#39;</span>, <span style="color:#b84">&#39;r&#39;</span>, <span style="color:#b84">&#39;p&#39;</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        test_split <span style="font-weight:bold">=</span> <span style="color:#099">0.3</span>
</span></span><span style="display:flex;"><span>        len_total <span style="font-weight:bold">=</span> <span style="color:#999">len</span>(df_total)
</span></span><span style="display:flex;"><span>        len_test <span style="font-weight:bold">=</span> <span style="color:#999">round</span>(len_total <span style="font-weight:bold">*</span> test_split)
</span></span><span style="display:flex;"><span>        len_train <span style="font-weight:bold">=</span> len_total <span style="font-weight:bold">-</span> len_test
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        df_train <span style="font-weight:bold">=</span> df_total<span style="font-weight:bold">.</span>iloc[:len_train, :]
</span></span><span style="display:flex;"><span>        df_test <span style="font-weight:bold">=</span> df_total<span style="font-weight:bold">.</span>iloc[<span style="font-weight:bold">-</span>len_test:, :]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        words_all <span style="font-weight:bold">=</span> <span style="color:#999">sorted</span>(<span style="color:#999">list</span>(<span style="color:#999">set</span>(w <span style="font-weight:bold">for</span> words <span style="font-weight:bold">in</span> df_train<span style="font-weight:bold">.</span>words <span style="font-weight:bold">for</span> w <span style="font-weight:bold">in</span> words)))
</span></span><span style="display:flex;"><span>        words_dict <span style="font-weight:bold">=</span> {w: [] <span style="font-weight:bold">for</span> w <span style="font-weight:bold">in</span> words_all}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">for</span> i <span style="font-weight:bold">in</span> <span style="color:#999">range</span>(df_train<span style="font-weight:bold">.</span>shape[<span style="color:#099">0</span>]):
</span></span><span style="display:flex;"><span>            words, r, _ <span style="font-weight:bold">=</span> df_train<span style="font-weight:bold">.</span>iloc[i]
</span></span><span style="display:flex;"><span>            <span style="font-weight:bold">for</span> w <span style="font-weight:bold">in</span> words: words_dict[w]<span style="font-weight:bold">.</span>append(r <span style="font-weight:bold">&gt;</span> <span style="color:#099">0</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        words_df <span style="font-weight:bold">=</span> pd<span style="font-weight:bold">.</span>DataFrame({
</span></span><span style="display:flex;"><span>            <span style="color:#b84">&#39;word&#39;</span>: words_all,
</span></span><span style="display:flex;"><span>            <span style="color:#b84">&#39;r&#39;</span>: [np<span style="font-weight:bold">.</span>mean(words_dict[w]) <span style="font-weight:bold">for</span> w <span style="font-weight:bold">in</span> words_all],
</span></span><span style="display:flex;"><span>            <span style="color:#b84">&#39;k&#39;</span>: [<span style="color:#999">len</span>(words_dict[w]) <span style="font-weight:bold">for</span> w <span style="font-weight:bold">in</span> words_all]
</span></span><span style="display:flex;"><span>        }, index<span style="font-weight:bold">=</span><span style="color:#999">range</span>(<span style="color:#999">len</span>(words_all)))<span style="font-weight:bold">.</span>sort_values(by<span style="font-weight:bold">=</span><span style="color:#b84">&#39;r&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        words_df <span style="font-weight:bold">=</span> words_df[words_df<span style="font-weight:bold">.</span>k <span style="font-weight:bold">&gt;=</span> minimum_occurrence][words_df<span style="font-weight:bold">.</span>word<span style="font-weight:bold">.</span>apply(<span style="color:#999">len</span>) <span style="font-weight:bold">&gt;=</span> minimum_length]<span style="font-weight:bold">.</span>reset_index(drop<span style="font-weight:bold">=</span><span style="font-weight:bold">True</span>)
</span></span><span style="display:flex;"><span>        words_df[<span style="color:#b84">&#39;p&#39;</span>] <span style="font-weight:bold">=</span> np<span style="font-weight:bold">.</span>argsort(words_df<span style="font-weight:bold">.</span>r) <span style="font-weight:bold">/</span> (<span style="color:#999">len</span>(words_df) <span style="font-weight:bold">-</span> <span style="color:#099">1</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        pos_words <span style="font-weight:bold">=</span> words_df[words_df<span style="font-weight:bold">.</span>p <span style="font-weight:bold">&gt;</span> <span style="color:#099">1</span> <span style="font-weight:bold">-</span> alpha]<span style="font-weight:bold">.</span>word<span style="font-weight:bold">.</span>values<span style="font-weight:bold">.</span>tolist()
</span></span><span style="display:flex;"><span>        neg_words <span style="font-weight:bold">=</span> words_df[words_df<span style="font-weight:bold">.</span>p <span style="font-weight:bold">&lt;</span> alpha]<span style="font-weight:bold">.</span>word<span style="font-weight:bold">.</span>values<span style="font-weight:bold">.</span>tolist()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        keywords <span style="font-weight:bold">=</span> pos_words <span style="font-weight:bold">+</span> neg_words
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">def</span> <span style="color:#900;font-weight:bold">count_words</span>(words):
</span></span><span style="display:flex;"><span>            c <span style="font-weight:bold">=</span> Counter(words)
</span></span><span style="display:flex;"><span>            d <span style="font-weight:bold">=</span> [c[w] <span style="font-weight:bold">for</span> w <span style="font-weight:bold">in</span> keywords]
</span></span><span style="display:flex;"><span>            <span style="font-weight:bold">return</span> np<span style="font-weight:bold">.</span>array(d)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        df_train[<span style="color:#b84">&#39;d&#39;</span>] <span style="font-weight:bold">=</span> df_train<span style="font-weight:bold">.</span>words<span style="font-weight:bold">.</span>apply(count_words)<span style="font-weight:bold">.</span>values
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        p <span style="font-weight:bold">=</span> df_train<span style="font-weight:bold">.</span>p<span style="font-weight:bold">.</span>values
</span></span><span style="display:flex;"><span>        W <span style="font-weight:bold">=</span> np<span style="font-weight:bold">.</span>vstack([p, <span style="color:#099">1</span> <span style="font-weight:bold">-</span> p])<span style="font-weight:bold">.</span>T
</span></span><span style="display:flex;"><span>        D <span style="font-weight:bold">=</span> np<span style="font-weight:bold">.</span>vstack(df_train<span style="font-weight:bold">.</span>d<span style="font-weight:bold">.</span>values)
</span></span><span style="display:flex;"><span>        D <span style="font-weight:bold">=</span> (D<span style="font-weight:bold">.</span>T <span style="font-weight:bold">/</span> D<span style="font-weight:bold">.</span>sum(axis<span style="font-weight:bold">=</span><span style="color:#099">1</span>))<span style="font-weight:bold">.</span>T
</span></span><span style="display:flex;"><span>        D[np<span style="font-weight:bold">.</span>isnan(D)] <span style="font-weight:bold">=</span> <span style="color:#099">0</span>
</span></span><span style="display:flex;"><span>        O_pos, O_neg <span style="font-weight:bold">=</span> np<span style="font-weight:bold">.</span>maximum(np<span style="font-weight:bold">.</span>linalg<span style="font-weight:bold">.</span>pinv(W<span style="font-weight:bold">.</span>T <span style="font-weight:bold">@</span> W) <span style="font-weight:bold">@</span> (W<span style="font-weight:bold">.</span>T <span style="font-weight:bold">@</span> D), <span style="color:#099">0</span>)
</span></span><span style="display:flex;"><span>        O_pos <span style="font-weight:bold">=</span> (O_pos <span style="font-weight:bold">/</span> O_pos<span style="font-weight:bold">.</span>sum())
</span></span><span style="display:flex;"><span>        O_neg <span style="font-weight:bold">=</span> (O_neg <span style="font-weight:bold">/</span> O_neg<span style="font-weight:bold">.</span>sum())
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">def</span> <span style="color:#900;font-weight:bold">pen_ll</span>(p, d, lamda):
</span></span><span style="display:flex;"><span>            <span style="font-weight:bold">return</span> (d <span style="font-weight:bold">*</span> np<span style="font-weight:bold">.</span>log(p <span style="font-weight:bold">*</span> O_pos <span style="font-weight:bold">+</span> (<span style="color:#099">1</span> <span style="font-weight:bold">-</span> p) <span style="font-weight:bold">*</span> O_neg))<span style="font-weight:bold">.</span>sum() <span style="font-weight:bold">+</span> lamda <span style="font-weight:bold">*</span> np<span style="font-weight:bold">.</span>log(p <span style="font-weight:bold">*</span> (<span style="color:#099">1</span> <span style="font-weight:bold">-</span> p))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">def</span> <span style="color:#900;font-weight:bold">predict</span>(d, lamda):
</span></span><span style="display:flex;"><span>            <span style="font-weight:bold">return</span> minimize(<span style="font-weight:bold">lambda</span> p: <span style="font-weight:bold">-</span>pen_ll(p, d, lamda), x0<span style="font-weight:bold">=</span><span style="color:#099">.5</span>, method<span style="font-weight:bold">=</span><span style="color:#b84">&#39;Nelder-Mead&#39;</span>)<span style="font-weight:bold">.</span>x[<span style="color:#099">0</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">def</span> <span style="color:#900;font-weight:bold">mse_p</span>(lamda):
</span></span><span style="display:flex;"><span>            p_hat <span style="font-weight:bold">=</span> np<span style="font-weight:bold">.</span>array([predict(d, lamda) <span style="font-weight:bold">for</span> d <span style="font-weight:bold">in</span> df_train<span style="font-weight:bold">.</span>d])
</span></span><span style="display:flex;"><span>            <span style="font-weight:bold">return</span> ((df_train<span style="font-weight:bold">.</span>p<span style="font-weight:bold">.</span>values <span style="font-weight:bold">-</span> p_hat)<span style="font-weight:bold">**</span><span style="color:#099">2</span>)<span style="font-weight:bold">.</span>mean()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        best_lamda <span style="font-weight:bold">=</span> minimize(mse_p, x0<span style="font-weight:bold">=</span><span style="color:#099">0</span>, method<span style="font-weight:bold">=</span><span style="color:#b84">&#39;Nelder-Mead&#39;</span>, bounds<span style="font-weight:bold">=</span>(<span style="color:#099">0</span>, <span style="font-weight:bold">None</span>))<span style="font-weight:bold">.</span>x[<span style="color:#099">0</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        df_test[<span style="color:#b84">&#39;d&#39;</span>] <span style="font-weight:bold">=</span> df_test<span style="font-weight:bold">.</span>words<span style="font-weight:bold">.</span>apply(count_words)<span style="font-weight:bold">.</span>values
</span></span><span style="display:flex;"><span>        df_test[<span style="color:#b84">&#39;p_hat&#39;</span>] <span style="font-weight:bold">=</span> [predict(d, best_lamda) <span style="font-weight:bold">for</span> d <span style="font-weight:bold">in</span> df_test<span style="font-weight:bold">.</span>d]
</span></span><span style="display:flex;"><span>        df_test <span style="font-weight:bold">=</span> df_test[[<span style="color:#b84">&#39;words&#39;</span>, <span style="color:#b84">&#39;r&#39;</span>, <span style="color:#b84">&#39;p&#39;</span>, <span style="color:#b84">&#39;p_hat&#39;</span>, <span style="color:#b84">&#39;d&#39;</span>]]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        compound <span style="font-weight:bold">=</span> <span style="font-weight:bold">lambda</span> x: (<span style="color:#099">1</span> <span style="font-weight:bold">+</span> x)<span style="font-weight:bold">.</span>cumprod() <span style="font-weight:bold">-</span> <span style="color:#099">1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        r <span style="font-weight:bold">=</span> df_test<span style="font-weight:bold">.</span>r
</span></span><span style="display:flex;"><span>        size <span style="font-weight:bold">=</span> df_test<span style="font-weight:bold">.</span>p_hat<span style="font-weight:bold">.</span>apply(size)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        daily_rtn <span style="font-weight:bold">=</span> r <span style="font-weight:bold">*</span> size
</span></span><span style="display:flex;"><span>        cum_rtn <span style="font-weight:bold">=</span> compound(daily_rtn)
</span></span><span style="display:flex;"><span>        daily_rtn_momentum <span style="font-weight:bold">=</span> rtn[cum_rtn<span style="font-weight:bold">.</span>index]
</span></span><span style="display:flex;"><span>        cum_rtn_momentum <span style="font-weight:bold">=</span> compound(daily_rtn_momentum)
</span></span><span style="display:flex;"><span>        daily_rtn_momentum_rev <span style="font-weight:bold">=</span> <span style="font-weight:bold">-</span>daily_rtn_momentum
</span></span><span style="display:flex;"><span>        cum_rtn_momentum_rev <span style="font-weight:bold">=</span> compound(daily_rtn_momentum_rev)
</span></span><span style="display:flex;"><span>        daily_rtn_buy_hold <span style="font-weight:bold">=</span> price<span style="font-weight:bold">.</span>BTC<span style="font-weight:bold">.</span>pct_change()<span style="font-weight:bold">.</span>loc[cum_rtn<span style="font-weight:bold">.</span>index]
</span></span><span style="display:flex;"><span>        cum_rtn_buy_hold <span style="font-weight:bold">=</span> compound(daily_rtn_buy_hold)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        win_rate <span style="font-weight:bold">=</span> <span style="font-weight:bold">lambda</span> x: (x <span style="font-weight:bold">&gt;</span> <span style="color:#099">0</span>)<span style="font-weight:bold">.</span>mean()
</span></span><span style="display:flex;"><span>        sharpe <span style="font-weight:bold">=</span> <span style="font-weight:bold">lambda</span> x: x<span style="font-weight:bold">.</span>mean() <span style="font-weight:bold">/</span> x<span style="font-weight:bold">.</span>std() <span style="font-weight:bold">*</span> np<span style="font-weight:bold">.</span>sqrt(<span style="color:#099">360</span>)
</span></span><span style="display:flex;"><span>        mdd <span style="font-weight:bold">=</span> <span style="font-weight:bold">lambda</span> x: (<span style="color:#099">1</span> <span style="font-weight:bold">-</span> x <span style="font-weight:bold">/</span> x<span style="font-weight:bold">.</span>cummax())<span style="font-weight:bold">.</span>max()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        DAILY <span style="font-weight:bold">=</span> [daily_rtn_buy_hold, daily_rtn_momentum, daily_rtn_momentum_rev, daily_rtn]
</span></span><span style="display:flex;"><span>        CUM <span style="font-weight:bold">=</span> [cum_rtn_buy_hold, cum_rtn_momentum, cum_rtn_momentum_rev, cum_rtn]
</span></span><span style="display:flex;"><span>        wr <span style="font-weight:bold">=</span> [win_rate(x) <span style="font-weight:bold">for</span> x <span style="font-weight:bold">in</span> DAILY]
</span></span><span style="display:flex;"><span>        sr <span style="font-weight:bold">=</span> [sharpe(x) <span style="font-weight:bold">for</span> x <span style="font-weight:bold">in</span> DAILY]
</span></span><span style="display:flex;"><span>        md <span style="font-weight:bold">=</span> [mdd(x <span style="font-weight:bold">+</span> <span style="color:#099">1</span>) <span style="font-weight:bold">for</span> x <span style="font-weight:bold">in</span> CUM]
</span></span><span style="display:flex;"><span>        result <span style="font-weight:bold">=</span> pd<span style="font-weight:bold">.</span>DataFrame({<span style="color:#b84">&#39;Win%&#39;</span>: wr, <span style="color:#b84">&#39;Sharpe&#39;</span>: sr, <span style="color:#b84">&#39;MDD&#39;</span>: md}, index<span style="font-weight:bold">=</span>[<span style="color:#b84">&#39;Buy &amp; Hold&#39;</span>, <span style="color:#b84">&#39;Momentum&#39;</span>, <span style="color:#b84">&#39;Mom. Rev.&#39;</span>, <span style="color:#b84">&#39;Strategy&#39;</span>])
</span></span><span style="display:flex;"><span>        result<span style="font-weight:bold">.</span>index<span style="font-weight:bold">.</span>name <span style="font-weight:bold">=</span> <span style="color:#b84">&#39;Statistics&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">return</span> result
</span></span></code></pre></div><p>The hyper-parameter testing, using the backtest engine above, is listed as follows.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="font-weight:bold">if</span> <span style="font-weight:bold">not</span> os<span style="font-weight:bold">.</span>path<span style="font-weight:bold">.</span>isfile(<span style="color:#b84">&#39;misc/results.csv&#39;</span>):
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">from</span> <span style="color:#555">misc.backtest</span> <span style="font-weight:bold">import</span> BacktestEngine
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    be <span style="font-weight:bold">=</span> BacktestEngine()
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    size_continuous <span style="font-weight:bold">=</span> <span style="font-weight:bold">lambda</span> x: <span style="color:#099">2</span> <span style="font-weight:bold">*</span> x <span style="font-weight:bold">-</span> <span style="color:#099">1</span>
</span></span><span style="display:flex;"><span>    size_binary <span style="font-weight:bold">=</span> <span style="font-weight:bold">lambda</span> x: <span style="color:#099">1</span> <span style="font-weight:bold">if</span> x <span style="font-weight:bold">&gt;</span> <span style="color:#099">.5</span> <span style="font-weight:bold">else</span> <span style="font-weight:bold">-</span><span style="color:#099">1</span>
</span></span><span style="display:flex;"><span>    size_trinary <span style="font-weight:bold">=</span> <span style="font-weight:bold">lambda</span> x: <span style="color:#099">1</span> <span style="font-weight:bold">if</span> x <span style="font-weight:bold">&gt;</span> <span style="color:#099">2</span> <span style="font-weight:bold">/</span> <span style="color:#099">3</span> <span style="font-weight:bold">else</span> <span style="color:#099">0</span> <span style="font-weight:bold">if</span> x <span style="font-weight:bold">&gt;</span> <span style="color:#099">1</span> <span style="font-weight:bold">/</span> <span style="color:#099">3</span> <span style="font-weight:bold">else</span> <span style="font-weight:bold">-</span><span style="color:#099">1</span>
</span></span><span style="display:flex;"><span>    size_funcs <span style="font-weight:bold">=</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#b84">&#39;continuous&#39;</span>: size_continuous,
</span></span><span style="display:flex;"><span>        <span style="color:#b84">&#39;binary&#39;</span>: size_binary,
</span></span><span style="display:flex;"><span>        <span style="color:#b84">&#39;trinary&#39;</span>: size_trinary
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    params <span style="font-weight:bold">=</span> <span style="color:#999">dict</span>(
</span></span><span style="display:flex;"><span>        lookback_window<span style="font-weight:bold">=</span>[<span style="color:#099">20</span>, <span style="color:#099">60</span>, <span style="color:#099">120</span>],
</span></span><span style="display:flex;"><span>        minimum_occurrence<span style="font-weight:bold">=</span>[<span style="color:#099">10</span>, <span style="color:#099">50</span>, <span style="color:#099">100</span>],
</span></span><span style="display:flex;"><span>        minimum_length<span style="font-weight:bold">=</span>[<span style="color:#099">1</span>, <span style="color:#099">3</span>, <span style="color:#099">5</span>],
</span></span><span style="display:flex;"><span>        alpha<span style="font-weight:bold">=</span>[<span style="color:#099">.05</span>, <span style="color:#099">.10</span>, <span style="color:#099">.20</span>],
</span></span><span style="display:flex;"><span>        size<span style="font-weight:bold">=</span>[<span style="color:#b84">&#39;continuous&#39;</span>, <span style="color:#b84">&#39;binary&#39;</span>, <span style="color:#b84">&#39;trinary&#39;</span>]
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">def</span> <span style="color:#900;font-weight:bold">grid</span>(g):
</span></span><span style="display:flex;"><span>        keys, values <span style="font-weight:bold">=</span> <span style="color:#999">zip</span>(<span style="font-weight:bold">*</span>g<span style="font-weight:bold">.</span>items())
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">for</span> v <span style="font-weight:bold">in</span> product(<span style="font-weight:bold">*</span>values):
</span></span><span style="display:flex;"><span>            <span style="font-weight:bold">yield</span> <span style="color:#999">dict</span>(<span style="color:#999">zip</span>(keys, v))
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    P <span style="font-weight:bold">=</span> namedtuple(<span style="color:#b84">&#39;Params&#39;</span>, params<span style="font-weight:bold">.</span>keys())
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    results <span style="font-weight:bold">=</span> {}
</span></span><span style="display:flex;"><span>    <span style="color:#999">print</span>(<span style="color:#b84">&#39;Initializing...&#39;</span>, end<span style="font-weight:bold">=</span><span style="color:#b84">&#39;</span><span style="color:#b84">\r</span><span style="color:#b84">&#39;</span>)
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">for</span> i, param <span style="font-weight:bold">in</span> <span style="color:#999">enumerate</span>(grid(params)):
</span></span><span style="display:flex;"><span>        p <span style="font-weight:bold">=</span> P(<span style="font-weight:bold">**</span>param)
</span></span><span style="display:flex;"><span>        param[<span style="color:#b84">&#39;size&#39;</span>] <span style="font-weight:bold">=</span> size_funcs[param[<span style="color:#b84">&#39;size&#39;</span>]]
</span></span><span style="display:flex;"><span>        result <span style="font-weight:bold">=</span> be<span style="font-weight:bold">.</span>run(<span style="font-weight:bold">**</span>param)
</span></span><span style="display:flex;"><span>        results[p] <span style="font-weight:bold">=</span> result
</span></span><span style="display:flex;"><span>        wr, sr, md <span style="font-weight:bold">=</span> result<span style="font-weight:bold">.</span>T<span style="font-weight:bold">.</span>Strategy
</span></span><span style="display:flex;"><span>        <span style="color:#999">print</span>(<span style="color:#b84">f</span><span style="color:#b84">&#39;[</span><span style="color:#b84">{</span>(i <span style="font-weight:bold">+</span> <span style="color:#099">1</span>)<span style="color:#b84">:</span><span style="color:#b84">&gt;3d</span><span style="color:#b84">}</span><span style="color:#b84">] </span><span style="color:#b84">{</span>p<span style="color:#b84">}</span><span style="color:#b84">:</span><span style="color:#b84">\n</span><span style="color:#b84">      Win%=</span><span style="color:#b84">{</span>wr<span style="color:#b84">:</span><span style="color:#b84">.2%</span><span style="color:#b84">}</span><span style="color:#b84">, Sharpe=</span><span style="color:#b84">{</span>sr<span style="color:#b84">:</span><span style="color:#b84">.2f</span><span style="color:#b84">}</span><span style="color:#b84">, MDD=</span><span style="color:#b84">{</span>md<span style="color:#b84">:</span><span style="color:#b84">.2%</span><span style="color:#b84">}</span><span style="color:#b84">&#39;</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    df_results <span style="font-weight:bold">=</span> pd<span style="font-weight:bold">.</span>concat(results)<span style="font-weight:bold">.</span>reset_index()
</span></span><span style="display:flex;"><span>    df_results<span style="font-weight:bold">.</span>columns <span style="font-weight:bold">=</span> [<span style="color:#b84">&#39;lookback_window&#39;</span>, <span style="color:#b84">&#39;minimum_occurrence&#39;</span>, <span style="color:#b84">&#39;minimum_length&#39;</span>,
</span></span><span style="display:flex;"><span>                          <span style="color:#b84">&#39;alpha&#39;</span>, <span style="color:#b84">&#39;size&#39;</span>, <span style="color:#b84">&#39;strategy&#39;</span>, <span style="color:#b84">&#39;win_rate&#39;</span>, <span style="color:#b84">&#39;sharpe&#39;</span>, <span style="color:#b84">&#39;mdd&#39;</span>]
</span></span><span style="display:flex;"><span>    df_results<span style="font-weight:bold">.</span>to_csv(<span style="color:#b84">&#39;misc/results.csv&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="font-weight:bold">else</span>:
</span></span><span style="display:flex;"><span>    df_results <span style="font-weight:bold">=</span> pd<span style="font-weight:bold">.</span>read_csv(<span style="color:#b84">&#39;misc/results.csv&#39;</span>, index_col<span style="font-weight:bold">=</span><span style="color:#099">0</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>display(HTML(df_results<span style="font-weight:bold">.</span>to_html(max_rows<span style="font-weight:bold">=</span><span style="color:#099">10</span>)))
</span></span></code></pre></div><table>
<thead>
<tr>
<th>#</th>
<th>lookback_window</th>
<th>minimum_occurrence</th>
<th>minimum_length</th>
<th>alpha</th>
<th>size</th>
<th>strategy</th>
<th>win_rate</th>
<th>sharpe</th>
<th>mdd</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>20</td>
<td>10</td>
<td>1</td>
<td>0.05</td>
<td>binary</td>
<td>Buy &amp; Hold</td>
<td>0.527094</td>
<td>-0.441738</td>
<td>0.831663</td>
</tr>
<tr>
<td>1</td>
<td>20</td>
<td>10</td>
<td>1</td>
<td>0.05</td>
<td>binary</td>
<td>Momentum</td>
<td>0.423645</td>
<td>-1.686962</td>
<td>0.998461</td>
</tr>
<tr>
<td>2</td>
<td>20</td>
<td>10</td>
<td>1</td>
<td>0.05</td>
<td>binary</td>
<td>Mom. Rev.</td>
<td>0.576355</td>
<td>1.686962</td>
<td>0.781847</td>
</tr>
<tr>
<td>3</td>
<td>20</td>
<td>10</td>
<td>1</td>
<td>0.05</td>
<td>binary</td>
<td>Strategy</td>
<td>0.482759</td>
<td>-0.521645</td>
<td>0.988099</td>
</tr>
<tr>
<td>4</td>
<td>20</td>
<td>10</td>
<td>1</td>
<td>0.05</td>
<td>continuous</td>
<td>Buy &amp; Hold</td>
<td>0.527094</td>
<td>-0.441738</td>
<td>0.831663</td>
</tr>
<tr>
<td>&hellip;</td>
<td>&hellip;</td>
<td>&hellip;</td>
<td>&hellip;</td>
<td>&hellip;</td>
<td>&hellip;</td>
<td>&hellip;</td>
<td>&hellip;</td>
<td>&hellip;</td>
<td>&hellip;</td>
</tr>
<tr>
<td>967</td>
<td>120</td>
<td>100</td>
<td>5</td>
<td>0.20</td>
<td>continuous</td>
<td>Strategy</td>
<td>0.494709</td>
<td>-0.831074</td>
<td>0.582280</td>
</tr>
<tr>
<td>968</td>
<td>120</td>
<td>100</td>
<td>5</td>
<td>0.20</td>
<td>trinary</td>
<td>Buy &amp; Hold</td>
<td>0.526455</td>
<td>-0.971476</td>
<td>0.789994</td>
</tr>
<tr>
<td>969</td>
<td>120</td>
<td>100</td>
<td>5</td>
<td>0.20</td>
<td>trinary</td>
<td>Momentum</td>
<td>0.433862</td>
<td>-0.060313</td>
<td>0.925483</td>
</tr>
<tr>
<td>970</td>
<td>120</td>
<td>100</td>
<td>5</td>
<td>0.20</td>
<td>trinary</td>
<td>Mom. Rev.</td>
<td>0.566138</td>
<td>0.060313</td>
<td>0.987388</td>
</tr>
<tr>
<td>971</td>
<td>120</td>
<td>100</td>
<td>5</td>
<td>0.20</td>
<td>trinary</td>
<td>Strategy</td>
<td>0.047619</td>
<td>-0.988654</td>
<td>0.665146</td>
</tr>
</tbody>
</table>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>df_results_strategy <span style="font-weight:bold">=</span> df_results[df_results<span style="font-weight:bold">.</span>strategy<span style="font-weight:bold">==</span><span style="color:#b84">&#39;Strategy&#39;</span>]<span style="font-weight:bold">.</span>drop(<span style="color:#b84">&#39;strategy&#39;</span>, axis<span style="font-weight:bold">=</span><span style="color:#099">1</span>)<span style="font-weight:bold">.</span>melt(
</span></span><span style="display:flex;"><span>    id_vars<span style="font-weight:bold">=</span>[<span style="color:#b84">&#39;lookback_window&#39;</span>, <span style="color:#b84">&#39;minimum_occurrence&#39;</span>, <span style="color:#b84">&#39;minimum_length&#39;</span>, <span style="color:#b84">&#39;alpha&#39;</span>, <span style="color:#b84">&#39;size&#39;</span>],
</span></span><span style="display:flex;"><span>    value_vars<span style="font-weight:bold">=</span>[<span style="color:#b84">&#39;win_rate&#39;</span>, <span style="color:#b84">&#39;sharpe&#39;</span>, <span style="color:#b84">&#39;mdd&#39;</span>], var_name<span style="font-weight:bold">=</span><span style="color:#b84">&#39;statistic&#39;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>display(HTML(df_results_strategy<span style="font-weight:bold">.</span>to_html(max_rows<span style="font-weight:bold">=</span><span style="color:#099">10</span>)))
</span></span></code></pre></div><table>
<thead>
<tr>
<th>#</th>
<th>lookback_window</th>
<th>minimum_occurrence</th>
<th>minimum_length</th>
<th>alpha</th>
<th>size</th>
<th>statistic</th>
<th>value</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>20</td>
<td>10</td>
<td>1</td>
<td>0.05</td>
<td>binary</td>
<td>win_rate</td>
<td>0.482759</td>
</tr>
<tr>
<td>1</td>
<td>20</td>
<td>10</td>
<td>1</td>
<td>0.05</td>
<td>continuous</td>
<td>win_rate</td>
<td>0.470443</td>
</tr>
<tr>
<td>2</td>
<td>20</td>
<td>10</td>
<td>1</td>
<td>0.05</td>
<td>trinary</td>
<td>win_rate</td>
<td>0.172414</td>
</tr>
<tr>
<td>3</td>
<td>20</td>
<td>10</td>
<td>1</td>
<td>0.10</td>
<td>binary</td>
<td>win_rate</td>
<td>0.514778</td>
</tr>
<tr>
<td>4</td>
<td>20</td>
<td>10</td>
<td>1</td>
<td>0.10</td>
<td>continuous</td>
<td>win_rate</td>
<td>0.512315</td>
</tr>
<tr>
<td>&hellip;</td>
<td>&hellip;</td>
<td>&hellip;</td>
<td>&hellip;</td>
<td>&hellip;</td>
<td>&hellip;</td>
<td>&hellip;</td>
<td>&hellip;</td>
</tr>
<tr>
<td>724</td>
<td>120</td>
<td>100</td>
<td>5</td>
<td>0.10</td>
<td>continuous</td>
<td>mdd</td>
<td>0.376395</td>
</tr>
<tr>
<td>725</td>
<td>120</td>
<td>100</td>
<td>5</td>
<td>0.10</td>
<td>trinary</td>
<td>mdd</td>
<td>0.407608</td>
</tr>
<tr>
<td>726</td>
<td>120</td>
<td>100</td>
<td>5</td>
<td>0.20</td>
<td>binary</td>
<td>mdd</td>
<td>0.996307</td>
</tr>
<tr>
<td>727</td>
<td>120</td>
<td>100</td>
<td>5</td>
<td>0.20</td>
<td>continuous</td>
<td>mdd</td>
<td>0.582280</td>
</tr>
<tr>
<td>728</td>
<td>120</td>
<td>100</td>
<td>5</td>
<td>0.20</td>
<td>trinary</td>
<td>mdd</td>
<td>0.665146</td>
</tr>
</tbody>
</table>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>sns<span style="font-weight:bold">.</span>set({
</span></span><span style="display:flex;"><span>    <span style="color:#b84">&#39;font.size&#39;</span>: <span style="color:#099">12</span>, <span style="color:#b84">&#39;axes.labelsize&#39;</span>: <span style="color:#099">12</span>, <span style="color:#b84">&#39;legend.fontsize&#39;</span>: <span style="color:#099">12</span>, 
</span></span><span style="display:flex;"><span>    <span style="color:#b84">&#39;axes.titlesize&#39;</span>: <span style="color:#099">12</span>, <span style="color:#b84">&#39;xtick.labelsize&#39;</span>: <span style="color:#099">12</span>, <span style="color:#b84">&#39;ytick.labelsize&#39;</span>: <span style="color:#099">12</span>
</span></span><span style="display:flex;"><span>})
</span></span><span style="display:flex;"><span>sns<span style="font-weight:bold">.</span>set_style({<span style="color:#b84">&#39;axes.facecolor&#39;</span>: <span style="color:#b84">&#39;white&#39;</span>, <span style="color:#b84">&#39;axes.edgecolor&#39;</span>: <span style="color:#b84">&#39;black&#39;</span>, <span style="color:#b84">&#39;axes.linewidth&#39;</span>: <span style="color:#099">2</span>})
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="font-weight:bold">for</span> hue <span style="font-weight:bold">in</span> [<span style="color:#b84">&#39;lookback_window&#39;</span>, <span style="color:#b84">&#39;minimum_occurrence&#39;</span>, <span style="color:#b84">&#39;minimum_length&#39;</span>, <span style="color:#b84">&#39;alpha&#39;</span>]:
</span></span><span style="display:flex;"><span>    sns<span style="font-weight:bold">.</span>catplot(
</span></span><span style="display:flex;"><span>        x<span style="font-weight:bold">=</span><span style="color:#b84">&#39;size&#39;</span>, y<span style="font-weight:bold">=</span><span style="color:#b84">&#39;value&#39;</span>, hue<span style="font-weight:bold">=</span>hue, col<span style="font-weight:bold">=</span><span style="color:#b84">&#39;statistic&#39;</span>, kind<span style="font-weight:bold">=</span><span style="color:#b84">&#39;bar&#39;</span>, capsize<span style="font-weight:bold">=</span><span style="color:#099">.1</span>, errwidth<span style="font-weight:bold">=</span><span style="color:#099">2</span>,
</span></span><span style="display:flex;"><span>        sharey<span style="font-weight:bold">=</span><span style="font-weight:bold">False</span>, palette<span style="font-weight:bold">=</span>[<span style="color:#b84">&#39;red&#39;</span>, <span style="color:#b84">&#39;orange&#39;</span>, <span style="color:#b84">&#39;gold&#39;</span>], data<span style="font-weight:bold">=</span>df_results_strategy
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>    plt<span style="font-weight:bold">.</span>savefig(<span style="color:#b84">f</span><span style="color:#b84">&#39;misc/</span><span style="color:#b84">{</span>hue<span style="color:#b84">}</span><span style="color:#b84">.png&#39;</span>)
</span></span></code></pre></div>

<script>
  var unfocusableElems = document.querySelectorAll('pre');
  unfocusableElems.forEach(function (el) { el.setAttribute("tabindex", "-1"); });
  var unfocusableElems = document.querySelectorAll('iframe');
  unfocusableElems.forEach(function (el) { el.setAttribute("tabindex", "-1"); });
</script>

<footer>
  
<br><br>
<nav class="post-nav">
  <span class="nav-prev">&larr; <a href="/blog/markdown-test/">Markdown Test</a></span>
  <span class="nav-next"><a href="/blog/an-old-article/">一篇旧文</a> &rarr;</span>
</nav>

<script type="text/javascript">
document.addEventListener('keyup', function(e) {
  if (e.target.nodeName.toUpperCase() != 'BODY') return;
  var url = false;
  if (e.which == 37) {  
    
    url = '\/blog\/markdown-test\/';
    
  } else if (e.which == 39) {  
    
    url = '\/blog\/an-old-article\/';
    
  }
  if (url) window.location = url;
});
</script>



<script src="https://giscus.app/client.js" data-repo="allenfrostline/allenfrostline.github.io"
        data-repo-id="MDEwOlJlcG9zaXRvcnk3NzEzOTkxNg==" data-category="General" data-category-id="DIC_kwDOBJkPzM4CbgIQ"
        data-mapping="pathname" data-strict="0" data-reactions-enabled="0" data-emit-metadata="0"
        data-input-position="bottom" data-theme="light" data-lang="en" data-loading="lazy" crossorigin="anonymous"
        async>
        </script>



<script async src="/js/center-img.js"></script>

<script async src="/js/right-quote.js"></script>

<script async src="/js/fix-footnote.js"></script>

<script async src="/js/math-code.js"></script>

<script async src="/js/external-link.js"></script>

<script async src="/js/alt-title.js"></script>

<script async src="/js/header-link.js"></script>


<script src="/js/math-code.js"></script>

  
  
  
  
</footer>
</article>

<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-93356635-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
</body>

</html>
